jQuery(function($){"use strict";window.wc_payex_checkout={xhr:!1,init:function(e){this.form=e,this.form_submit=!1,$(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_payex_checkout"),$(document.body).bind("update_checkout",this.onUpdateCheckout),$(document.body).on("checkout_error",this.resetCheckout),$(document.body).on("updated_checkout",this.onUpdatedCheckout),$(document.body).on("blur",this.onUpdatedCheckout),$(document.body).on("click","#change-shipping-info",function(){$("#change-shipping-info").hide(),wc_payex_checkout.showAddressFields()}),wc_payex_checkout.isInstantCheckout()&&wc_payex_checkout.initInstantCheckout()},initInstantCheckout:function(){console.log("Initialization of Instant Checkout..."),wc_payex_checkout.isCheckinEnabled();let e=$("#payex-consumer-profile");if(e.length>0){let o=e.data("reference");console.log("Initiate consumerProfileRef",o),wc_payex_checkout.initCheckout(o)}else{if("undefined"==typeof payex)return;wc_payex_checkout.waitForLoading("payex.hostedView.consumer",function(e){e?console.warn(e):window.payex.hostedView.consumer({container:"payex-checkin",culture:WC_Gateway_PayEx_Checkout.culture,onConsumerIdentified:function(e){console.log("hostedView: onConsumerIdentified"),wc_payex_checkout.onConsumerIdentified(e)},onBillingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("billing",e)},onShippingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("shipping",e)},onError:function(e){wc_payex_checkout.logError("payex-checkin",e),alert(e.details)}}).open()})}},initCheckout:function(e){$("#change-shipping-info").show(),wc_payex_checkout.form.find(".payex_customer_reference").remove(),wc_payex_checkout.form.append("<input type='hidden' class='payex_customer_reference' name='payex_customer_reference' value='"+e+"'/>"),wc_payex_checkout.onSubmit()},isInstantCheckout:()=>WC_Gateway_PayEx_Checkout.instant_checkout,isCheckinEnabled:()=>WC_Gateway_PayEx_Checkout.checkin,isPaymentMethodChosen:function(){return $("#payment_method_payex_checkout").is(":checked")},block:function(){1!==wc_payex_checkout.form.data()["blockUI.isBlocked"]&&wc_payex_checkout.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){wc_payex_checkout.form.unblock()},onClose:function(){wc_payex_checkout.unblock()},onReady:function(){console.log("Ready")},onUpdateCheckout:function(){if(console.log("onUpdateCheckout"),!wc_payex_checkout.isInstantCheckout())return!1},onUpdatedCheckout:function(){return console.log("onUpdatedCheckout"),!!wc_payex_checkout.isInstantCheckout()&&(!wc_payex_checkout.form.is(".processing")&&(wc_payex_checkout.validateForm()?(wc_payex_checkout.xhr&&wc_payex_checkout.xhr.abort(),$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),void(wc_payex_checkout.xhr=wc_payex_checkout.updateOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o),wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),this.xhr=!1,"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.refreshPaymentMenu()}))):(console.log("onUpdatedCheckout: Validation is failed"),!1)))},onSubmit:function(e){return!!wc_payex_checkout.form_submit||(!wc_payex_checkout.isPaymentMethodChosen()||(void 0!==e&&e.preventDefault(),!!wc_payex_checkout.validateForm()&&(console.log("onSubmit"),!wc_payex_checkout.form.is(".processing")&&($(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),wc_payex_checkout.placeOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.initPaymentJS(e.js_url)}),!1))))},resetCheckout:function(){wc_payex_checkout.form_submit=!1},validateForm:function(){var e,o=!0;return(e=$("#ship-to-different-address-checkbox").is(":checked")?$(".woocommerce-billing-fields .validate-required, .woocommerce-shipping-fields .validate-required").find("input, select").not($("#account_password, #account_username")):$(".woocommerce-billing-fields .validate-required").find("input, select").not($("#account_password, #account_username"))).length&&e.each(function(){var e=$(this),c=e.closest(".form-row"),t=c.is(".validate-required"),n=c.is(".validate-email");(t&&("checkbox"!==e.attr("type")||e.is(":checked")?""===e.val()&&(o=!1):o=!1),n)&&(e.val()&&(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(e.val())||(o=!1)))}),o},waitForLoading:function(var_string,callback){try{var obj=eval(var_string)}catch(e){return void callback(e)}let attempts=0,timer=window.setInterval(function(){void 0!==obj?(window.clearInterval(timer),callback(null,obj)):++attempts>=120&&(window.clearInterval(timer),callback("Timeout"))},500)},loadJs:function(e,o){console.log("Loading of "+e);let c=document.createElement("script");c.setAttribute("src",e),c.setAttribute("type","text/javascript"),c.setAttribute("async",""),c.addEventListener("load",function(){console.log("Loaded: "+e),o()},!1);let t=document.getElementsByTagName("head")[0];return t&&t.appendChild(c),c},initPaymentJS:function(e,o){void 0===o&&(o=function(){}),wc_payex_checkout.loadJs(e,function(){$("#payment-payex-checkout iframe").remove(),wc_payex_checkout.isInstantCheckout()?($("#payment").hide(),wc_payex_checkout.initPaymentMenu("payment-payex-checkout")):$.featherlight('<div id="payex-paymentmenu">&nbsp;</div>',{variant:"featherlight-payex",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_payex_checkout.initPaymentMenu("payex-paymentmenu")},afterClose:function(){wc_payex_checkout.form.removeClass("processing").unblock()}}),o()})},initPaymentMenu:function(e){console.log("initPaymentMenu"),this.paymentMenu=window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_PayEx_Checkout.culture,onPaymentMenuInstrumentSelected:function(e){console.log("onPaymentMenuInstrumentSelected"),console.log(e),wc_payex_checkout.onPaymentMenuInstrumentSelected(e.name,e.instrument)},onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentCanceled:function(e){console.log("onPaymentCanceled"),console.log(e),wc_payex_checkout.logError("payment-menu-cancel",e)},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e),wc_payex_checkout.logError("payment-menu-failed",e)},onError:function(e){wc_payex_checkout.logError("payment-menu-error",e)}}),this.paymentMenu.open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),this.paymentMenu.refresh()},placeOrder:function(){console.log("placeOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_place_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"}).done(function(e){e.hasOwnProperty("result")&&"failure"===e.result&&wc_payex_checkout.logError("payex-place-order",e)})},updateOrder:function(){console.log("updateOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_update_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"}).done(function(e){e.hasOwnProperty("result")&&"failure"===e.result&&wc_payex_checkout.logError("payex-update-order",e)})},onConsumerIdentified:function(e){return console.log("onConsumerIdentified",e),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_customer_profile",nonce:WC_Gateway_PayEx_Checkout.nonce,consumerProfileRef:e.consumerProfileRef},dataType:"json"}).always(function(e){}).done(function(o){console.log(o),o.success?wc_payex_checkout.initCheckout(e.consumerProfileRef):alert(o.data.message)})},onAddressDetailsAvailable:function(e,o){return console.log("onAddressDetailsAvailable",e,o),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_get_address",nonce:WC_Gateway_PayEx_Checkout.nonce,type:e,url:o.url},dataType:"json"}).always(function(e){}).done(function(o){if(console.log(o),!o.success)return wc_payex_checkout.logError("payex-address-details",o),void alert(o.data.message);let c=o.data;$.each(c,function(o,c){[e].forEach(function(e){let t=$('input[name="'+e+"_"+o+'"]');if(0!==t.length&&(t.prop("readonly",!1),t.closest(".form-row").removeClass("payex-locked"),t.val(c).change(),"country"===o||"state"===o)){let t=$("#"+e+"_"+o);void 0!==window.Select2?t.select2("val",c):void 0!==$.fn.chosen?t.val(c).trigger("chosen:updated"):t.change()}})}),$(document.body).trigger("update_checkout")})},onPaymentMenuInstrumentSelected:function(e,o){console.log("onPaymentMenuInstrumentSelected",e,o)},logError:function(e,o){return console.warn(o),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_log_error",nonce:WC_Gateway_PayEx_Checkout.nonce,id:e,data:JSON.stringify(o)},dataType:"json"})},onError:function(e){console.log("onError",e)},submit_error:function(e){$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),wc_payex_checkout.form.removeClass("processing").unblock(),wc_payex_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_payex_checkout.scroll_to_notices(),$(document.body).trigger("checkout_error")},scroll_to_notices:function(){let e=$(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=$(".form.checkout")),$.scroll_to_notices(e)},hideAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").hide()},showAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").show()}},$(document).ready(function(){wc_payex_checkout.init($("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrb3V0LmpzIl0sIm5hbWVzIjpbImpRdWVyeSIsIiQiLCJ3aW5kb3ciLCJ3Y19wYXlleF9jaGVja291dCIsInhociIsImluaXQiLCJmb3JtIiwidGhpcyIsImZvcm1fc3VibWl0Iiwib24iLCJvblN1Ym1pdCIsImRvY3VtZW50IiwiYm9keSIsImJpbmQiLCJvblVwZGF0ZUNoZWNrb3V0IiwicmVzZXRDaGVja291dCIsIm9uVXBkYXRlZENoZWNrb3V0IiwiaGlkZSIsInNob3dBZGRyZXNzRmllbGRzIiwiaXNJbnN0YW50Q2hlY2tvdXQiLCJpbml0SW5zdGFudENoZWNrb3V0IiwiY29uc29sZSIsImxvZyIsImlzQ2hlY2tpbkVuYWJsZWQiLCJjb25zdW1lclByb2ZpbGVFbG0iLCJsZW5ndGgiLCJyZWZlcmVuY2UiLCJkYXRhIiwiaW5pdENoZWNrb3V0IiwicGF5ZXgiLCJ3YWl0Rm9yTG9hZGluZyIsImVyciIsIndhcm4iLCJob3N0ZWRWaWV3IiwiY29uc3VtZXIiLCJjb250YWluZXIiLCJjdWx0dXJlIiwiV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dCIsIm9uQ29uc3VtZXJJZGVudGlmaWVkIiwib25CaWxsaW5nRGV0YWlsc0F2YWlsYWJsZSIsIm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUiLCJvblNoaXBwaW5nRGV0YWlsc0F2YWlsYWJsZSIsIm9uRXJyb3IiLCJsb2dFcnJvciIsImFsZXJ0IiwiZGV0YWlscyIsIm9wZW4iLCJzaG93IiwiZmluZCIsInJlbW92ZSIsImFwcGVuZCIsImluc3RhbnRfY2hlY2tvdXQiLCJjaGVja2luIiwiaXNQYXltZW50TWV0aG9kQ2hvc2VuIiwiaXMiLCJibG9jayIsIm1lc3NhZ2UiLCJvdmVybGF5Q1NTIiwiYmFja2dyb3VuZCIsIm9wYWNpdHkiLCJ1bmJsb2NrIiwib25DbG9zZSIsIm9uUmVhZHkiLCJ2YWxpZGF0ZUZvcm0iLCJhYm9ydCIsImFkZENsYXNzIiwidXBkYXRlT3JkZXIiLCJhbHdheXMiLCJyZXNwb25zZSIsInJlbW92ZUNsYXNzIiwiZmFpbCIsImpxWEhSIiwidGV4dFN0YXR1cyIsImRvbmUiLCJyZXN1bHQiLCJyZWxvYWQiLCJsb2NhdGlvbiIsInJlZnJlc2giLCJ0cmlnZ2VyIiwibWVzc2FnZXMiLCJyZWZyZXNoUGF5bWVudE1lbnUiLCJlIiwicHJldmVudERlZmF1bHQiLCJwbGFjZU9yZGVyIiwiaW5pdFBheW1lbnRKUyIsIiRyZXF1aXJlZF9pbnB1dHMiLCJ2YWxpZGF0ZWQiLCJub3QiLCJlYWNoIiwiJHRoaXMiLCIkcGFyZW50IiwiY2xvc2VzdCIsInZhbGlkYXRlX3JlcXVpcmVkIiwidmFsaWRhdGVfZW1haWwiLCJhdHRyIiwidmFsIiwiUmVnRXhwIiwidGVzdCIsInZhcl9zdHJpbmciLCJjYWxsYmFjayIsIm9iaiIsImV2YWwiLCJhdHRlbXB0cyIsInRpbWVyIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibG9hZEpzIiwianMiLCJzY3JpcHQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9IZWFkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhcHBlbmRDaGlsZCIsInVybCIsImluaXRQYXltZW50TWVudSIsImZlYXRoZXJsaWdodCIsInZhcmlhbnQiLCJwZXJzaXN0IiwiY2xvc2VPbkNsaWNrIiwiY2xvc2VPbkVzYyIsImFmdGVyT3BlbiIsImFmdGVyQ2xvc2UiLCJpZCIsInBheW1lbnRNZW51Iiwib25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCIsIm5hbWUiLCJpbnN0cnVtZW50Iiwib25QYXltZW50Q3JlYXRlZCIsIm9uUGF5bWVudENvbXBsZXRlZCIsInNlbGYiLCJocmVmIiwicmVkaXJlY3RVcmwiLCJvblBheW1lbnRDYW5jZWxlZCIsIm9uUGF5bWVudEZhaWxlZCIsImZpZWxkcyIsInNlcmlhbGl6ZSIsImFqYXgiLCJ0eXBlIiwiYWpheF91cmwiLCJhY3Rpb24iLCJub25jZSIsImRhdGFUeXBlIiwiaGFzT3duUHJvcGVydHkiLCJjb25zdW1lclByb2ZpbGVSZWYiLCJzdWNjZXNzIiwia2V5IiwidmFsdWUiLCJmb3JFYWNoIiwic2VjdGlvbiIsImVsIiwicHJvcCIsImNoYW5nZSIsImVsMSIsIlNlbGVjdDIiLCJzZWxlY3QyIiwiZm4iLCJjaG9zZW4iLCJKU09OIiwic3RyaW5naWZ5Iiwic3VibWl0X2Vycm9yIiwiZXJyb3JfbWVzc2FnZSIsInByZXBlbmQiLCJibHVyIiwic2Nyb2xsX3RvX25vdGljZXMiLCJzY3JvbGxFbGVtZW50IiwiaGlkZUFkZHJlc3NGaWVsZHMiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0FBLE9BQVEsU0FBVUMsR0FDZCxhQUtBQyxPQUFPQyxrQkFBb0IsQ0FDdkJDLEtBQUssRUFLTEMsS0FBTSxTQUFVQyxHQUNaQyxLQUFLRCxLQUFlQSxFQUNwQkMsS0FBS0MsYUFBZSxFQUVwQlAsRUFBR00sS0FBS0QsTUFHSEcsR0FBSSxRQUFTLGVBQWdCRixLQUFLRyxVQUdsQ0QsR0FBSSw4Q0FFVFIsRUFBR1UsU0FBU0MsTUFBT0MsS0FBTSxrQkFBbUJOLEtBQUtPLGtCQUNqRGIsRUFBR1UsU0FBU0MsTUFBT0gsR0FBSSxpQkFBa0JGLEtBQUtRLGVBQzlDZCxFQUFHVSxTQUFTQyxNQUFPSCxHQUFJLG1CQUFvQkYsS0FBS1MsbUJBQ2hEZixFQUFHVSxTQUFTQyxNQUFPSCxHQUFJLE9BQVFGLEtBQUtTLG1CQUVwQ2YsRUFBR1UsU0FBU0MsTUFBT0gsR0FBSSxRQUFTLHdCQUF5QixXQUVyRFIsRUFBRyx5QkFBMEJnQixPQUc3QmQsa0JBQWtCZSxzQkFJakJmLGtCQUFrQmdCLHFCQUNuQmhCLGtCQUFrQmlCLHVCQU8xQkEsb0JBQXFCLFdBQ2pCQyxRQUFRQyxJQUFLLHlDQUlSbkIsa0JBQWtCb0IsbUJBS3ZCLElBQUlDLEVBQXFCdkIsRUFBRywyQkFDNUIsR0FBS3VCLEVBQW1CQyxPQUFTLEVBQUksQ0FDakMsSUFBSUMsRUFBWUYsRUFBbUJHLEtBQU0sYUFDekNOLFFBQVFDLElBQUssOEJBQStCSSxHQUM1Q3ZCLGtCQUFrQnlCLGFBQWNGLE9BQzdCLENBRUgsR0FBc0Isb0JBQVZHLE1BQ1IsT0FHSjFCLGtCQUFrQjJCLGVBQWUsNEJBQTZCLFNBQVdDLEdBQ2hFQSxFQUNEVixRQUFRVyxLQUFNRCxHQUtsQjdCLE9BQU8yQixNQUFNSSxXQUFXQyxTQUFVLENBQzlCQyxVQUFXLGdCQUNYQyxRQUFTQywwQkFBMEJELFFBQ25DRSxxQkFBc0IsU0FBVVgsR0FDNUJOLFFBQVFDLElBQUssb0NBQ2JuQixrQkFBa0JtQyxxQkFBc0JYLElBRTVDWSwwQkFBMkIsU0FBVVosR0FDakN4QixrQkFBa0JxQywwQkFBMkIsVUFBV2IsSUFFNURjLDJCQUE0QixTQUFVZCxHQUNsQ3hCLGtCQUFrQnFDLDBCQUEyQixXQUFZYixJQUU3RGUsUUFBUyxTQUFXZixHQUNoQnhCLGtCQUFrQndDLFNBQVUsZ0JBQWlCaEIsR0FDN0NpQixNQUFPakIsRUFBS2tCLFlBR2hCQyxXQUtoQmxCLGFBQWMsU0FBVUYsR0FFcEJ6QixFQUFHLHlCQUEwQjhDLE9BRTdCNUMsa0JBQWtCRyxLQUFLMEMsS0FBTSw2QkFBOEJDLFNBQzNEOUMsa0JBQWtCRyxLQUFLNEMsT0FBUSxnR0FBa0d4QixFQUFZLE9BRzdJdkIsa0JBQWtCTyxZQUd0QlMsa0JBQWlCLElBQ05rQiwwQkFBMEJjLGlCQUdyQzVCLGlCQUFnQixJQUNMYywwQkFBMEJlLFFBR3JDQyxzQkFBdUIsV0FDbkIsT0FBT3BELEVBQUcsa0NBQW1DcUQsR0FBSSxhQUdyREMsTUFBTyxXQUVFLElBRFdwRCxrQkFBa0JHLEtBQUtxQixPQUNsQixzQkFDakJ4QixrQkFBa0JHLEtBQUtpRCxNQUFNLENBQ3pCQyxRQUFTLEtBQ1RDLFdBQVksQ0FDUkMsV0FBWSxPQUNaQyxRQUFTLE9BTXpCQyxRQUFTLFdBQ0x6RCxrQkFBa0JHLEtBQUtzRCxXQUczQkMsUUFBUyxXQUNMMUQsa0JBQWtCeUQsV0FHdEJFLFFBQVMsV0FDTHpDLFFBQVFDLElBQUssVUFHakJSLGlCQUFrQixXQUdkLEdBRkFPLFFBQVFDLElBQUsscUJBRU5uQixrQkFBa0JnQixvQkFDckIsT0FBTyxHQU1mSCxrQkFBbUIsV0FHZixPQUZBSyxRQUFRQyxJQUFLLHVCQUVObkIsa0JBQWtCZ0IsdUJBSXBCaEIsa0JBQWtCRyxLQUFLZ0QsR0FBSSxpQkFJekJuRCxrQkFBa0I0RCxnQkFLcEI1RCxrQkFBa0JDLEtBQ25CRCxrQkFBa0JDLElBQUk0RCxRQUcxQi9ELEVBQUcsK0VBQWdGZ0QsU0FDbkY5QyxrQkFBa0JHLEtBQUsyRCxTQUFVLGNBQ2pDOUQsa0JBQWtCb0QsYUFFbEJwRCxrQkFBa0JDLElBQU1ELGtCQUFrQitELGNBQ3JDQyxPQUFRLFNBQVdDLEdBQ2hCakUsa0JBQWtCRyxLQUFLK0QsWUFBYSxjQUNwQ2xFLGtCQUFrQnlELFlBRXJCVSxLQUFNLFNBQVVDLEVBQU9DLEdBQ3BCbkQsUUFBUUMsSUFBSyxxQkFBdUJrRCxHQUNwQ3JFLGtCQUFrQnVDLFFBQVM4QixLQUU5QkMsS0FBTSxTQUFXTCxHQUlkLEdBSEEvQyxRQUFRQyxJQUFLOEMsR0FDYjdELEtBQUtILEtBQU0sRUFFYSxZQUFwQmdFLEVBQVNNLE9BRVQsT0FBSyxJQUFTTixFQUFTTSxPQUFPQyxZQUMxQnpFLE9BQU8wRSxTQUFTRCxXQUtmLElBQVNQLEVBQVNNLE9BQU9HLFNBQzFCNUUsRUFBR1UsU0FBU0MsTUFBT2tFLFFBQVMsd0JBR2hDM0Usa0JBQWtCdUMsUUFBUzBCLEVBQVNXLFdBTXhDNUUsa0JBQWtCNkUsMEJBM0N0QjNELFFBQVFDLElBQUssNENBQ04sTUFpRGZaLFNBQVUsU0FBVXVFLEdBQ2hCLFFBQUs5RSxrQkFBa0JLLGVBSWxCTCxrQkFBa0JrRCwrQkFDRCxJQUFONEIsR0FDUkEsRUFBRUMsbUJBR0MvRSxrQkFBa0I0RCxpQkFJekIxQyxRQUFRQyxJQUFLLGFBRVJuQixrQkFBa0JHLEtBQUtnRCxHQUFJLGlCQUloQ3JELEVBQUcsK0VBQWdGZ0QsU0FDbkY5QyxrQkFBa0JHLEtBQUsyRCxTQUFVLGNBQ2pDOUQsa0JBQWtCb0QsUUFDbEJwRCxrQkFBa0JnRixhQUNiaEIsT0FBUSxTQUFXQyxHQUNoQmpFLGtCQUFrQkcsS0FBSytELFlBQWEsY0FDcENsRSxrQkFBa0J5RCxZQUVyQlUsS0FBTSxTQUFVQyxFQUFPQyxHQUNwQnJFLGtCQUFrQnVDLFFBQVM4QixLQUU5QkMsS0FBTSxTQUFXTCxHQUVkLEdBREEvQyxRQUFRQyxJQUFLOEMsR0FDWSxZQUFwQkEsRUFBU00sT0FFVixPQUFLLElBQVNOLEVBQVNNLE9BQU9DLFlBQzFCekUsT0FBTzBFLFNBQVNELFdBS2YsSUFBU1AsRUFBU00sT0FBT0csU0FDMUI1RSxFQUFHVSxTQUFTQyxNQUFPa0UsUUFBUyx3QkFHaEMzRSxrQkFBa0J1QyxRQUFTMEIsRUFBU1csV0FLeEM1RSxrQkFBa0JpRixjQUFlaEIsRUFBaUIsV0FHbkQsT0FNZnJELGNBQWUsV0FDWFosa0JBQWtCSyxhQUFjLEdBR3BDdUQsYUFBYyxXQUNWLElBQUlzQixFQUNBQyxHQUFZLEVBb0NoQixPQWhDSUQsRUFEQ3BGLEVBQUcsdUNBQXdDcUQsR0FBSSxZQUM3QnJELEVBQUcsbUdBQW9HK0MsS0FBSyxpQkFBaUJ1QyxJQUFLdEYsRUFBRyx5Q0FFcklBLEVBQUcsa0RBQW1EK0MsS0FBSyxpQkFBaUJ1QyxJQUFLdEYsRUFBRywwQ0FHckZ3QixRQUNsQjRELEVBQWlCRyxLQUFNLFdBQ25CLElBQUlDLEVBQVF4RixFQUFHTSxNQUNYbUYsRUFBb0JELEVBQU1FLFFBQVMsYUFDbkNDLEVBQW9CRixFQUFRcEMsR0FBSSxzQkFDaEN1QyxFQUFvQkgsRUFBUXBDLEdBQUksb0JBRS9Cc0MsSUFDSSxhQUFlSCxFQUFNSyxLQUFNLFNBQWNMLEVBQU1uQyxHQUFJLFlBRTVCLEtBQWhCbUMsRUFBTU0sUUFDZFQsR0FBWSxHQUZaQSxHQUFZLEdBTWZPLEtBQ0lKLEVBQU1NLFFBRU8sSUFBSUMsT0FBTyw4NEJBQ1ZDLEtBQU1SLEVBQU1NLFNBQ3ZCVCxHQUFZLE9BT3pCQSxHQUdYeEQsZUFBZ0IsU0FBV29FLFdBQVlDLFVBQ25DLElBQ0ksSUFBSUMsSUFBTUMsS0FBTUgsWUFDbEIsTUFBT2pCLEdBRUwsWUFEQWtCLFNBQVVsQixHQUlkLElBQUlxQixTQUFXLEVBQ1hDLE1BQVFyRyxPQUFPc0csWUFBYSxnQkFDUixJQUFSSixLQUNSbEcsT0FBT3VHLGNBQWVGLE9BQ3RCSixTQUFVLEtBQU1DLFFBRWhCRSxVQUNpQixNQUNicEcsT0FBT3VHLGNBQWVGLE9BQ3RCSixTQUFVLGFBR25CLE1BUVBPLE9BQVEsU0FBV0MsRUFBSVIsR0FDbkI5RSxRQUFRQyxJQUFLLGNBQWdCcUYsR0FFN0IsSUFBSUMsRUFBU2pHLFNBQVNrRyxjQUFlLFVBR3JDRCxFQUFPRSxhQUFjLE1BQU9ILEdBQzVCQyxFQUFPRSxhQUFjLE9BQVEsbUJBQzdCRixFQUFPRSxhQUFjLFFBQVMsSUFDOUJGLEVBQU9HLGlCQUFrQixPQUFRLFdBQzdCMUYsUUFBUUMsSUFBSyxXQUFhcUYsR0FDMUJSLE1BQ0QsR0FHSCxJQUFJYSxFQUFRckcsU0FBU3NHLHFCQUFzQixRQUFTLEdBTXBELE9BTEtELEdBRURBLEVBQU1FLFlBQWFOLEdBR2hCQSxHQVFYeEIsY0FBZSxTQUFXK0IsRUFBS2hCLFFBQ0YsSUFBYkEsSUFDUkEsRUFBVyxjQUdmaEcsa0JBQWtCdUcsT0FBUVMsRUFBSyxXQUMzQmxILEVBQUcsa0NBQW1DZ0QsU0FHakM5QyxrQkFBa0JnQixxQkFDbkJsQixFQUFFLFlBQVlnQixPQUNkZCxrQkFBa0JpSCxnQkFBZ0IsMkJBRWxDbkgsRUFBRW9ILGFBQWMsMkNBQTRDLENBQ3hEQyxRQUFTLHFCQUNUQyxTQUFTLEVBQ1RDLGNBQWMsRUFDZEMsWUFBWSxFQUNaQyxVQUFXLFdBQ1B2SCxrQkFBa0JpSCxnQkFBZ0Isc0JBRXRDTyxXQUFZLFdBQ1J4SCxrQkFBa0JHLEtBQUsrRCxZQUFhLGNBQWVULGFBSy9EdUMsT0FVUmlCLGdCQUFpQixTQUFXUSxHQUN4QnZHLFFBQVFDLElBQUssbUJBR2JmLEtBQUtzSCxZQUFjM0gsT0FBTzJCLE1BQU1JLFdBQVc0RixZQUFhLENBQ3BEMUYsVUFBV3lGLEVBQ1h4RixRQUFTQywwQkFBMEJELFFBQ25DMEYsZ0NBQWlDLFNBQVduRyxHQUN4Q04sUUFBUUMsSUFBSyxtQ0FDYkQsUUFBUUMsSUFBS0ssR0FDYnhCLGtCQUFrQjJILGdDQUFpQ25HLEVBQUtvRyxLQUFNcEcsRUFBS3FHLGFBRXZFQyxpQkFBa0IsV0FDZDVHLFFBQVFDLElBQUsscUJBRWpCNEcsbUJBQW9CLFNBQVd2RyxHQUMzQk4sUUFBUUMsSUFBSyxzQkFDYkQsUUFBUUMsSUFBS0ssR0FDYndHLEtBQUt2RCxTQUFTd0QsS0FBT3pHLEVBQUswRyxhQUU5QkMsa0JBQW1CLFNBQVczRyxHQUMxQk4sUUFBUUMsSUFBSyxxQkFDYkQsUUFBUUMsSUFBS0ssR0FDYnhCLGtCQUFrQndDLFNBQVUsc0JBQXVCaEIsSUFFdkQ0RyxnQkFBaUIsU0FBVzVHLEdBQ3hCTixRQUFRQyxJQUFLLG1CQUNiRCxRQUFRQyxJQUFLSyxHQUNieEIsa0JBQWtCd0MsU0FBVSxzQkFBdUJoQixJQUd2RGUsUUFBUyxTQUFXZixHQUNoQnhCLGtCQUFrQndDLFNBQVUscUJBQXNCaEIsTUFJMURwQixLQUFLc0gsWUFBWS9FLFFBTXJCa0MsbUJBQW9CLFdBQ2hCM0QsUUFBUUMsSUFBSyxzQkFDYmYsS0FBS3NILFlBQVloRCxXQU9yQk0sV0FBWSxXQUNSOUQsUUFBUUMsSUFBSyxjQUNiLElBQUlrSCxFQUFTdkksRUFBRSx5QkFBeUJ3SSxZQUV4QyxPQUFPeEksRUFBRXlJLEtBQU0sQ0FDWEMsS0FBTSxPQUNOeEIsSUFBSzlFLDBCQUEwQnVHLFNBQy9CakgsS0FBTSxDQUNGa0gsT0FBUSxvQkFDUkMsTUFBT3pHLDBCQUEwQnlHLE1BQ2pDbkgsS0FBTTZHLEdBRVZPLFNBQVUsU0FDVnRFLEtBQU0sU0FBV0wsR0FDYkEsRUFBUzRFLGVBQWUsV0FBaUMsWUFBcEI1RSxFQUFTTSxRQUM5Q3ZFLGtCQUFrQndDLFNBQVMsb0JBQXFCeUIsTUFTNURGLFlBQWEsV0FDVDdDLFFBQVFDLElBQUssZUFDYixJQUFJa0gsRUFBU3ZJLEVBQUUseUJBQXlCd0ksWUFFeEMsT0FBT3hJLEVBQUV5SSxLQUFNLENBQ1hDLEtBQU0sT0FDTnhCLElBQUs5RSwwQkFBMEJ1RyxTQUMvQmpILEtBQU0sQ0FDRmtILE9BQVEscUJBQ1JDLE1BQU96RywwQkFBMEJ5RyxNQUNqQ25ILEtBQU02RyxHQUVWTyxTQUFVLFNBQ1Z0RSxLQUFNLFNBQVdMLEdBQ2JBLEVBQVM0RSxlQUFlLFdBQWlDLFlBQXBCNUUsRUFBU00sUUFDOUN2RSxrQkFBa0J3QyxTQUFTLHFCQUFzQnlCLE1BVTdEOUIscUJBQXNCLFNBQVdYLEdBSTdCLE9BSEFOLFFBQVFDLElBQUssdUJBQXdCSyxHQUNyQzFCLEVBQUcseUJBQTBCOEMsT0FFdEI5QyxFQUFFeUksS0FBTSxDQUNYQyxLQUFNLE9BQ054QixJQUFLOUUsMEJBQTBCdUcsU0FDL0JqSCxLQUFNLENBQ0ZrSCxPQUFRLGtDQUNSQyxNQUFPekcsMEJBQTBCeUcsTUFDakNHLG1CQUFvQnRILEVBQUtzSCxvQkFFN0JGLFNBQVUsU0FDVjVFLE9BQVEsU0FBV0MsTUFFbkJLLEtBQU0sU0FBV0wsR0FDakIvQyxRQUFRQyxJQUFJOEMsR0FDUEEsRUFBUzhFLFFBTWQvSSxrQkFBa0J5QixhQUFjRCxFQUFLc0gsb0JBTGpDckcsTUFBTXdCLEVBQVN6QyxLQUFLNkIsWUFlaENoQiwwQkFBMkIsU0FBVW1HLEVBQU1oSCxHQUt2QyxPQUpBTixRQUFRQyxJQUFLLDRCQUE2QnFILEVBQU1oSCxHQUVoRDFCLEVBQUcseUJBQTBCOEMsT0FFdEI5QyxFQUFFeUksS0FBTSxDQUNYQyxLQUFNLE9BQ054QixJQUFLOUUsMEJBQTBCdUcsU0FDL0JqSCxLQUFNLENBQ0ZrSCxPQUFRLDZCQUNSQyxNQUFPekcsMEJBQTBCeUcsTUFDakNILEtBQU1BLEVBQ054QixJQUFLeEYsRUFBS3dGLEtBRWQ0QixTQUFVLFNBQ1Y1RSxPQUFRLFNBQVdDLE1BRW5CSyxLQUFNLFNBQVdMLEdBRWpCLEdBREEvQyxRQUFRQyxJQUFJOEMsSUFDUEEsRUFBUzhFLFFBR1YsT0FGQS9JLGtCQUFrQndDLFNBQVMsd0JBQXlCeUIsUUFDcER4QixNQUFNd0IsRUFBU3pDLEtBQUs2QixTQUt4QixJQUFJN0IsRUFBT3lDLEVBQVN6QyxLQUNwQjFCLEVBQUV1RixLQUFLN0QsRUFBTSxTQUFVd0gsRUFBS0MsR0FDeEIsQ0FBQ1QsR0FBTVUsUUFBUSxTQUFTQyxHQUNwQixJQUFJQyxFQUFLdEosRUFBRSxlQUFpQnFKLEVBQVUsSUFBTUgsRUFBTSxNQUNsRCxHQUFrQixJQUFkSSxFQUFHOUgsU0FJUDhILEVBQUdDLEtBQUssWUFBWSxHQUNwQkQsRUFBRzVELFFBQVEsYUFBYXRCLFlBQVksZ0JBQ3BDa0YsRUFBR3hELElBQUlxRCxHQUFPSyxTQUVGLFlBQVJOLEdBQTZCLFVBQVJBLEdBQWlCLENBQ3RDLElBQUlPLEVBQU16SixFQUFFLElBQU1xSixFQUFVLElBQU1ILFFBQ0osSUFBbkJqSixPQUFPeUosUUFDZEQsRUFBSUUsUUFBUSxNQUFPUixRQUNXLElBQWhCbkosRUFBRTRKLEdBQUdDLE9BRW5CSixFQUFJM0QsSUFBSXFELEdBQU90RSxRQUFRLGtCQUd2QjRFLEVBQUlELGNBTXBCeEosRUFBR1UsU0FBU0MsTUFBT2tFLFFBQVMsc0JBU3BDZ0QsZ0NBQWlDLFNBQVdDLEVBQU1DLEdBQzlDM0csUUFBUUMsSUFBSyxrQ0FBbUN5RyxFQUFNQyxJQVUxRHJGLFNBQVUsU0FBV2lGLEVBQUlqRyxHQUdyQixPQUZBTixRQUFRVyxLQUFNTCxHQUVQMUIsRUFBRXlJLEtBQU0sQ0FDWEMsS0FBTSxPQUNOeEIsSUFBSzlFLDBCQUEwQnVHLFNBQy9CakgsS0FBTSxDQUNGa0gsT0FBUSwyQkFDUkMsTUFBT3pHLDBCQUEwQnlHLE1BQ2pDbEIsR0FBSUEsRUFDSmpHLEtBQU1vSSxLQUFLQyxVQUFXckksSUFFMUJvSCxTQUFVLFVBSWxCckcsUUFBUyxTQUFXZixHQUNoQk4sUUFBUUMsSUFBSyxVQUFXSyxJQUc1QnNJLGFBQWMsU0FBVUMsR0FDcEJqSyxFQUFHLCtFQUFnRmdELFNBQ25GOUMsa0JBQWtCRyxLQUFLNkosUUFBUyx5RUFBMkVELEVBQWdCLFVBQzNIL0osa0JBQWtCRyxLQUFLK0QsWUFBYSxjQUFlVCxVQUNuRHpELGtCQUFrQkcsS0FBSzBDLEtBQU0sdUNBQXdDOEIsUUFBUyxZQUFhc0YsT0FDM0ZqSyxrQkFBa0JrSyxvQkFDbEJwSyxFQUFHVSxTQUFTQyxNQUFPa0UsUUFBUyxtQkFFaEN1RixrQkFBbUIsV0FDZixJQUFJQyxFQUFnQnJLLEVBQUcsaUZBQ2hCcUssRUFBYzdJLFNBQ2pCNkksRUFBZ0JySyxFQUFHLG1CQUd2QkEsRUFBRW9LLGtCQUFtQkMsSUFFekJDLGtCQUFtQixXQUNmdEssRUFBRyw0RUFBNkVnQixRQUVwRkMsa0JBQW1CLFdBQ2ZqQixFQUFHLDRFQUE2RThDLFNBSXhGOUMsRUFBRVUsVUFBVTZKLE1BQU8sV0FDZnJLLGtCQUFrQkUsS0FBTUosRUFBRyIsImZpbGUiOiJjaGVja291dC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgd2NfY2hlY2tvdXRfcGFyYW1zICovXG5qUXVlcnkoIGZ1bmN0aW9uKCAkICkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIE9iamVjdCB0byBoYW5kbGUgUGF5RXggY2hlY2tvdXQgcGF5bWVudCBmb3Jtcy5cbiAgICAgKi9cbiAgICB3aW5kb3cud2NfcGF5ZXhfY2hlY2tvdXQgPSB7XG4gICAgICAgIHhocjogZmFsc2UsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemUgZSBoYW5kbGVycyBhbmQgVUkgc3RhdGUuXG4gICAgICAgICAqL1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggZm9ybSApIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybSAgICAgICAgID0gZm9ybTtcbiAgICAgICAgICAgIHRoaXMuZm9ybV9zdWJtaXQgID0gZmFsc2U7XG5cbiAgICAgICAgICAgICQoIHRoaXMuZm9ybSApXG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGJpbmQgZGlyZWN0bHkgdG8gdGhlIGNsaWNrIChhbmQgbm90IGNoZWNrb3V0X3BsYWNlX29yZGVyX3BheWV4X2NoZWNrb3V0KSB0byBhdm9pZCBwb3B1cCBibG9ja2Vyc1xuICAgICAgICAgICAgLy8gZXNwZWNpYWxseSBvbiBtb2JpbGUgZGV2aWNlcyAobGlrZSBvbiBDaHJvbWUgZm9yIGlPUykgZnJvbSBibG9ja2luZyBwYXlleF9jaGVja291dChwYXltZW50X2lkLCB7fSwgJ29wZW4nKTsgZnJvbSBvcGVuaW5nIGEgdGFiXG4gICAgICAgICAgICAgICAgLm9uKCAnY2xpY2snLCAnI3BsYWNlX29yZGVyJywgdGhpcy5vblN1Ym1pdCApXG5cbiAgICAgICAgICAgICAgICAvLyBXb29Db21tZXJjZSBsZXRzIHVzIHJldHVybiBhIGZhbHNlIG9uIGNoZWNrb3V0X3BsYWNlX29yZGVyX3tnYXRld2F5fSB0byBrZWVwIHRoZSBmb3JtIGZyb20gc3VibWl0dGluZ1xuICAgICAgICAgICAgICAgIC5vbiggJ3N1Ym1pdCBjaGVja291dF9wbGFjZV9vcmRlcl9wYXlleF9jaGVja291dCcgKTtcblxuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLmJpbmQoICd1cGRhdGVfY2hlY2tvdXQnLCB0aGlzLm9uVXBkYXRlQ2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ2NoZWNrb3V0X2Vycm9yJywgdGhpcy5yZXNldENoZWNrb3V0ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICd1cGRhdGVkX2NoZWNrb3V0JywgdGhpcy5vblVwZGF0ZWRDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnYmx1cicsIHRoaXMub25VcGRhdGVkQ2hlY2tvdXQgKTtcblxuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnY2xpY2snLCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEhpZGUgXCJDaGFuZ2Ugc2hpcHBpbmcgaW5mb1wiIGJ1dHRvblxuICAgICAgICAgICAgICAgICQoICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nICkuaGlkZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBBZGRyZXNzIEZpZWxkc1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnNob3dBZGRyZXNzRmllbGRzKCk7XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgSW5zdGFudCBDaGVja291dFxuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXRJbnN0YW50Q2hlY2tvdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAqL1xuICAgICAgICBpbml0SW5zdGFudENoZWNrb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ0luaXRpYWxpemF0aW9uIG9mIEluc3RhbnQgQ2hlY2tvdXQuLi4nICk7XG5cbiAgICAgICAgIFx0Ly8kKCBkb2N1bWVudC5ib2R5ICkuYmluZCggJ2luaXRfY2hlY2tvdXQnLCB0aGlzLmluaXRfY2hlY2tvdXQgKTtcblxuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5oaWRlQWRkcmVzc0ZpZWxkcygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVc2Ugc2F2ZWQgY29uc3VtZXJQcm9maWxlUmVmXG4gICAgICAgICAgICBsZXQgY29uc3VtZXJQcm9maWxlRWxtID0gJCggJyNwYXlleC1jb25zdW1lci1wcm9maWxlJyApO1xuICAgICAgICAgICAgaWYgKCBjb25zdW1lclByb2ZpbGVFbG0ubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVmZXJlbmNlID0gY29uc3VtZXJQcm9maWxlRWxtLmRhdGEoICdyZWZlcmVuY2UnICk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdJbml0aWF0ZSBjb25zdW1lclByb2ZpbGVSZWYnLCByZWZlcmVuY2UgKTtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5pbml0Q2hlY2tvdXQoIHJlZmVyZW5jZSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbml0aWF0ZSBjaGVja2luXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgcGF5ZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC53YWl0Rm9yTG9hZGluZygncGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcicsIGZ1bmN0aW9uICggZXJyICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGVyciApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggZXJyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBJbml0IFBheUV4IGhvc3RlZFZpZXdcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnBheWV4Lmhvc3RlZFZpZXcuY29uc3VtZXIoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJ3BheWV4LWNoZWNraW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VsdHVyZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgICAgICAgICAgb25Db25zdW1lcklkZW50aWZpZWQ6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaG9zdGVkVmlldzogb25Db25zdW1lcklkZW50aWZpZWQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25Db25zdW1lcklkZW50aWZpZWQoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkJpbGxpbmdEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkFkZHJlc3NEZXRhaWxzQXZhaWxhYmxlKCAnYmlsbGluZycsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBvblNoaXBwaW5nRGV0YWlsc0F2YWlsYWJsZTogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ3NoaXBwaW5nJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2dFcnJvciggJ3BheWV4LWNoZWNraW4nLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIGRhdGEuZGV0YWlscyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQub25FcnJvciggZGF0YS5kZXRhaWxzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gKS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdENoZWNrb3V0OiBmdW5jdGlvbiggcmVmZXJlbmNlICkge1xuICAgICAgICAgICAgLy8gU2hvdyBcIkNoYW5nZSBzaGlwcGluZyBpbmZvXCIgYnV0dG9uXG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5maW5kKCAnLnBheWV4X2N1c3RvbWVyX3JlZmVyZW5jZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uYXBwZW5kKCBcIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGNsYXNzPSdwYXlleF9jdXN0b21lcl9yZWZlcmVuY2UnIG5hbWU9J3BheWV4X2N1c3RvbWVyX3JlZmVyZW5jZScgdmFsdWU9J1wiICsgcmVmZXJlbmNlICsgXCInLz5cIiApO1xuXG4gICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0LmZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vblN1Ym1pdCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzSW5zdGFudENoZWNrb3V0KCkge1xuICAgICAgICAgICAgcmV0dXJuIFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuaW5zdGFudF9jaGVja291dDtcbiAgICAgICAgfSxcblxuICAgICAgICBpc0NoZWNraW5FbmFibGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuIFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuY2hlY2tpbjtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1BheW1lbnRNZXRob2RDaG9zZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoICcjcGF5bWVudF9tZXRob2RfcGF5ZXhfY2hlY2tvdXQnICkuaXMoICc6Y2hlY2tlZCcgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBibG9jazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgZm9ybV9kYXRhID0gd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5kYXRhKCk7XG4gICAgICAgICAgICBpZiAoIDEgIT09IGZvcm1fZGF0YVsnYmxvY2tVSS5pc0Jsb2NrZWQnXSApIHtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLmJsb2NrKHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmxheUNTUzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJyNmZmYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1bmJsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0udW5ibG9jaygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQudW5ibG9jaygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdSZWFkeScgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblVwZGF0ZUNoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVDaGVja291dCcgKTtcblxuICAgICAgICAgICAgaWYgKCAhIHdjX3BheWV4X2NoZWNrb3V0LmlzSW5zdGFudENoZWNrb3V0KCkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBAdG9kb1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uVXBkYXRlZENoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVkQ2hlY2tvdXQnICk7XG5cbiAgICAgICAgICAgIGlmICggISB3Y19wYXlleF9jaGVja291dC5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5mb3JtLmlzKCAnLnByb2Nlc3NpbmcnICkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICEgd2NfcGF5ZXhfY2hlY2tvdXQudmFsaWRhdGVGb3JtKCkgKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZWRDaGVja291dDogVmFsaWRhdGlvbiBpcyBmYWlsZWQnICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LnhociApIHtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC54aHIuYWJvcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uYWRkQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuYmxvY2soKTtcblxuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQueGhyID0gd2NfcGF5ZXhfY2hlY2tvdXQudXBkYXRlT3JkZXIoKVxuICAgICAgICAgICAgICAgIC5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlciBlcnJvcjonICsgdGV4dFN0YXR1cyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueGhyID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnJlc3VsdCAhPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0cnVlID09PSByZXNwb25zZS5yZXN1bHQucmVsb2FkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgdXBkYXRlIGluIGNhc2Ugd2UgbmVlZCBhIGZyZXNoIG5vbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWZyZXNoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAndXBkYXRlX2NoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCByZXNwb25zZS5tZXNzYWdlcyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5mb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQHRvZG8gUmVmcmVzaFxuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5yZWZyZXNoUGF5bWVudE1lbnUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBMb2FkIFBheUV4IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggcmVzcG9uc2VbJ2pzX3VybCddIClcbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uKCBlICkge1xuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5mb3JtX3N1Ym1pdCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5pc1BheW1lbnRNZXRob2RDaG9zZW4oKSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggISB3Y19wYXlleF9jaGVja291dC52YWxpZGF0ZUZvcm0oKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25TdWJtaXQnICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uaXMoICcucHJvY2Vzc2luZycgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQsIC53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5hZGRDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuYmxvY2soKTtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5wbGFjZU9yZGVyKClcbiAgICAgICAgICAgICAgICAgICAgLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQudW5ibG9jaygpO1xuICAgICAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAgICAgLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uRXJyb3IoIHRleHRTdGF0dXMgKTtcbiAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIC5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggcmVzcG9uc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UucmVzdWx0ICE9PSAnc3VjY2VzcycgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWxvYWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgdXBkYXRlIGluIGNhc2Ugd2UgbmVlZCBhIGZyZXNoIG5vbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0cnVlID09PSByZXNwb25zZS5yZXN1bHQucmVmcmVzaCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgUGF5RXggQ2hlY2tvdXQgZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXRQYXltZW50SlMoIHJlc3BvbnNlWydqc191cmwnXSApO1xuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0Q2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybV9zdWJtaXQgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICB2YWxpZGF0ZUZvcm06IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkcmVxdWlyZWRfaW5wdXRzLFxuICAgICAgICAgICAgICAgIHZhbGlkYXRlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB3ZSBuZWVkIHRvIHZhbGlkYXRlIHNoaXBwaW5nIGFkZHJlc3NcbiAgICAgICAgICAgIGlmICggJCggJyNzaGlwLXRvLWRpZmZlcmVudC1hZGRyZXNzLWNoZWNrYm94JyApLmlzKCAnOmNoZWNrZWQnICkgKSB7XG4gICAgICAgICAgICAgICAgJHJlcXVpcmVkX2lucHV0cyA9ICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHMgLnZhbGlkYXRlLXJlcXVpcmVkLCAud29vY29tbWVyY2Utc2hpcHBpbmctZmllbGRzIC52YWxpZGF0ZS1yZXF1aXJlZCcgKS5maW5kKCdpbnB1dCwgc2VsZWN0Jykubm90KCAkKCAnI2FjY291bnRfcGFzc3dvcmQsICNhY2NvdW50X3VzZXJuYW1lJyApICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRyZXF1aXJlZF9pbnB1dHMgPSAkKCAnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzIC52YWxpZGF0ZS1yZXF1aXJlZCcgKS5maW5kKCdpbnB1dCwgc2VsZWN0Jykubm90KCAkKCAnI2FjY291bnRfcGFzc3dvcmQsICNhY2NvdW50X3VzZXJuYW1lJyApICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggJHJlcXVpcmVkX2lucHV0cy5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgJHJlcXVpcmVkX2lucHV0cy5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCggdGhpcyApLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHBhcmVudCAgICAgICAgICAgPSAkdGhpcy5jbG9zZXN0KCAnLmZvcm0tcm93JyApLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVfcmVxdWlyZWQgPSAkcGFyZW50LmlzKCAnLnZhbGlkYXRlLXJlcXVpcmVkJyApLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVfZW1haWwgICAgPSAkcGFyZW50LmlzKCAnLnZhbGlkYXRlLWVtYWlsJyApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggdmFsaWRhdGVfcmVxdWlyZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICdjaGVja2JveCcgPT09ICR0aGlzLmF0dHIoICd0eXBlJyApICYmICEgJHRoaXMuaXMoICc6Y2hlY2tlZCcgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICR0aGlzLnZhbCgpID09PSAnJyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICggdmFsaWRhdGVfZW1haWwgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoICR0aGlzLnZhbCgpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzI4NTU4NjUvanF1ZXJ5LXZhbGlkYXRlLWUtbWFpbC1hZGRyZXNzLXJlZ2V4ICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKC9eKCgoW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKyhcXC4oW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKykqKXwoKFxceDIyKSgoKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KChbXFx4MDEtXFx4MDhcXHgwYlxceDBjXFx4MGUtXFx4MWZcXHg3Zl18XFx4MjF8W1xceDIzLVxceDViXXxbXFx4NWQtXFx4N2VdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoXFxcXChbXFx4MDEtXFx4MDlcXHgwYlxceDBjXFx4MGQtXFx4N2ZdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpKSooKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KFxceDIyKSkpQCgoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4pKygoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKVxcLj8kL2kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISBwYXR0ZXJuLnRlc3QoICR0aGlzLnZhbCgpICApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRlZDtcbiAgICAgICAgfSxcblxuICAgICAgICB3YWl0Rm9yTG9hZGluZzogZnVuY3Rpb24gKCB2YXJfc3RyaW5nLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGV2YWwoIHZhcl9zdHJpbmcgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayggZSApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICAgICAgICAgIGxldCB0aW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygb2JqICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBudWxsLCBvYmogKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhdHRlbXB0cysrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIGF0dGVtcHRzID49IDEyMCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCB0aW1lciApO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soICdUaW1lb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgNTAwICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvYWQgSlNcbiAgICAgICAgICogQHBhcmFtIGpzXG4gICAgICAgICAqIEBwYXJhbSBjYWxsYmFja1xuICAgICAgICAgKi9cbiAgICAgICAgbG9hZEpzOiBmdW5jdGlvbiAoIGpzLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnTG9hZGluZyBvZiAnICsganMgKTtcbiAgICAgICAgICAgIC8vIENyZWF0ZXMgYSBuZXcgc2NyaXB0IHRhZ1xuICAgICAgICAgICAgbGV0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzY3JpcHQnICk7XG5cbiAgICAgICAgICAgIC8vIFNldCBzY3JpcHQgdGFnIHBhcmFtc1xuICAgICAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZSggJ3NyYycsIGpzICk7XG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCAndHlwZScsICd0ZXh0L2phdmFzY3JpcHQnICk7XG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCAnYXN5bmMnLCAnJyApO1xuICAgICAgICAgICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnTG9hZGVkOiAnICsganMgKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSwgZmFsc2UgKTtcblxuICAgICAgICAgICAgLy8gR2V0cyBkb2N1bWVudCBoZWFkIGVsZW1lbnRcbiAgICAgICAgICAgIGxldCBvSGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCAnaGVhZCcgKVswXTtcbiAgICAgICAgICAgIGlmICggb0hlYWQgKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIHNjcmlwdCB0YWcgdG8gaGVhZFxuICAgICAgICAgICAgICAgIG9IZWFkLmFwcGVuZENoaWxkKCBzY3JpcHQgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHNjcmlwdDtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGUgUGF5bWVudCBKYXZhc2NyaXB0XG4gICAgICAgICAqIEBwYXJhbSB1cmxcbiAgICAgICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICBpbml0UGF5bWVudEpTOiBmdW5jdGlvbiAoIHVybCwgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjYWxsYmFjayA9PT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9hZEpzKCB1cmwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCAnI3BheW1lbnQtcGF5ZXgtY2hlY2tvdXQgaWZyYW1lJyApLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQuaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BheW1lbnQnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXRQYXltZW50TWVudSgncGF5bWVudC1wYXlleC1jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkLmZlYXRoZXJsaWdodCggJzxkaXYgaWQ9XCJwYXlleC1wYXltZW50bWVudVwiPiZuYnNwOzwvZGl2PicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6ICdmZWF0aGVybGlnaHQtcGF5ZXgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25DbGljazogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uRXNjOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXRQYXltZW50TWVudSgncGF5ZXgtcGF5bWVudG1lbnUnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApLnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKClcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGUgUGF5bWVudCBNZW51LlxuICAgICAgICAgKiBQYXltZW50IEphdmFzY3JpcHQgbXVzdCBiZSBsb2FkZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBpZFxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdFBheW1lbnRNZW51OiBmdW5jdGlvbiAoIGlkICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdpbml0UGF5bWVudE1lbnUnICk7XG5cbiAgICAgICAgICAgIC8vIExvYWQgUGF5RXggQ2hlY2tvdXQgZnJhbWVcbiAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUgPSB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5wYXltZW50TWVudSgge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogaWQsXG4gICAgICAgICAgICAgICAgY3VsdHVyZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkKCBkYXRhLm5hbWUsIGRhdGEuaW5zdHJ1bWVudCApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50Q3JlYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENyZWF0ZWQnICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDb21wbGV0ZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRDb21wbGV0ZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb24uaHJlZiA9IGRhdGEucmVkaXJlY3RVcmw7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDYW5jZWxlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENhbmNlbGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2dFcnJvciggJ3BheW1lbnQtbWVudS1jYW5jZWwnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRGYWlsZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRGYWlsZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWZhaWxlZCcsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmxvY2F0aW9uLmhyZWYgPSBkYXRhLnJlZGlyZWN0VXJsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2dFcnJvciggJ3BheW1lbnQtbWVudS1lcnJvcicsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUub3BlbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWZyZXNoXG4gICAgICAgICAqL1xuICAgICAgICByZWZyZXNoUGF5bWVudE1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdyZWZyZXNoUGF5bWVudE1lbnUnICk7XG4gICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51LnJlZnJlc2goKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGxhY2UgT3JkZXJcbiAgICAgICAgICogQHJldHVybiB7SlF1ZXJ5UHJvbWlzZTxhbnk+fVxuICAgICAgICAgKi9cbiAgICAgICAgcGxhY2VPcmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdwbGFjZU9yZGVyJyApO1xuICAgICAgICAgICAgbGV0IGZpZWxkcyA9ICQoJy53b29jb21tZXJjZS1jaGVja291dCcpLnNlcmlhbGl6ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BheWV4X3BsYWNlX29yZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZpZWxkc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3VsdCcpICYmIHJlc3BvbnNlLnJlc3VsdCA9PT0gJ2ZhaWx1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvZ0Vycm9yKCdwYXlleC1wbGFjZS1vcmRlcicsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSBPcmRlclxuICAgICAgICAgKiBAcmV0dXJuIHtKUXVlcnlQcm9taXNlPGFueT59XG4gICAgICAgICAqL1xuICAgICAgICB1cGRhdGVPcmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlcicgKTtcbiAgICAgICAgICAgIGxldCBmaWVsZHMgPSAkKCcud29vY29tbWVyY2UtY2hlY2tvdXQnKS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwYXlleF91cGRhdGVfb3JkZXInLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmllbGRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVzdWx0JykgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnZmFpbHVyZScpIHtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9nRXJyb3IoJ3BheWV4LXVwZGF0ZS1vcmRlcicsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9uIENvbnN1bWVyIElkZW50aWZpZWRcbiAgICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgICAqL1xuICAgICAgICBvbkNvbnN1bWVySWRlbnRpZmllZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvbkNvbnN1bWVySWRlbnRpZmllZCcsIGRhdGEgKTtcbiAgICAgICAgICAgICQoICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nICkuc2hvdygpO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BheWV4X2NoZWNrb3V0X2N1c3RvbWVyX3Byb2ZpbGUnLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgY29uc3VtZXJQcm9maWxlUmVmOiBkYXRhLmNvbnN1bWVyUHJvZmlsZVJlZlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0aWF0ZSBDaGVja291dFxuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXRDaGVja291dCggZGF0YS5jb25zdW1lclByb2ZpbGVSZWYgKTtcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT24gQWRkcmVzcyBEZXRhaWxzIEF2YWlsYWJsZVxuICAgICAgICAgKiBAcGFyYW0gdHlwZVxuICAgICAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIG9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGU6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvbkFkZHJlc3NEZXRhaWxzQXZhaWxhYmxlJywgdHlwZSwgZGF0YSApO1xuXG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwYXlleF9jaGVja291dF9nZXRfYWRkcmVzcycsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IGRhdGEudXJsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9nRXJyb3IoJ3BheWV4LWFkZHJlc3MtZGV0YWlscycsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYWRkcmVzc1xuICAgICAgICAgICAgICAgIGxldCBkYXRhID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAkLmVhY2goZGF0YSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgW3R5cGVdLmZvckVhY2goZnVuY3Rpb24oc2VjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVsID0gJCgnaW5wdXRbbmFtZT1cIicgKyBzZWN0aW9uICsgJ18nICsga2V5ICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZWwucHJvcCgncmVhZG9ubHknLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5jbG9zZXN0KCcuZm9ybS1yb3cnKS5yZW1vdmVDbGFzcygncGF5ZXgtbG9ja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC52YWwodmFsdWUpLmNoYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnY291bnRyeScgfHwga2V5ID09PSAnc3RhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVsMSA9ICQoJyMnICsgc2VjdGlvbiArICdfJyArIGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuU2VsZWN0MiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLnNlbGVjdDIoJ3ZhbCcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAkLmZuLmNob3NlbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hvc2VuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsMS52YWwodmFsdWUpLnRyaWdnZXIoJ2Nob3Nlbjp1cGRhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWwxLmNob3NlbigpLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsMS5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9uIFBheW1lbnQgTWVudSBJbnN0cnVtZW50IFNlbGVjdGVkXG4gICAgICAgICAqIEBwYXJhbSBuYW1lXG4gICAgICAgICAqIEBwYXJhbSBpbnN0cnVtZW50XG4gICAgICAgICAqL1xuICAgICAgICBvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkOiBmdW5jdGlvbiAoIG5hbWUsIGluc3RydW1lbnQgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQnLCBuYW1lLCBpbnN0cnVtZW50ICk7XG4gICAgICAgICAgICAvLyBAdG9kb1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2cgRXJyb3JcbiAgICAgICAgICogQHBhcmFtIGlkXG4gICAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICAgKi9cbiAgICAgICAgbG9nRXJyb3I6IGZ1bmN0aW9uICggaWQsIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oIGRhdGEgKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwYXlleF9jaGVja291dF9sb2dfZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSggZGF0YSApXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvbkVycm9yJywgZGF0YSApO1xuICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5zdWJtaXRfZXJyb3IoICc8ZGl2IGNsYXNzPVwid29vY29tbWVyY2UtZXJyb3JcIj4nICsgZGF0YSArICc8L2Rpdj4nICk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdF9lcnJvcjogZnVuY3Rpb24oIGVycm9yX21lc3NhZ2UgKSB7XG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5wcmVwZW5kKCAnPGRpdiBjbGFzcz1cIndvb2NvbW1lcmNlLU5vdGljZUdyb3VwIHdvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0XCI+JyArIGVycm9yX21lc3NhZ2UgKyAnPC9kaXY+JyApO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICkudW5ibG9jaygpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5maW5kKCAnLmlucHV0LXRleHQsIHNlbGVjdCwgaW5wdXQ6Y2hlY2tib3gnICkudHJpZ2dlciggJ3ZhbGlkYXRlJyApLmJsdXIoKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnNjcm9sbF90b19ub3RpY2VzKCk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ2NoZWNrb3V0X2Vycm9yJyApO1xuICAgICAgICB9LFxuICAgICAgICBzY3JvbGxfdG9fbm90aWNlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsRWxlbWVudCA9ICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtdXBkYXRlT3JkZXJSZXZpZXcsIC53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCcgKTtcbiAgICAgICAgICAgIGlmICggISBzY3JvbGxFbGVtZW50Lmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxFbGVtZW50ID0gJCggJy5mb3JtLmNoZWNrb3V0JyApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLnNjcm9sbF90b19ub3RpY2VzKCBzY3JvbGxFbGVtZW50ICk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGVBZGRyZXNzRmllbGRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzX19maWVsZC13cmFwcGVyLCAud29vY29tbWVyY2Utc2hpcHBpbmctZmllbGRzJyApLmhpZGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd0FkZHJlc3NGaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHNfX2ZpZWxkLXdyYXBwZXIsIC53b29jb21tZXJjZS1zaGlwcGluZy1maWVsZHMnICkuc2hvdygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmluaXQoICQoIFwiZm9ybS5jaGVja291dCwgZm9ybSNvcmRlcl9yZXZpZXcsIGZvcm0jYWRkX3BheW1lbnRfbWV0aG9kXCIgKSApO1xuICAgIH0gKTtcbn0pO1xuXG4iXX0=
