jQuery(function($){"use strict";window.wc_payex_checkout={js_url:null,paymentMenu:null,isPaymentMenuLoaded:!1,xhr:!1,init:function(e){this.form=e,this.form_submit=!1,$(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_payex_checkout"),$(document.body).bind("update_checkout",this.onUpdateCheckout),$(document.body).on("checkout_error",this.resetCheckout),$(document.body).on("updated_checkout",this.onUpdatedCheckout),$(document.body).on("blur",this.onUpdatedCheckout),$(document.body).on("click","#change-shipping-info",function(){$("#change-shipping-info").hide(),wc_payex_checkout.showAddressFields()}),wc_payex_checkout.isInstantCheckout()&&wc_payex_checkout.initInstantCheckout()},initInstantCheckout:function(){console.log("Initialization of Instant Checkout..."),wc_payex_checkout.isCheckinEnabled()&&wc_payex_checkout.hideAddressFields();let e=$("#payex-consumer-profile");if(e.length>0){let o=e.data("reference");console.log("Initiate consumerProfileRef",o),wc_payex_checkout.initCheckout(o)}else wc_payex_checkout.initCheckIn()},initCheckIn:function(){"undefined"!=typeof payex&&wc_payex_checkout.waitForLoading("payex.hostedView.consumer",function(e){e?console.warn(e):window.payex.hostedView.consumer({container:"payex-checkin",culture:WC_Gateway_PayEx_Checkout.culture,style:WC_Gateway_PayEx_Checkout.checkInStyle?JSON.parse(WC_Gateway_PayEx_Checkout.checkInStyle):null,onConsumerIdentified:function(e){console.log("hostedView: onConsumerIdentified"),wc_payex_checkout.onConsumerIdentified(e)},onBillingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("billing",e)},onShippingDetailsAvailable:function(e){wc_payex_checkout.onAddressDetailsAvailable("shipping",e)},onError:function(e){wc_payex_checkout.logError("payex-checkin",e),alert(e.details)}}).open()})},initCheckout:function(e){$("#change-shipping-info").show(),wc_payex_checkout.form.find(".payex_customer_reference").remove(),wc_payex_checkout.form.append("<input type='hidden' class='payex_customer_reference' name='payex_customer_reference' value='"+e+"'/>"),wc_payex_checkout.onSubmit()},isInstantCheckout:()=>WC_Gateway_PayEx_Checkout.instant_checkout,isCheckinEnabled:()=>WC_Gateway_PayEx_Checkout.checkin,isPaymentMethodChosen:function(){return $("#payment_method_payex_checkout").is(":checked")},block:function(){1!==wc_payex_checkout.form.data()["blockUI.isBlocked"]&&wc_payex_checkout.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){wc_payex_checkout.form.unblock()},onClose:function(){wc_payex_checkout.unblock()},onReady:function(){console.log("Ready")},onUpdateCheckout:function(){if(console.log("onUpdateCheckout"),!wc_payex_checkout.isInstantCheckout())return!1},onUpdatedCheckout:function(){return console.log("onUpdatedCheckout"),!!wc_payex_checkout.isInstantCheckout()&&(!wc_payex_checkout.form.is(".processing")&&(wc_payex_checkout.validateForm()?(wc_payex_checkout.xhr&&wc_payex_checkout.xhr.abort(),$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),void(wc_payex_checkout.xhr=wc_payex_checkout.updateOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o),wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),this.xhr=!1,"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.js_url=e.js_url,wc_payex_checkout.refreshPaymentMenu()}))):(console.log("onUpdatedCheckout: Validation is failed"),!1)))},onSubmit:function(e){return!!wc_payex_checkout.form_submit||(!wc_payex_checkout.isPaymentMethodChosen()||(void 0!==e&&e.preventDefault(),!!wc_payex_checkout.validateForm()&&(console.log("onSubmit"),!wc_payex_checkout.form.is(".processing")&&($(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.addClass("processing"),wc_payex_checkout.block(),wc_payex_checkout.placeOrder().always(function(e){wc_payex_checkout.form.removeClass("processing"),wc_payex_checkout.unblock()}).fail(function(e,o){wc_payex_checkout.onError(o)}).done(function(e){if(console.log(e),"success"!==e.result)return!0===e.result.reload?void window.location.reload():(!0===e.result.refresh&&$(document.body).trigger("update_checkout"),void wc_payex_checkout.onError(e.messages));wc_payex_checkout.js_url=e.js_url,wc_payex_checkout.initPaymentJS(wc_payex_checkout.js_url)}),!1))))},resetCheckout:function(){wc_payex_checkout.form_submit=!1},validateForm:function(){var e,o=!0;return(e=$("#ship-to-different-address-checkbox").is(":checked")?$(".woocommerce-billing-fields .validate-required, .woocommerce-shipping-fields .validate-required").find("input, select").not($("#account_password, #account_username")):$(".woocommerce-billing-fields .validate-required").find("input, select").not($("#account_password, #account_username"))).length&&e.each(function(){var e=$(this),c=e.closest(".form-row"),t=c.is(".validate-required"),n=c.is(".validate-email");(t&&("checkbox"!==e.attr("type")||e.is(":checked")?""===e.val()&&(o=!1):o=!1),n)&&(e.val()&&(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(e.val())||(o=!1)))}),o},waitForLoading:function(var_string,callback){try{var obj=eval(var_string)}catch(e){return void callback(e)}let attempts=0,timer=window.setInterval(function(){void 0!==obj?(window.clearInterval(timer),callback(null,obj)):++attempts>=120&&(window.clearInterval(timer),callback("Timeout"))},500)},loadJs:function(e,o){console.log("Loading of "+e);let c=document.createElement("script");c.setAttribute("src",e),c.setAttribute("type","text/javascript"),c.setAttribute("async",""),c.addEventListener("load",function(){console.log("Loaded: "+e),o()},!1);let t=document.getElementsByTagName("head")[0];return t&&t.appendChild(c),c},initPaymentJS:function(e,o){void 0===o&&(o=function(){}),window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&(void 0!==window.payex.hostedView.paymentMenu&&window.payex.hostedView.paymentMenu().close(),$("#payment-payex-checkout iframe").remove()),$("script[src*='px.paymentmenu.client']").remove(),wc_payex_checkout.loadJs(e,function(){$("#payment-payex-checkout iframe").remove(),wc_payex_checkout.isInstantCheckout()?($("#payment").hide(),wc_payex_checkout.initPaymentMenu("payment-payex-checkout")):$.featherlight('<div id="payex-paymentmenu">&nbsp;</div>',{variant:"featherlight-payex",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_payex_checkout.initPaymentMenu("payex-paymentmenu")},afterClose:function(){wc_payex_checkout.form.removeClass("processing").unblock()}}),o()})},initPaymentMenu:function(e,o){console.log("initPaymentMenu"),void 0===o&&(o=function(){}),this.paymentMenu=window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_PayEx_Checkout.culture,style:WC_Gateway_PayEx_Checkout.paymentMenuStyle?JSON.parse(WC_Gateway_PayEx_Checkout.paymentMenuStyle):null,onApplicationConfigured:function(e){console.log("onApplicationConfigured"),console.log(e),wc_payex_checkout.isPaymentMenuLoaded=!0,o(null)},onPaymentMenuInstrumentSelected:function(e){console.log("onPaymentMenuInstrumentSelected"),console.log(e),wc_payex_checkout.onPaymentMenuInstrumentSelected(e.name,e.instrument)},onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentCanceled:function(e){console.log("onPaymentCanceled"),console.log(e),wc_payex_checkout.logError("payment-menu-cancel",e)},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e),wc_payex_checkout.logError("payment-menu-failed",e)},onError:function(e){wc_payex_checkout.logError("payment-menu-error",e),o(e)}}),this.paymentMenu.open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),wc_payex_checkout.initPaymentJS(wc_payex_checkout.js_url)},placeOrder:function(){console.log("placeOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_place_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"}).done(function(e){e.hasOwnProperty("result")&&"failure"===e.result&&wc_payex_checkout.logError("payex-place-order",e)})},updateOrder:function(){console.log("updateOrder");let e=$(".woocommerce-checkout").serialize();return $.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_update_order",nonce:WC_Gateway_PayEx_Checkout.nonce,data:e},dataType:"json"}).done(function(e){e.hasOwnProperty("result")&&"failure"===e.result&&(e.messages.indexOf("Order update is not available.")>-1&&console.warn("refreshPaymentMenu: refresh workaround. Force reload."),wc_payex_checkout.logError("payex-update-order",e))})},onConsumerIdentified:function(e){return console.log("onConsumerIdentified",e),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_customer_profile",nonce:WC_Gateway_PayEx_Checkout.nonce,consumerProfileRef:e.consumerProfileRef},dataType:"json"}).always(function(e){}).done(function(o){console.log(o),o.success?wc_payex_checkout.initCheckout(e.consumerProfileRef):alert(o.data.message)})},onAddressDetailsAvailable:function(e,o){return console.log("onAddressDetailsAvailable",e,o),$("#change-shipping-info").show(),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_get_address",nonce:WC_Gateway_PayEx_Checkout.nonce,type:e,url:o.url},dataType:"json"}).always(function(e){}).done(function(o){if(console.log(o),!o.success)return wc_payex_checkout.logError("payex-address-details",o),void alert(o.data.message);let c=o.data;$.each(c,function(o,c){[e].forEach(function(e){let t=$('input[name="'+e+"_"+o+'"]');if(0!==t.length&&(t.prop("readonly",!1),t.closest(".form-row").removeClass("payex-locked"),t.val(c).change(),"country"===o||"state"===o)){let t=$("#"+e+"_"+o);void 0!==window.Select2?t.select2("val",c):void 0!==$.fn.chosen?t.val(c).trigger("chosen:updated"):t.change()}})}),$(document.body).trigger("update_checkout")})},onPaymentMenuInstrumentSelected:function(e,o){console.log("onPaymentMenuInstrumentSelected",e,o)},logError:function(e,o){return console.warn(o),$.ajax({type:"POST",url:WC_Gateway_PayEx_Checkout.ajax_url,data:{action:"payex_checkout_log_error",nonce:WC_Gateway_PayEx_Checkout.nonce,id:e,data:JSON.stringify(o)},dataType:"json"})},onError:function(e){console.log("onError",e)},submit_error:function(e){$(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_payex_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),wc_payex_checkout.form.removeClass("processing").unblock(),wc_payex_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_payex_checkout.scroll_to_notices(),$(document.body).trigger("checkout_error")},scroll_to_notices:function(){let e=$(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=$(".form.checkout")),$.scroll_to_notices(e)},hideAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").hide()},showAddressFields:function(){$(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").show()}},$(document).ready(function(){wc_payex_checkout.init($("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrb3V0LmpzIl0sIm5hbWVzIjpbImpRdWVyeSIsIiQiLCJ3aW5kb3ciLCJ3Y19wYXlleF9jaGVja291dCIsImpzX3VybCIsInBheW1lbnRNZW51IiwiaXNQYXltZW50TWVudUxvYWRlZCIsInhociIsImluaXQiLCJmb3JtIiwidGhpcyIsImZvcm1fc3VibWl0Iiwib24iLCJvblN1Ym1pdCIsImRvY3VtZW50IiwiYm9keSIsImJpbmQiLCJvblVwZGF0ZUNoZWNrb3V0IiwicmVzZXRDaGVja291dCIsIm9uVXBkYXRlZENoZWNrb3V0IiwiaGlkZSIsInNob3dBZGRyZXNzRmllbGRzIiwiaXNJbnN0YW50Q2hlY2tvdXQiLCJpbml0SW5zdGFudENoZWNrb3V0IiwiY29uc29sZSIsImxvZyIsImlzQ2hlY2tpbkVuYWJsZWQiLCJoaWRlQWRkcmVzc0ZpZWxkcyIsImNvbnN1bWVyUHJvZmlsZUVsbSIsImxlbmd0aCIsInJlZmVyZW5jZSIsImRhdGEiLCJpbml0Q2hlY2tvdXQiLCJpbml0Q2hlY2tJbiIsInBheWV4Iiwid2FpdEZvckxvYWRpbmciLCJlcnIiLCJ3YXJuIiwiaG9zdGVkVmlldyIsImNvbnN1bWVyIiwiY29udGFpbmVyIiwiY3VsdHVyZSIsIldDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQiLCJzdHlsZSIsImNoZWNrSW5TdHlsZSIsIkpTT04iLCJwYXJzZSIsIm9uQ29uc3VtZXJJZGVudGlmaWVkIiwib25CaWxsaW5nRGV0YWlsc0F2YWlsYWJsZSIsIm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUiLCJvblNoaXBwaW5nRGV0YWlsc0F2YWlsYWJsZSIsIm9uRXJyb3IiLCJsb2dFcnJvciIsImFsZXJ0IiwiZGV0YWlscyIsIm9wZW4iLCJzaG93IiwiZmluZCIsInJlbW92ZSIsImFwcGVuZCIsImluc3RhbnRfY2hlY2tvdXQiLCJjaGVja2luIiwiaXNQYXltZW50TWV0aG9kQ2hvc2VuIiwiaXMiLCJibG9jayIsIm1lc3NhZ2UiLCJvdmVybGF5Q1NTIiwiYmFja2dyb3VuZCIsIm9wYWNpdHkiLCJ1bmJsb2NrIiwib25DbG9zZSIsIm9uUmVhZHkiLCJ2YWxpZGF0ZUZvcm0iLCJhYm9ydCIsImFkZENsYXNzIiwidXBkYXRlT3JkZXIiLCJhbHdheXMiLCJyZXNwb25zZSIsInJlbW92ZUNsYXNzIiwiZmFpbCIsImpxWEhSIiwidGV4dFN0YXR1cyIsImRvbmUiLCJyZXN1bHQiLCJyZWxvYWQiLCJsb2NhdGlvbiIsInJlZnJlc2giLCJ0cmlnZ2VyIiwibWVzc2FnZXMiLCJyZWZyZXNoUGF5bWVudE1lbnUiLCJlIiwicHJldmVudERlZmF1bHQiLCJwbGFjZU9yZGVyIiwiaW5pdFBheW1lbnRKUyIsIiRyZXF1aXJlZF9pbnB1dHMiLCJ2YWxpZGF0ZWQiLCJub3QiLCJlYWNoIiwiJHRoaXMiLCIkcGFyZW50IiwiY2xvc2VzdCIsInZhbGlkYXRlX3JlcXVpcmVkIiwidmFsaWRhdGVfZW1haWwiLCJhdHRyIiwidmFsIiwiUmVnRXhwIiwidGVzdCIsInZhcl9zdHJpbmciLCJjYWxsYmFjayIsIm9iaiIsImV2YWwiLCJhdHRlbXB0cyIsInRpbWVyIiwic2V0SW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwibG9hZEpzIiwianMiLCJzY3JpcHQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9IZWFkIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJhcHBlbmRDaGlsZCIsInVybCIsImhhc093blByb3BlcnR5IiwiY2xvc2UiLCJpbml0UGF5bWVudE1lbnUiLCJmZWF0aGVybGlnaHQiLCJ2YXJpYW50IiwicGVyc2lzdCIsImNsb3NlT25DbGljayIsImNsb3NlT25Fc2MiLCJhZnRlck9wZW4iLCJhZnRlckNsb3NlIiwiaWQiLCJwYXltZW50TWVudVN0eWxlIiwib25BcHBsaWNhdGlvbkNvbmZpZ3VyZWQiLCJvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkIiwibmFtZSIsImluc3RydW1lbnQiLCJvblBheW1lbnRDcmVhdGVkIiwib25QYXltZW50Q29tcGxldGVkIiwic2VsZiIsImhyZWYiLCJyZWRpcmVjdFVybCIsIm9uUGF5bWVudENhbmNlbGVkIiwib25QYXltZW50RmFpbGVkIiwiZmllbGRzIiwic2VyaWFsaXplIiwiYWpheCIsInR5cGUiLCJhamF4X3VybCIsImFjdGlvbiIsIm5vbmNlIiwiZGF0YVR5cGUiLCJpbmRleE9mIiwiY29uc3VtZXJQcm9maWxlUmVmIiwic3VjY2VzcyIsImtleSIsInZhbHVlIiwiZm9yRWFjaCIsInNlY3Rpb24iLCJlbCIsInByb3AiLCJjaGFuZ2UiLCJlbDEiLCJTZWxlY3QyIiwic2VsZWN0MiIsImZuIiwiY2hvc2VuIiwic3RyaW5naWZ5Iiwic3VibWl0X2Vycm9yIiwiZXJyb3JfbWVzc2FnZSIsInByZXBlbmQiLCJibHVyIiwic2Nyb2xsX3RvX25vdGljZXMiLCJzY3JvbGxFbGVtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiJBQUNBQSxPQUFRLFNBQVVDLEdBQ2QsYUFLQUMsT0FBT0Msa0JBQW9CLENBQ3ZCQyxPQUFRLEtBQ1JDLFlBQWEsS0FDYkMscUJBQXFCLEVBQ3JCQyxLQUFLLEVBS0xDLEtBQU0sU0FBVUMsR0FDWkMsS0FBS0QsS0FBZUEsRUFDcEJDLEtBQUtDLGFBQWUsRUFFcEJWLEVBQUdTLEtBQUtELE1BR0hHLEdBQUksUUFBUyxlQUFnQkYsS0FBS0csVUFHbENELEdBQUksOENBRVRYLEVBQUdhLFNBQVNDLE1BQU9DLEtBQU0sa0JBQW1CTixLQUFLTyxrQkFDakRoQixFQUFHYSxTQUFTQyxNQUFPSCxHQUFJLGlCQUFrQkYsS0FBS1EsZUFDOUNqQixFQUFHYSxTQUFTQyxNQUFPSCxHQUFJLG1CQUFvQkYsS0FBS1MsbUJBQ2hEbEIsRUFBR2EsU0FBU0MsTUFBT0gsR0FBSSxPQUFRRixLQUFLUyxtQkFFcENsQixFQUFHYSxTQUFTQyxNQUFPSCxHQUFJLFFBQVMsd0JBQXlCLFdBRXJEWCxFQUFHLHlCQUEwQm1CLE9BRzdCakIsa0JBQWtCa0Isc0JBSWpCbEIsa0JBQWtCbUIscUJB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QUFnQmhMLEVBQUcsaUZBQ2hCZ0wsRUFBY3BKLFNBQ2pCb0osRUFBZ0JoTCxFQUFHLG1CQUd2QkEsRUFBRStLLGtCQUFtQkMsSUFFekJ0SixrQkFBbUIsV0FDZjFCLEVBQUcsNEVBQTZFbUIsUUFFcEZDLGtCQUFtQixXQUNmcEIsRUFBRyw0RUFBNkV1RCxTQUl4RnZELEVBQUVhLFVBQVVvSyxNQUFPLFdBQ2YvSyxrQkFBa0JLLEtBQU1QLEVBQUciLCJmaWxlIjoiY2hlY2tvdXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIHdjX2NoZWNrb3V0X3BhcmFtcyAqL1xualF1ZXJ5KCBmdW5jdGlvbiggJCApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgdG8gaGFuZGxlIFBheUV4IGNoZWNrb3V0IHBheW1lbnQgZm9ybXMuXG4gICAgICovXG4gICAgd2luZG93LndjX3BheWV4X2NoZWNrb3V0ID0ge1xuICAgICAgICBqc191cmw6IG51bGwsXG4gICAgICAgIHBheW1lbnRNZW51OiBudWxsLFxuICAgICAgICBpc1BheW1lbnRNZW51TG9hZGVkOiBmYWxzZSxcbiAgICAgICAgeGhyOiBmYWxzZSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBlIGhhbmRsZXJzIGFuZCBVSSBzdGF0ZS5cbiAgICAgICAgICovXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBmb3JtICkge1xuICAgICAgICAgICAgdGhpcy5mb3JtICAgICAgICAgPSBmb3JtO1xuICAgICAgICAgICAgdGhpcy5mb3JtX3N1Ym1pdCAgPSBmYWxzZTtcblxuICAgICAgICAgICAgJCggdGhpcy5mb3JtIClcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gYmluZCBkaXJlY3RseSB0byB0aGUgY2xpY2sgKGFuZCBub3QgY2hlY2tvdXRfcGxhY2Vfb3JkZXJfcGF5ZXhfY2hlY2tvdXQpIHRvIGF2b2lkIHBvcHVwIGJsb2NrZXJzXG4gICAgICAgICAgICAvLyBlc3BlY2lhbGx5IG9uIG1vYmlsZSBkZXZpY2VzIChsaWtlIG9uIENocm9tZSBmb3IgaU9TKSBmcm9tIGJsb2NraW5nIHBheWV4X2NoZWNrb3V0KHBheW1lbnRfaWQsIHt9LCAnb3BlbicpOyBmcm9tIG9wZW5pbmcgYSB0YWJcbiAgICAgICAgICAgICAgICAub24oICdjbGljaycsICcjcGxhY2Vfb3JkZXInLCB0aGlzLm9uU3VibWl0IClcblxuICAgICAgICAgICAgICAgIC8vIFdvb0NvbW1lcmNlIGxldHMgdXMgcmV0dXJuIGEgZmFsc2Ugb24gY2hlY2tvdXRfcGxhY2Vfb3JkZXJfe2dhdGV3YXl9IHRvIGtlZXAgdGhlIGZvcm0gZnJvbSBzdWJtaXR0aW5nXG4gICAgICAgICAgICAgICAgLm9uKCAnc3VibWl0IGNoZWNrb3V0X3BsYWNlX29yZGVyX3BheWV4X2NoZWNrb3V0JyApO1xuXG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkuYmluZCggJ3VwZGF0ZV9jaGVja291dCcsIHRoaXMub25VcGRhdGVDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnY2hlY2tvdXRfZXJyb3InLCB0aGlzLnJlc2V0Q2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ3VwZGF0ZWRfY2hlY2tvdXQnLCB0aGlzLm9uVXBkYXRlZENoZWNrb3V0ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdibHVyJywgdGhpcy5vblVwZGF0ZWRDaGVja291dCApO1xuXG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdjbGljaycsICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gSGlkZSBcIkNoYW5nZSBzaGlwcGluZyBpbmZvXCIgYnV0dG9uXG4gICAgICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBTaG93IEFkZHJlc3MgRmllbGRzXG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuc2hvd0FkZHJlc3NGaWVsZHMoKTtcbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LmlzSW5zdGFudENoZWNrb3V0KCkgKSB7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdEluc3RhbnRDaGVja291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIEluc3RhbnQgQ2hlY2tvdXRcbiAgICAgICAgICovXG4gICAgICAgIGluaXRJbnN0YW50Q2hlY2tvdXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnSW5pdGlhbGl6YXRpb24gb2YgSW5zdGFudCBDaGVja291dC4uLicgKTtcblxuICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaGlkZUFkZHJlc3NGaWVsZHMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXNlIHNhdmVkIGNvbnN1bWVyUHJvZmlsZVJlZlxuICAgICAgICAgICAgbGV0IGNvbnN1bWVyUHJvZmlsZUVsbSA9ICQoICcjcGF5ZXgtY29uc3VtZXItcHJvZmlsZScgKTtcbiAgICAgICAgICAgIGlmICggY29uc3VtZXJQcm9maWxlRWxtLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgbGV0IHJlZmVyZW5jZSA9IGNvbnN1bWVyUHJvZmlsZUVsbS5kYXRhKCAncmVmZXJlbmNlJyApO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnSW5pdGlhdGUgY29uc3VtZXJQcm9maWxlUmVmJywgcmVmZXJlbmNlICk7XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdENoZWNrb3V0KCByZWZlcmVuY2UgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhdGUgY2hlY2tpblxuXG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdENoZWNrSW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBDaGVja0luXG4gICAgICAgICAqL1xuICAgICAgICBpbml0Q2hlY2tJbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBwYXlleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LndhaXRGb3JMb2FkaW5nKCdwYXlleC5ob3N0ZWRWaWV3LmNvbnN1bWVyJywgZnVuY3Rpb24gKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggZXJyICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0IFBheUV4IGhvc3RlZFZpZXdcbiAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcigge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdwYXlleC1jaGVja2luJyxcbiAgICAgICAgICAgICAgICAgICAgY3VsdHVyZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jaGVja0luU3R5bGUgPyBKU09OLnBhcnNlKCBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmNoZWNrSW5TdHlsZSApIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgb25Db25zdW1lcklkZW50aWZpZWQ6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdob3N0ZWRWaWV3OiBvbkNvbnN1bWVySWRlbnRpZmllZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uQ29uc3VtZXJJZGVudGlmaWVkKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uQmlsbGluZ0RldGFpbHNBdmFpbGFibGU6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ2JpbGxpbmcnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUoICdzaGlwcGluZycsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9nRXJyb3IoICdwYXlleC1jaGVja2luJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIGRhdGEuZGV0YWlscyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy93Y19wYXlleF9jaGVja291dC5vbkVycm9yKCBkYXRhLmRldGFpbHMgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKS5vcGVuKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0Q2hlY2tvdXQ6IGZ1bmN0aW9uKCByZWZlcmVuY2UgKSB7XG4gICAgICAgICAgICAvLyBTaG93IFwiQ2hhbmdlIHNoaXBwaW5nIGluZm9cIiBidXR0b25cbiAgICAgICAgICAgICQoICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nICkuc2hvdygpO1xuXG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLmZpbmQoICcucGF5ZXhfY3VzdG9tZXJfcmVmZXJlbmNlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5hcHBlbmQoIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgY2xhc3M9J3BheWV4X2N1c3RvbWVyX3JlZmVyZW5jZScgbmFtZT0ncGF5ZXhfY3VzdG9tZXJfcmVmZXJlbmNlJyB2YWx1ZT0nXCIgKyByZWZlcmVuY2UgKyBcIicvPlwiICk7XG5cbiAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uU3VibWl0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXNJbnN0YW50Q2hlY2tvdXQoKSB7XG4gICAgICAgICAgICByZXR1cm4gV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5pbnN0YW50X2NoZWNrb3V0O1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzQ2hlY2tpbkVuYWJsZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5jaGVja2luO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzUGF5bWVudE1ldGhvZENob3NlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJCggJyNwYXltZW50X21ldGhvZF9wYXlleF9jaGVja291dCcgKS5pcyggJzpjaGVja2VkJyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBmb3JtX2RhdGEgPSB3Y19wYXlleF9jaGVja291dC5mb3JtLmRhdGEoKTtcbiAgICAgICAgICAgIGlmICggMSAhPT0gZm9ybV9kYXRhWydibG9ja1VJLmlzQmxvY2tlZCddICkge1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uYmxvY2soe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBvdmVybGF5Q1NTOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAnI2ZmZicsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjZcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuYmxvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS51bmJsb2NrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC51bmJsb2NrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ1JlYWR5JyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uVXBkYXRlQ2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZUNoZWNrb3V0JyApO1xuXG4gICAgICAgICAgICBpZiAoICEgd2NfcGF5ZXhfY2hlY2tvdXQuaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEB0b2RvXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25VcGRhdGVkQ2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZWRDaGVja291dCcgKTtcblxuICAgICAgICAgICAgaWYgKCAhIHdjX3BheWV4X2NoZWNrb3V0LmlzSW5zdGFudENoZWNrb3V0KCkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LmZvcm0uaXMoICcucHJvY2Vzc2luZycgKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggISB3Y19wYXlleF9jaGVja291dC52YWxpZGF0ZUZvcm0oKSApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uVXBkYXRlZENoZWNrb3V0OiBWYWxpZGF0aW9uIGlzIGZhaWxlZCcgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQueGhyICkge1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lnhoci5hYm9ydCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5hZGRDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5ibG9jaygpO1xuXG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC54aHIgPSB3Y19wYXlleF9jaGVja291dC51cGRhdGVPcmRlcigpXG4gICAgICAgICAgICAgICAgLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuZmFpbCggZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ3VwZGF0ZU9yZGVyIGVycm9yOicgKyB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uRXJyb3IoIHRleHRTdGF0dXMgKTtcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggcmVzcG9uc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54aHIgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzdWx0ICE9PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWxvYWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJpZ2dlciB1cGRhdGUgaW4gY2FzZSB3ZSBuZWVkIGEgZnJlc2ggbm9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlZnJlc2ggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uRXJyb3IoIHJlc3BvbnNlLm1lc3NhZ2VzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0LmZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZWZyZXNoIFBheW1lbnQgTWVudVxuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5qc191cmwgPSByZXNwb25zZVsnanNfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnJlZnJlc2hQYXltZW50TWVudSgpO1xuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblN1Ym1pdDogZnVuY3Rpb24oIGUgKSB7XG4gICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LmZvcm1fc3VibWl0ICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHdjX3BheWV4X2NoZWNrb3V0LmlzUGF5bWVudE1ldGhvZENob3NlbigpICkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGUgIT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCAhIHdjX3BheWV4X2NoZWNrb3V0LnZhbGlkYXRlRm9ybSgpICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblN1Ym1pdCcgKTtcblxuICAgICAgICAgICAgICAgIGlmICggd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5pcyggJy5wcm9jZXNzaW5nJyApICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLmFkZENsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5ibG9jaygpO1xuICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LnBsYWNlT3JkZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICAuZmFpbCggZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQub25FcnJvciggdGV4dFN0YXR1cyApO1xuICAgICAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAgICAgLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCByZXNwb25zZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5yZXN1bHQgIT09ICdzdWNjZXNzJyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlbG9hZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJpZ2dlciB1cGRhdGUgaW4gY2FzZSB3ZSBuZWVkIGEgZnJlc2ggbm9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWZyZXNoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5vbkVycm9yKCByZXNwb25zZS5tZXNzYWdlcyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuanNfdXJsID0gcmVzcG9uc2VbJ2pzX3VybCddO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggd2NfcGF5ZXhfY2hlY2tvdXQuanNfdXJsICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXRDaGVja291dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtX3N1Ym1pdCA9IGZhbHNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHZhbGlkYXRlRm9ybTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICRyZXF1aXJlZF9pbnB1dHMsXG4gICAgICAgICAgICAgICAgdmFsaWRhdGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHdlIG5lZWQgdG8gdmFsaWRhdGUgc2hpcHBpbmcgYWRkcmVzc1xuICAgICAgICAgICAgaWYgKCAkKCAnI3NoaXAtdG8tZGlmZmVyZW50LWFkZHJlc3MtY2hlY2tib3gnICkuaXMoICc6Y2hlY2tlZCcgKSApIHtcbiAgICAgICAgICAgICAgICAkcmVxdWlyZWRfaW5wdXRzID0gJCggJy53b29jb21tZXJjZS1iaWxsaW5nLWZpZWxkcyAudmFsaWRhdGUtcmVxdWlyZWQsIC53b29jb21tZXJjZS1zaGlwcGluZy1maWVsZHMgLnZhbGlkYXRlLXJlcXVpcmVkJyApLmZpbmQoJ2lucHV0LCBzZWxlY3QnKS5ub3QoICQoICcjYWNjb3VudF9wYXNzd29yZCwgI2FjY291bnRfdXNlcm5hbWUnICkgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHJlcXVpcmVkX2lucHV0cyA9ICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHMgLnZhbGlkYXRlLXJlcXVpcmVkJyApLmZpbmQoJ2lucHV0LCBzZWxlY3QnKS5ub3QoICQoICcjYWNjb3VudF9wYXNzd29yZCwgI2FjY291bnRfdXNlcm5hbWUnICkgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAkcmVxdWlyZWRfaW5wdXRzLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAkcmVxdWlyZWRfaW5wdXRzLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKCB0aGlzICksXG4gICAgICAgICAgICAgICAgICAgICAgICAkcGFyZW50ICAgICAgICAgICA9ICR0aGlzLmNsb3Nlc3QoICcuZm9ybS1yb3cnICksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZV9yZXF1aXJlZCA9ICRwYXJlbnQuaXMoICcudmFsaWRhdGUtcmVxdWlyZWQnICksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZV9lbWFpbCAgICA9ICRwYXJlbnQuaXMoICcudmFsaWRhdGUtZW1haWwnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWxpZGF0ZV9yZXF1aXJlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJ2NoZWNrYm94JyA9PT0gJHRoaXMuYXR0ciggJ3R5cGUnICkgJiYgISAkdGhpcy5pcyggJzpjaGVja2VkJyApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggJHRoaXMudmFsKCkgPT09ICcnICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWxpZGF0ZV9lbWFpbCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJHRoaXMudmFsKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjg1NTg2NS9qcXVlcnktdmFsaWRhdGUtZS1tYWlsLWFkZHJlc3MtcmVnZXggKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAoL14oKChbYS16XXxcXGR8WyEjXFwkJSYnXFwqXFwrXFwtXFwvPVxcP1xcXl9ge1xcfH1+XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkrKFxcLihbYS16XXxcXGR8WyEjXFwkJSYnXFwqXFwrXFwtXFwvPVxcP1xcXl9ge1xcfH1+XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkrKSopfCgoXFx4MjIpKCgoKFxceDIwfFxceDA5KSooXFx4MGRcXHgwYSkpPyhcXHgyMHxcXHgwOSkrKT8oKFtcXHgwMS1cXHgwOFxceDBiXFx4MGNcXHgwZS1cXHgxZlxceDdmXXxcXHgyMXxbXFx4MjMtXFx4NWJdfFtcXHg1ZC1cXHg3ZV18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfChcXFxcKFtcXHgwMS1cXHgwOVxceDBiXFx4MGNcXHgwZC1cXHg3Zl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSkpKigoKFxceDIwfFxceDA5KSooXFx4MGRcXHgwYSkpPyhcXHgyMHxcXHgwOSkrKT8oXFx4MjIpKSlAKCgoW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkqKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKVxcLikrKChbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkqKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpXFwuPyQvaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhIHBhdHRlcm4udGVzdCggJHRoaXMudmFsKCkgICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdmFsaWRhdGVkO1xuICAgICAgICB9LFxuXG4gICAgICAgIHdhaXRGb3JMb2FkaW5nOiBmdW5jdGlvbiAoIHZhcl9zdHJpbmcsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gZXZhbCggdmFyX3N0cmluZyApO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBlICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuICAgICAgICAgICAgbGV0IHRpbWVyID0gd2luZG93LnNldEludGVydmFsKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBvYmogIT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCggdGltZXIgKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soIG51bGwsIG9iaiApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzKys7XG4gICAgICAgICAgICAgICAgICAgIGlmICggYXR0ZW1wdHMgPj0gMTIwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoIHRpbWVyICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggJ1RpbWVvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA1MDAgKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9hZCBKU1xuICAgICAgICAgKiBAcGFyYW0ganNcbiAgICAgICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICBsb2FkSnM6IGZ1bmN0aW9uICgganMsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdMb2FkaW5nIG9mICcgKyBqcyApO1xuICAgICAgICAgICAgLy8gQ3JlYXRlcyBhIG5ldyBzY3JpcHQgdGFnXG4gICAgICAgICAgICBsZXQgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NjcmlwdCcgKTtcblxuICAgICAgICAgICAgLy8gU2V0IHNjcmlwdCB0YWcgcGFyYW1zXG4gICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCAnc3JjJywganMgKTtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoICd0eXBlJywgJ3RleHQvamF2YXNjcmlwdCcgKTtcbiAgICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoICdhc3luYycsICcnICk7XG4gICAgICAgICAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdMb2FkZWQ6ICcgKyBqcyApO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9LCBmYWxzZSApO1xuXG4gICAgICAgICAgICAvLyBHZXRzIGRvY3VtZW50IGhlYWQgZWxlbWVudFxuICAgICAgICAgICAgbGV0IG9IZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdoZWFkJyApWzBdO1xuICAgICAgICAgICAgaWYgKCBvSGVhZCApIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgc2NyaXB0IHRhZyB0byBoZWFkXG4gICAgICAgICAgICAgICAgb0hlYWQuYXBwZW5kQ2hpbGQoIHNjcmlwdCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2NyaXB0O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWF0ZSBQYXltZW50IEphdmFzY3JpcHRcbiAgICAgICAgICogQHBhcmFtIHVybFxuICAgICAgICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICAgICAgICovXG4gICAgICAgIGluaXRQYXltZW50SlM6IGZ1bmN0aW9uICggdXJsLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGNhbGxiYWNrID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZXN0cm95XG4gICAgICAgICAgICBpZiAoIHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSggJ3BheWV4JyApICYmIHdpbmRvdy5wYXlleC5oYXNPd25Qcm9wZXJ0eSggJ2hvc3RlZFZpZXcnICkgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygd2luZG93LnBheWV4Lmhvc3RlZFZpZXcucGF5bWVudE1lbnUgIT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5wYXltZW50TWVudSgpLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCggJyNwYXltZW50LXBheWV4LWNoZWNrb3V0IGlmcmFtZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAvL2RlbGV0ZSB3aW5kb3cucGF5ZXguaG9zdGVkVmlldztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVzdHJveSBKU1xuICAgICAgICAgICAgJCggXCJzY3JpcHRbc3JjKj0ncHgucGF5bWVudG1lbnUuY2xpZW50J11cIiApLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAvLyBMb2FkIEpTXG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2FkSnMoIHVybCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoICcjcGF5bWVudC1wYXlleC1jaGVja291dCBpZnJhbWUnICkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBMb2FkIFBheUV4IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgaWYgKCB3Y19wYXlleF9jaGVja291dC5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjcGF5bWVudCcpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCdwYXltZW50LXBheWV4LWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQuZmVhdGhlcmxpZ2h0KCAnPGRpdiBpZD1cInBheWV4LXBheW1lbnRtZW51XCI+Jm5ic3A7PC9kaXY+Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudDogJ2ZlYXRoZXJsaWdodC1wYXlleCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkNsaWNrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Fc2M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCdwYXlleC1wYXltZW50bWVudScgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhZnRlckNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICkudW5ibG9jaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKVxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWF0ZSBQYXltZW50IE1lbnUuXG4gICAgICAgICAqIFBheW1lbnQgSmF2YXNjcmlwdCBtdXN0IGJlIGxvYWRlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGlkXG4gICAgICAgICAqIEBwYXJhbSBjYWxsYmFja1xuICAgICAgICAgKi9cbiAgICAgICAgaW5pdFBheW1lbnRNZW51OiBmdW5jdGlvbiAoIGlkLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaW5pdFBheW1lbnRNZW51JyApO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjYWxsYmFjayA9PT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hZCBQYXlFeCBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudSA9IHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LnBheW1lbnRNZW51KCB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBpZCxcbiAgICAgICAgICAgICAgICBjdWx0dXJlOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmN1bHR1cmUsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQucGF5bWVudE1lbnVTdHlsZSA/IEpTT04ucGFyc2UoIFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQucGF5bWVudE1lbnVTdHlsZSApIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvbkFwcGxpY2F0aW9uQ29uZmlndXJlZDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25BcHBsaWNhdGlvbkNvbmZpZ3VyZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmlzUGF5bWVudE1lbnVMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggbnVsbCApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0Lm9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQoIGRhdGEubmFtZSwgZGF0YS5pbnN0cnVtZW50ICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDcmVhdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q3JlYXRlZCcgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENvbXBsZXRlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENvbXBsZXRlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbi5ocmVmID0gZGF0YS5yZWRpcmVjdFVybDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENhbmNlbGVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q2FuY2VsZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWNhbmNlbCcsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudEZhaWxlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudEZhaWxlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQubG9nRXJyb3IoICdwYXltZW50LW1lbnUtZmFpbGVkJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAvL3NlbGYubG9jYXRpb24uaHJlZiA9IGRhdGEucmVkaXJlY3RVcmw7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWVycm9yJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggZGF0YSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudS5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZnJlc2hcbiAgICAgICAgICovXG4gICAgICAgIHJlZnJlc2hQYXltZW50TWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3JlZnJlc2hQYXltZW50TWVudScgKTtcbiAgICAgICAgICAgIC8vaWYgKCB0eXBlb2YgdGhpcy5wYXltZW50TWVudSAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgLy90aGlzLnBheW1lbnRNZW51LnJlZnJlc2goKTtcbiAgICAgICAgICAgIC8vfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUud2FybiggJ3JlZnJlc2hQYXltZW50TWVudTogcmVmcmVzaCB3b3JrYXJvdW5kJyApO1xuICAgICAgICAgICAgICAgIC8vd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggd2NfcGF5ZXhfY2hlY2tvdXQuanNfdXJsIClcbiAgICAgICAgICAgIC8vfVxuXG4gICAgICAgICAgICAvLyBAdG9kbyBVc2UgdGhpcy5wYXltZW50TWVudS5yZWZyZXNoKCk7IGluc3RlYWQgb2YgdGhhdFxuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggd2NfcGF5ZXhfY2hlY2tvdXQuanNfdXJsIClcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGxhY2UgT3JkZXJcbiAgICAgICAgICogQHJldHVybiB7SlF1ZXJ5UHJvbWlzZTxhbnk+fVxuICAgICAgICAgKi9cbiAgICAgICAgcGxhY2VPcmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdwbGFjZU9yZGVyJyApO1xuICAgICAgICAgICAgbGV0IGZpZWxkcyA9ICQoJy53b29jb21tZXJjZS1jaGVja291dCcpLnNlcmlhbGl6ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BheWV4X3BsYWNlX29yZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZpZWxkc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3VsdCcpICYmIHJlc3BvbnNlLnJlc3VsdCA9PT0gJ2ZhaWx1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3BheWV4X2NoZWNrb3V0LmxvZ0Vycm9yKCdwYXlleC1wbGFjZS1vcmRlcicsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSBPcmRlclxuICAgICAgICAgKiBAcmV0dXJuIHtKUXVlcnlQcm9taXNlPGFueT59XG4gICAgICAgICAqL1xuICAgICAgICB1cGRhdGVPcmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlcicgKTtcbiAgICAgICAgICAgIGxldCBmaWVsZHMgPSAkKCcud29vY29tbWVyY2UtY2hlY2tvdXQnKS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwYXlleF91cGRhdGVfb3JkZXInLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmllbGRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVzdWx0JykgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnZmFpbHVyZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2VzLmluZGV4T2YoJ09yZGVyIHVwZGF0ZSBpcyBub3QgYXZhaWxhYmxlLicpID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIHJlbG9hZFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAncmVmcmVzaFBheW1lbnRNZW51OiByZWZyZXNoIHdvcmthcm91bmQuIEZvcmNlIHJlbG9hZC4nICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0LmluaXRQYXltZW50SlMoIHdjX3BheWV4X2NoZWNrb3V0LmpzX3VybCApXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2dFcnJvcigncGF5ZXgtdXBkYXRlLW9yZGVyJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT24gQ29uc3VtZXIgSWRlbnRpZmllZFxuICAgICAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIG9uQ29uc3VtZXJJZGVudGlmaWVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQ29uc3VtZXJJZGVudGlmaWVkJywgZGF0YSApO1xuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGF5ZXhfY2hlY2tvdXRfY3VzdG9tZXJfcHJvZmlsZScsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBjb25zdW1lclByb2ZpbGVSZWY6IGRhdGEuY29uc3VtZXJQcm9maWxlUmVmXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIENoZWNrb3V0XG4gICAgICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdENoZWNrb3V0KCBkYXRhLmNvbnN1bWVyUHJvZmlsZVJlZiApO1xuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPbiBBZGRyZXNzIERldGFpbHMgQXZhaWxhYmxlXG4gICAgICAgICAqIEBwYXJhbSB0eXBlXG4gICAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICAgKi9cbiAgICAgICAgb25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUnLCB0eXBlLCBkYXRhICk7XG5cbiAgICAgICAgICAgICQoICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nICkuc2hvdygpO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BheWV4X2NoZWNrb3V0X2dldF9hZGRyZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfUGF5RXhfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogZGF0YS51cmxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH0gKS5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIH0gKS5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5sb2dFcnJvcigncGF5ZXgtYWRkcmVzcy1kZXRhaWxzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhZGRyZXNzXG4gICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBbdHlwZV0uZm9yRWFjaChmdW5jdGlvbihzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZWwgPSAkKCdpbnB1dFtuYW1lPVwiJyArIHNlY3Rpb24gKyAnXycgKyBrZXkgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5wcm9wKCdyZWFkb25seScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNsb3Nlc3QoJy5mb3JtLXJvdycpLnJlbW92ZUNsYXNzKCdwYXlleC1sb2NrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnZhbCh2YWx1ZSkuY2hhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdjb3VudHJ5JyB8fCBrZXkgPT09ICdzdGF0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZWwxID0gJCgnIycgKyBzZWN0aW9uICsgJ18nICsga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5TZWxlY3QyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDEuc2VsZWN0MigndmFsJywgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mICQuZm4uY2hvc2VuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaG9zZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLnZhbCh2YWx1ZSkudHJpZ2dlcignY2hvc2VuOnVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9lbDEuY2hvc2VuKCkuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT24gUGF5bWVudCBNZW51IEluc3RydW1lbnQgU2VsZWN0ZWRcbiAgICAgICAgICogQHBhcmFtIG5hbWVcbiAgICAgICAgICogQHBhcmFtIGluc3RydW1lbnRcbiAgICAgICAgICovXG4gICAgICAgIG9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQ6IGZ1bmN0aW9uICggbmFtZSwgaW5zdHJ1bWVudCApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCcsIG5hbWUsIGluc3RydW1lbnQgKTtcbiAgICAgICAgICAgIC8vIEB0b2RvXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvZyBFcnJvclxuICAgICAgICAgKiBAcGFyYW0gaWRcbiAgICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgICAqL1xuICAgICAgICBsb2dFcnJvcjogZnVuY3Rpb24gKCBpZCwgZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybiggZGF0YSApO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9QYXlFeF9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BheWV4X2NoZWNrb3V0X2xvZ19lcnJvcicsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1BheUV4X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBpZDogaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KCBkYXRhIClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uRXJyb3InLCBkYXRhICk7XG4gICAgICAgICAgICAvL3djX3BheWV4X2NoZWNrb3V0LnN1Ym1pdF9lcnJvciggJzxkaXYgY2xhc3M9XCJ3b29jb21tZXJjZS1lcnJvclwiPicgKyBkYXRhICsgJzwvZGl2PicgKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0X2Vycm9yOiBmdW5jdGlvbiggZXJyb3JfbWVzc2FnZSApIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQsIC53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLnByZXBlbmQoICc8ZGl2IGNsYXNzPVwid29vY29tbWVyY2UtTm90aWNlR3JvdXAgd29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXRcIj4nICsgZXJyb3JfbWVzc2FnZSArICc8L2Rpdj4nICk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKS51bmJsb2NrKCk7XG4gICAgICAgICAgICB3Y19wYXlleF9jaGVja291dC5mb3JtLmZpbmQoICcuaW5wdXQtdGV4dCwgc2VsZWN0LCBpbnB1dDpjaGVja2JveCcgKS50cmlnZ2VyKCAndmFsaWRhdGUnICkuYmx1cigpO1xuICAgICAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuc2Nyb2xsX3RvX25vdGljZXMoKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAnY2hlY2tvdXRfZXJyb3InICk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjcm9sbF90b19ub3RpY2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBzY3JvbGxFbGVtZW50ID0gJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC11cGRhdGVPcmRlclJldmlldywgLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgaWYgKCAhIHNjcm9sbEVsZW1lbnQubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIHNjcm9sbEVsZW1lbnQgPSAkKCAnLmZvcm0uY2hlY2tvdXQnICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQuc2Nyb2xsX3RvX25vdGljZXMoIHNjcm9sbEVsZW1lbnQgKTtcbiAgICAgICAgfSxcbiAgICAgICAgaGlkZUFkZHJlc3NGaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHNfX2ZpZWxkLXdyYXBwZXIsIC53b29jb21tZXJjZS1zaGlwcGluZy1maWVsZHMnICkuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICBzaG93QWRkcmVzc0ZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1iaWxsaW5nLWZpZWxkc19fZmllbGQtd3JhcHBlciwgLndvb2NvbW1lcmNlLXNoaXBwaW5nLWZpZWxkcycgKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2NfcGF5ZXhfY2hlY2tvdXQuaW5pdCggJCggXCJmb3JtLmNoZWNrb3V0LCBmb3JtI29yZGVyX3JldmlldywgZm9ybSNhZGRfcGF5bWVudF9tZXRob2RcIiApICk7XG4gICAgfSApO1xufSk7XG5cbiJdfQ==
