{"version":3,"file":"shortcode-checkout.min.js","names":["jQuery","$","window","wc_sb_shortcode_checkout","customer_identified","customer_reference","billing_address","shipping_address","js_url","payment_url","WC_Shortcode_Checkout","paymentMenu","is_payment_menu_loaded","xhr","updateTimer","init","form","console","log","self","this","isTermsAndConditionsEnabled","setInterval","prop","isCheckinEnabled","loadCheckIn","isCheckinRequired","hidePlaceOrder","document","body","on","event","preventDefault","showAddressFields","hideAddressFields","obj","onSubmit","onInitOrUpdateCheckout","checkPaymentUrl","loaded","checkin_enabled","checkin_required","isCustomerIdentified","isRedirectMethodEnabled","redirect_method","tos_enabled","ajax","type","url","ajax_url","data","action","nonce","dataType","done","success","logError","alert","details","hasOwnProperty","payex","wc_sb_common","loadJs","initCheckIn","waitForLoading","err","warn","hostedView","consumer","container","culture","style","checkInStyle","JSON","parse","onConsumerIdentified","onNewConsumer","onConsumerRemoved","onBillingDetailsAvailable","onAddressDetailsAvailable","onShippingDetailsAvailable","onError","open","async","parallel","save_customer_ref","callback2","saveCustomerRef","response","init_checkout","terms","length","showPlaceOrder","find","remove","append","consumerProfileRef","results","callback","always","message","fetchAddress","each","key","value","forEach","section","el","closest","removeClass","val","change","el1","Select2","select2","fn","chosen","trigger","show","enqueueCheckoutUpdate","hide","initInstantCheckout","initCheckout","reference","block","loadCheckout","unblock","submit_error","isPaymentMethodChosen","onUpdatedCheckout","is","validateForm","updateOrder","onUpdatedShippingMethod","terms_error","addClass","abort","placeOrder","fail","jqXHR","textStatus","reload","result","refresh","location","href","initPaymentJS","messages","needs_checkin","resetCheckout","close","initPaymentMenu","id","overlayCSS","background","opacity","paymentMenuStyle","onApplicationConfigured","onPaymentMenuInstrumentSelected","name","instrument","onPaymentCreated","onPaymentCompleted","redirectUrl","onPaymentCanceled","onPaymentFailed","onPaymentToS","openUrl","onExternalRedirect","refreshPaymentMenu","fields","serialize","indexOf","clearTimeout","setTimeout","invoice_fee","invoice_fee_enabled","sb_invoice_fee","apply_fee","remove_fee","carpay_discount","carpay_enabled","sb_carpay","apply_discount","remove_discount","additional","error_message","prepend","blur","scroll_to_notices","scrollElement","stringify","URLSearchParams","search","get","ready"],"sources":["shortcode-checkout.js"],"sourcesContent":["/* global wc_checkout_params */\n/* global WC_Shortcode_Checkout */\njQuery( function( $ ) {\n    'use strict';\n\n    /**\n     * Object to handle Swedbank Pay checkout payment forms.\n     */\n    window.wc_sb_shortcode_checkout = {\n        customer_identified: null,\n        customer_reference: null,\n        billing_address: null,\n        shipping_address: null,\n        js_url: null,\n        payment_url: WC_Shortcode_Checkout.payment_url,\n        paymentMenu: null,\n        is_payment_menu_loaded: false,\n        xhr: false,\n        updateTimer: null,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            console.log( 'init' );\n\n            var self = this;\n\n            if ( ! this.isTermsAndConditionsEnabled() ) {\n                setInterval( function () {\n                    $( '#place_order' ).prop( 'disabled', true );\n                }, 1000 );\n            }\n\n            // Init Checkin\n            if ( this.isCheckinEnabled() ) {\n                this.loadCheckIn();\n\n                // Hide Place Order\n                if ( this.isCheckinRequired() ) {\n                    this.hidePlaceOrder();\n                }\n\n                $( document.body ).on( 'click', '#change-address-info', function ( event ) {\n                    event.preventDefault();\n\n                    // Show Address Fields\n                    self.showAddressFields();\n                } );\n\n                this.hideAddressFields();\n            }\n\n            this.form = form;\n            $( this.form )\n                // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n                // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': self}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_checkout' );\n\n            //$( document.body ).on( 'checkout_error', this.resetCheckout );\n            //$( document.body ).on( 'blur', this.onUpdatedCheckout );\n            //$( document.body ).on( 'updated_shipping_method', this.onUpdatedShippingMethod );\n\n            $( document.body ).on(\n                'updated_checkout',\n                null,\n                {'obj': self},\n                this.onInitOrUpdateCheckout\n            );\n\n            this.checkPaymentUrl( function ( loaded ) {\n                if ( ! loaded ) {\n                    // Initialize Instant Checkout\n                    //self.initInstantCheckout();\n                }\n            } );\n        },\n\n        /**\n         * Check if the Checkin is active\n         * @return {boolean}\n         */\n        isCheckinEnabled() {\n            return 'yes' === WC_Shortcode_Checkout.checkin_enabled;\n        },\n\n        /**\n         * Check if the Checkin is required\n         * @return {boolean}\n         */\n        isCheckinRequired() {\n            return this.isCheckinEnabled() && 'yes' === WC_Shortcode_Checkout.checkin_required;\n        },\n\n        /**\n         * Check if customer was identified\n         * @return {boolean}\n         */\n        isCustomerIdentified() {\n            return this.customer_identified === true;\n        },\n\n        /**\n         * Check if the redirect method is active\n         * @return {boolean}\n         */\n        isRedirectMethodEnabled() {\n            return 'redirect' === WC_Shortcode_Checkout.redirect_method;\n        },\n\n        /**\n         * Check if terms and conditions are enabled\n         * @returns {boolean}\n         */\n        isTermsAndConditionsEnabled() {\n            return WC_Shortcode_Checkout.tos_enabled\n        },\n\n        /**\n         * Load CheckIn\n         * @returns {*}\n         */\n        loadCheckIn: function() {\n            var self = this;\n\n            // Get `view-consumer-identification`\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkin',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                },\n                dataType: 'json'\n            } ).done( function ( data ) {\n                if ( ! data.success ) {\n                    self.logError( 'sb-checkin-loader', data );\n                    alert( data.details );\n                    return;\n                }\n\n                // Destroy\n                if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                    //if ( typeof window.payex.hostedView.consumer !== 'undefined' ) {\n                    //window.payex.hostedView.consumer().close();\n                    //}\n                }\n\n                // Destroy JS\n                //$( \"script[src*='px.consumer.client']\" ).remove();\n                //$( '#swedbank-pay-checkin iframe' ).remove();\n                wc_sb_common.loadJs( data.data, function () {\n                    self.initCheckIn();\n                } );\n            } );\n        },\n\n        /**\n         * Initialize CheckIn\n         */\n        initCheckIn: function() {\n            if ( typeof payex === 'undefined') {\n                return;\n            }\n\n            var self = this;\n\n            wc_sb_common.waitForLoading('payex.hostedView.consumer', function ( err ) {\n                if ( err ) {\n                    console.warn( err );\n                    return;\n                }\n\n                // Init PayEx hostedView\n                window.payex.hostedView.consumer( {\n                    container: 'swedbank-pay-checkin',\n                    culture: WC_Shortcode_Checkout.culture,\n                    style: WC_Shortcode_Checkout.checkInStyle ? JSON.parse( WC_Shortcode_Checkout.checkInStyle ) : null,\n                    onConsumerIdentified: function( data ) {\n                        console.log( 'hostedView: onConsumerIdentified' );\n                        self.onConsumerIdentified( data );\n                    },\n                    onNewConsumer: function( data ) {\n                        console.log( 'hostedView: onNewConsumer' );\n                        self.onConsumerIdentified( data );\n                    },\n                    onConsumerRemoved: function( data ) {\n                        console.log( 'hostedView: onConsumerRemoved' );\n                        console.log ( data );\n                    },\n                    onBillingDetailsAvailable: function( data ) {\n                        self.onAddressDetailsAvailable( 'billing', data );\n                    },\n                    onShippingDetailsAvailable: function( data ) {\n                        self.onAddressDetailsAvailable( 'shipping', data );\n                    },\n                    onError: function ( data ) {\n                        self.logError( 'sb-checkin', data );\n\n                        alert( data.details );\n                    }\n                } ).open();\n            });\n        },\n\n        /**\n         * On Consumer Identified\n         * @param data\n         */\n        onConsumerIdentified: function ( data ) {\n            console.log( 'onConsumerIdentified', data );\n\n            var self = this;\n\n            async.parallel(\n                {\n                    save_customer_ref: function( callback2 ) {\n                        self.saveCustomerRef( data, function ( err, response ) {\n                            if ( err ) {\n                                alert( err );\n                            }\n\n                            callback2( null, response );\n                        } );\n                    },\n                    init_checkout: function( callback2 ) {\n                        // Tick \"terms and conditions\" if exists\n                        let terms = $( '#terms' );\n                        if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                            terms.prop( 'checked', true )\n                        }\n\n                        self.showPlaceOrder();\n\n                        // Set customer is identified\n                        self.customer_identified = true;\n\n                        // Add the reference to the checkout form\n                        self.form.find( '.swedbank_pay_customer_reference' ).remove();\n                        self.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + data.consumerProfileRef + \"'/>\" );\n\n                        callback2( null, [] );\n                    },\n                },\n                function( err, results ) {\n                    console.log( 'onConsumerIdentified: loaded', results );\n\n                    // Set customer is identified\n                    self.customer_identified = true;\n\n                    // Save customer reference\n                    self.customer_reference = data.consumerProfileRef;\n                }\n            );\n        },\n\n        /**\n         * Save Customer Reference.\n         *\n         * @param data\n         * @param callback\n         */\n        saveCustomerRef: function ( data, callback ) {\n            $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_customer_profile',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    consumerProfileRef: data.consumerProfileRef\n                },\n                dataType: 'json'\n            } ).always( function ( response ) {\n                //\n            } ).done( function ( response) {\n                if ( ! response.success ) {\n                    callback( response.data.message, response );\n                } else {\n                    callback( null, response );\n                }\n            } );\n        },\n\n        /**\n         * Fetch address.\n         *\n         * @param type\n         * @param url\n         * @param callback\n         * @returns {JQueryPromise<any>}\n         */\n        fetchAddress: function ( type, url, callback ) {\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_get_address',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    type: type,\n                    url: url\n                },\n                dataType: 'json'\n            } ).always( function () {\n                //\n            } ).done( function ( response ) {\n                console.log( response );\n                if ( ! response.success ) {\n                    callback( response.data.message )\n                    return;\n                }\n\n                // Fill the address\n                let data = response.data;\n                $.each( data, function ( key, value ) {\n                    [ type ].forEach( function ( section ) {\n                        let el = $( 'input[name=\"' + section + '_' + key + '\"]' );\n                        if ( el.length === 0 ) {\n                            return;\n                        }\n\n                        el.prop('readonly', false);\n                        el.closest( '.form-row' ).removeClass( 'swedbank-pay-locked' );\n                        el.val( value ).change();\n\n                        if ( key === 'country' || key === 'state' ) {\n                            let el1 = $( '#' + section + '_' + key );\n                            if ( typeof window.Select2 !== 'undefined' ) {\n                                el1.select2( 'val', value );\n                            } else if ( typeof $.fn.chosen !== 'undefined' ) {\n                                // Chosen\n                                el1.val( value ).trigger( 'chosen:updated' );\n                                //el1.chosen().change();\n                            } else {\n                                el1.change();\n                            }\n                        }\n                    } );\n                } );\n\n                callback( null, data );\n            });\n        },\n\n        /**\n         * On Address Details Available\n         * @param type billing or shipping\n         * @param data\n         * @returns {*}\n         */\n        onAddressDetailsAvailable: function( type, data ) {\n            console.log( 'onAddressDetailsAvailable', type, data );\n\n            var self = this;\n\n            self.fetchAddress( type, data.url, function ( err ) {\n                if ( err ) {\n                    self.onError( err );\n                    return;\n                }\n\n                self[ type + '_address' ] = data;\n\n                // Show button witch allows to edit the address\n                $('#swedbank-pay-checkin-edit').show();\n\n                // Update checkout to have shipping methods\n                self.enqueueCheckoutUpdate();\n            } );\n        },\n\n        /**\n         * Hide Address Fields on the checkout\n         */\n        hideAddressFields: function () {\n            $( '#address-fields' ).hide();\n        },\n        /**\n         * Show Address Fields on the checkout\n         */\n        showAddressFields: function () {\n            $( '#address-fields' ).show();\n        },\n\n        /**\n         * Initialize Instant Checkout\n         */\n        initInstantCheckout: function () {\n            console.log( 'Initialization of Shortcode Checkout...' );\n        },\n\n        /**\n         * Initialize Checkout\n         * @param reference\n         */\n        initCheckout: function( reference ) {\n            console.log( 'initCheckout' );\n\n            // Add customer reference if exists\n            if ( reference ) {\n                this.form.find( '.swedbank_pay_customer_reference' ).remove();\n                this.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + reference + \"'/>\" );\n            }\n\n            var self = this;\n\n            self.block();\n            this.loadCheckout( function ( err ) {\n                self.unblock();\n\n                if ( err ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + err + '</div>' );\n                }\n            } );\n        },\n\n        isPaymentMethodChosen: function() {\n            //return $( '[name=\"payment_method\"]' ).is( ':checked' );\n            return true;\n        },\n\n        onSubmit: function ( event ) {\n            if ( typeof event !== 'undefined' ) {\n                event.preventDefault();\n            }\n\n            var self = event.data.obj;\n            self.loadCheckout( function ( err ) {\n                if ( err ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + err + '</div>' );\n                }\n            } );\n        },\n\n        onUpdatedCheckout: function( event ) {\n            console.log( 'onUpdatedCheckout' );\n\n            var self = event.data.obj;\n\n            if ( self.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onUpdatedCheckout: Validation is failed' );\n\n                return false;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            self.updateOrder( function () {\n                console.log( 'Order has been updated' );\n            } );\n        },\n\n        onUpdatedShippingMethod: function ( event ) {\n            console.log( 'onUpdatedShippingMethod' );\n\n            var self = event.data.obj;\n\n            if ( self.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            self.updateOrder( function () {\n                console.log( 'Order has been updated' );\n            } );\n        },\n\n        /**\n         * Load Checkout.\n         *\n         * @param callback\n         */\n        loadCheckout: function( callback ) {\n            console.log('loadCheckout');\n\n            var self = this;\n            let terms = $( '#terms' );\n\n            // Validate \"terms and conditions\" if exists\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                callback( WC_Shortcode_Checkout.terms_error );\n                return;\n            }\n\n            // Verify the checkin\n            if ( self.isCheckinEnabled() ) {\n                if ( self.isCheckinRequired() && ! self.isCustomerIdentified() ) {\n                    callback( WC_Shortcode_Checkout.needs_checkin );\n                    return;\n                }\n            }\n\n            // Validate the checkout form\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'The checkout form validation is failed.' );\n\n                //callback( WC_Shortcode_Checkout.checkin_error );\n                callback( null );\n                return;\n            }\n\n            if ( ! self.isPaymentMethodChosen() ) {\n                console.log( 'payex_checkout must be chosen.' );\n\n                callback( 'Please select payment method.' );\n                return;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            self.form.addClass( 'processing' );\n            self.block();\n\n            if ( self.xhr ) {\n                self.xhr.abort();\n            }\n\n            // Place WooCommerce Order\n            self.xhr = self.placeOrder()\n                .always( function ( response ) {\n                    self.form.removeClass( 'processing' );\n                    self.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    callback( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                        callback( null, response );\n                        return;\n                    }\n\n                    if ( response.result !== 'success' ) {\n                        callback( response.messages );\n                        return;\n                    }\n\n                    if ( self.isRedirectMethodEnabled() ) {\n                        // Redirect to the payment gateway page\n                        console.log( 'Redirecting to ' + response['redirect_url'] );\n                        window.location.href = response['redirect_url'];\n\n                        callback( null, response );\n                    } else {\n                        // Load SwedBank Pay Checkout frame\n                        self.js_url = response['js_url'];\n                        self.initPaymentJS( self.js_url, function () {\n                            // Hide \"Place order\"\n                            self.hidePlaceOrder();\n\n                            callback( null, response );\n                        } );\n                    }\n                } );\n\n            return false;\n        },\n\n        resetCheckout: function() {\n            //\n        },\n\n        /**\n         * Initiate Payment Javascript\n         * @param url\n         * @param callback\n         */\n        initPaymentJS: function ( url, callback ) {\n            var self = this;\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Destroy\n            if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                if ( typeof window.payex.hostedView.paymentMenu !== 'undefined' ) {\n                    window.payex.hostedView.paymentMenu().close();\n                }\n\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n                //delete window.payex.hostedView;\n            }\n\n            // Destroy JS\n            $( \"script[src*='px.paymentmenu.client']\" ).remove();\n\n            // Load JS\n            wc_sb_common.loadJs( url, function () {\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n\n                // Load SwedBank Pay Checkout frame\n                // Initiate the payment menu in \"Instant Checkout\"\n                $( '#payment' ).hide();\n                self.initPaymentMenu( 'payment-swedbank-pay-checkout', function () {\n                    callback();\n                } );\n            } );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            var self = this;\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            $( '#' + id ).block({\n                message: null,\n                overlayCSS: {\n                    background: '#fff',\n                    opacity: 0.6\n                }\n            });\n\n            // Load SwedBank Pay Checkout frame\n            this.paymentMenu = window.payex.hostedView.paymentMenu( {\n                container: id,\n                culture: WC_Shortcode_Checkout.culture,\n                style: WC_Shortcode_Checkout.paymentMenuStyle ? JSON.parse( WC_Shortcode_Checkout.paymentMenuStyle ) : null,\n                onApplicationConfigured: function( data ) {\n                    // Prevent multiple callback running using is_payment_menu_loaded\n                    if ( ! self.is_payment_menu_loaded ) {\n                        console.log( 'onApplicationConfigured', data );\n                        $( '#' + id ).unblock();\n                        callback( null );\n                    }\n\n                    self.is_payment_menu_loaded = true;\n                },\n                onPaymentMenuInstrumentSelected: function ( data ) {\n                    console.log( 'onPaymentMenuInstrumentSelected', data );\n                    //$( document.body ).trigger( 'sb_payment_menu_instrument_selected', [ data.name, data.instrument] );\n                    self.onPaymentMenuInstrumentSelected( data.name, data.instrument );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted', data );\n                    window.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled', data );\n                    self.logError( 'payment-menu-cancel', data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed', data );\n                    self.logError( 'payment-menu-failed', data );\n                    //self.location.href = data.redirectUrl;\n                },\n                onPaymentToS: function ( data) {\n                    console.log( 'onPaymentToS', data );\n                    window.open( data.openUrl, '_blank' );\n                },\n                onExternalRedirect: function ( data ) {\n                    console.log( 'onExternalRedirect', data );\n                    window.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    self.logError( 'payment-menu-error', data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n\n        /**\n         * Refresh\n         */\n        refreshPaymentMenu: function() {\n            console.log( 'refreshPaymentMenu' );\n            if ( typeof this.paymentMenu !== 'undefined' && this.paymentMenu ) {\n                if ( this.paymentMenu.hasOwnProperty( 'refresh' ) && typeof this.paymentMenu.refresh === 'function' ) {\n                    this.paymentMenu.refresh();\n                } else {\n                    console.warn( 'refreshPaymentMenu: paymentMenu doesn\\'t support refresh' );\n                }\n            }\n        },\n\n        /**\n         * Place Order\n         * @return {JQueryPromise<any>}\n         */\n        placeOrder: function () {\n            console.log( 'placeOrder' );\n\n            var self = this;\n            let fields = $('.woocommerce-checkout').serialize();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'sbp_submit_order',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } ).done( function ( response ) {\n                // Reload page\n                if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                    window.location.reload();\n                    return;\n                }\n\n                if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                    self.logError( 'sb-place-order', response );\n                    self.onError( response.messages );\n                }\n            } );\n        },\n\n        /**\n         * On Init Or Update Checkout.\n         *\n         * @param event\n         * @returns {boolean}\n         */\n        onInitOrUpdateCheckout: function ( event ) {\n            console.log( 'onInitOrUpdateCheckout' );\n\n            var self = this;\n            if ( typeof event !== 'undefined' ) {\n                self = event.data.obj;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onInitOrUpdateCheckout: Validation is failed' );\n\n                return false;\n            }\n\n            if ( typeof self.paymentMenu !== 'undefined' && self.paymentMenu ) {\n                self.updateOrder( function () {\n                    console.log( 'Order has been updated' );\n                } );\n            } else {\n                // Init Checkout\n                if ( self.isCheckinRequired() && ! self.customer_reference ) {\n                    console.log( 'Checkin is required.' );\n                } else {\n                    self.initCheckout( self.customer_reference );\n                }\n            }\n        },\n\n        /**\n         * Update Order\n         * @param callback\n         * @return {JQueryPromise<any>}\n         */\n        updateOrder: function ( callback ) {\n            console.log( 'updateOrder' );\n            var self = this;\n\n            let fields = $('.woocommerce-checkout').serialize();\n\n            self.form.addClass( 'processing' );\n            self.block();\n\n            if ( self.xhr ) {\n                self.xhr.abort();\n            }\n\n            self.xhr = $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'sbp_update_order',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } )\n                .always( function ( response ) {\n                    self.form.removeClass( 'processing' );\n                    self.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    console.log( 'updateOrder error:' + textStatus );\n                    callback( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n                    callback( null, response );\n\n                    // Update is successful\n                    if ( response.hasOwnProperty('result') && response.result === 'success' ) {\n                        // Refresh Payment Menu\n                        self.refreshPaymentMenu();\n\n                        return;\n                    }\n\n                    // Errors\n                    if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                        if ( response.messages === '' ) {\n                            console.warn( 'Error message is empty.' );\n                            return;\n                        }\n\n                        // SwedBank Payment returns error that Order update is not available\n                        if ( response.messages.indexOf( 'Order update is not available.' ) > -1 ) {\n                            alert( 'Order update is not available.' );\n                            return;\n                        }\n                    }\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( response.hasOwnProperty( 'result' ) && true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                    }\n                } );\n\n            return self.xhr;\n        },\n\n        /**\n         * Enqueue Checkout Update.\n         */\n        enqueueCheckoutUpdate: function () {\n            var self = this;\n\n            if ( self.updateTimer ) {\n                window.clearTimeout( self.updateTimer );\n            }\n\n            self.updateTimer = setTimeout( function () {\n                console.log( 'Update checkout...' );\n                $( document.body ).trigger( 'update_checkout' );\n            }, 1000 );\n        },\n\n        /**\n         * On Payment Menu Instrument Selected\n         * @param name\n         * @param instrument\n         */\n        onPaymentMenuInstrumentSelected: function ( name, instrument ) {\n            var self = this;\n\n            // Apply/remove additional fees\n            async.parallel(\n                {\n                    invoice_fee: function( callback2 ) {\n                        // Apply or Remove invoice fee\n                        if ( 'no' === WC_Shortcode_Checkout.invoice_fee_enabled ) {\n                            callback2( null, false );\n\n                            return;\n                        }\n\n                        self.block();\n\n                        var xhr;\n                        if ( instrument === 'Invoice' ) {\n                            xhr = sb_invoice_fee.apply_fee( false );\n                        } else {\n                            xhr = sb_invoice_fee.remove_fee( false );\n                        }\n\n                        xhr.done( function () {\n                            callback2( null, true );\n                        } );\n                    },\n                    carpay_discount: function( callback2 ) {\n                        // Apply or Remove CarPay discount\n                        if ( 'no' === WC_Shortcode_Checkout.carpay_enabled ) {\n                            callback2( null, false );\n\n                            return;\n                        }\n\n                        self.block();\n\n                        var xhr;\n                        if ( name === 'CarPay' ) {\n                            // Apply discount\n                            xhr = sb_carpay.apply_discount( false );\n                        } else {\n                            // Remove discount\n                            xhr = sb_carpay.remove_discount( false );\n                        }\n\n                        xhr.done( function () {\n                            callback2( null, true );\n                        } );\n                    },\n                    additional: function( callback2 ) {\n                        callback2( null, true );\n\n                        return;\n\n                        $.ajax( {\n                            type: 'POST',\n                            url: WC_Shortcode_Checkout.ajax_url,\n                            data: {\n                                action: 'sbp_recalculate',\n                                nonce: WC_Shortcode_Checkout.nonce,\n                            },\n                            dataType: 'json'\n                        } ).done( function ( response ) {\n                            callback2( null, true );\n                        });\n                    }\n                },\n                function( err, results ) {\n                    if ( results.invoice_fee || results.carpay_discount ) {\n                        // Update checkout\n                        //$( document.body ).trigger( 'update_checkout' );\n                        //$( document.body ).trigger( 'update' );\n                        //self.enqueueCheckoutUpdate();\n                        self.updateOrder( function () {\n                            console.log( 'Order has been updated' );\n                            self.unblock();\n                        } );\n                    }\n                }\n            );\n        },\n\n        onError: function ( data ) {\n            console.log( 'onError', data );\n            this.submit_error( '<div class=\"woocommerce-error\">' + data + '</div>' );\n        },\n\n        submit_error: function( error_message ) {\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            this.form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' );\n            this.form.removeClass( 'processing' ).unblock();\n            this.form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n            this.scroll_to_notices();\n            $( document.body ).trigger( 'checkout_error' );\n        },\n\n        scroll_to_notices: function() {\n            let scrollElement = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n            if ( ! scrollElement.length ) {\n                scrollElement = $( '.form.checkout' );\n            }\n\n            $.scroll_to_notices( scrollElement );\n        },\n\n        /**\n         * Log Error\n         * @param id\n         * @param data\n         * @returns {*}\n         */\n        logError: function ( id, data ) {\n            console.warn( data );\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_log_error',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    id: id,\n                    data: JSON.stringify( data )\n                },\n                dataType: 'json'\n            } );\n        },\n\n        /**\n         * Check the payment url.\n         *\n         * @param callback\n         */\n        checkPaymentUrl: function ( callback ) {\n            if ( !! ( new URLSearchParams( document.location.search ) ).get( 'payment_url' ) && this.payment_url ) {\n                // Lock the checkout\n                $( '.woocommerce-checkout' ).block( {\n                    message: null,\n                    overlayCSS: {\n                        background: '#fff',\n                        opacity: 0.6\n                    }\n                } );\n\n                // Init Payment JS\n                this.initPaymentJS( this.payment_url, function () {\n                    console.log( 'Payment url has been loaded.' );\n                    callback( true );\n                } );\n            } else {\n                callback( false );\n            }\n        },\n\n        /**\n         * Block the checkout form\n         */\n        block: function() {\n            var self = this;\n            if ( self.form ) {\n                let form_data = self.form.data();\n                if ( 1 !== form_data['blockUI.isBlocked'] ) {\n                    self.form.block({\n                        message: null,\n                        overlayCSS: {\n                            background: '#fff',\n                            opacity: 0.6\n                        }\n                    });\n                }\n            }\n        },\n\n        /**\n         * Unblock the checkout form\n         */\n        unblock: function() {\n            if ( this.form ) {\n                this.form.unblock();\n            }\n        },\n\n        /**\n         * Hide \"Place order\" button.\n         */\n        hidePlaceOrder: function () {\n            $('#place_order').hide();\n            $('.place-order').hide();\n\n            // Tick \"terms and conditions\" if exists\n            let terms = $( '#terms' );\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                terms.prop( 'checked', true )\n            }\n        },\n\n        /**\n         * Show \"Place order\" button.\n         */\n        showPlaceOrder: function () {\n            $('#place_order').show();\n            $('.place-order').show();\n        }\n    };\n\n    $(document).ready( function () {\n        wc_sb_shortcode_checkout.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n});\n\n"],"mappings":"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"}