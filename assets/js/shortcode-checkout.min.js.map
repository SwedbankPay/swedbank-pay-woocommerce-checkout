{"version":3,"sources":["shortcode-checkout.js"],"names":["jQuery","$","window","wc_sb_shortcode_checkout","customer_identified","customer_reference","billing_address","shipping_address","js_url","payment_url","WC_Shortcode_Checkout","paymentMenu","is_payment_menu_loaded","xhr","updateTimer","init","form","console","log","self","this","isCheckinEnabled","loadCheckIn","isCheckinRequired","hidePlaceOrder","document","body","on","event","preventDefault","showAddressFields","hideAddressFields","obj","onSubmit","onInitOrUpdateCheckout","checkPaymentUrl","loaded","initInstantCheckout","checkin_enabled","[object Object]","checkin_required","isRedirectMethodEnabled","redirect_method","ajax","type","url","ajax_url","data","action","nonce","dataType","done","success","logError","alert","details","hasOwnProperty","payex","wc_sb_common","loadJs","initCheckIn","waitForLoading","err","warn","hostedView","consumer","container","culture","style","checkInStyle","JSON","parse","onConsumerIdentified","onNewConsumer","onConsumerRemoved","onBillingDetailsAvailable","onAddressDetailsAvailable","onShippingDetailsAvailable","onError","open","async","parallel","save_customer_ref","callback2","saveCustomerRef","response","init_checkout","terms","length","prop","showPlaceOrder","find","remove","append","consumerProfileRef","results","callback","always","message","fetchAddress","each","key","value","forEach","section","el","closest","removeClass","val","change","el1","Select2","select2","fn","chosen","trigger","show","enqueueCheckoutUpdate","hide","initCheckout","reference","block","loadCheckout","unblock","submit_error","isPaymentMethodChosen","onUpdatedCheckout","is","validateForm","updateOrder","onUpdatedShippingMethod","terms_error","isCustomerIdentified","addClass","abort","placeOrder","fail","jqXHR","textStatus","reload","result","refresh","location","href","initPaymentJS","messages","checkin_error","needs_checkin","resetCheckout","close","initPaymentMenu","id","paymentMenuStyle","onApplicationConfigured","onPaymentMenuInstrumentSelected","name","instrument","onPaymentCreated","onPaymentCompleted","redirectUrl","onPaymentCanceled","onPaymentFailed","refreshPaymentMenu","fields","serialize","indexOf","clearTimeout","setTimeout","invoice_fee","invoice_fee_enabled","sb_invoice_fee","apply_fee","remove_fee","carpay_discount","carpay_enabled","sb_carpay","apply_discount","remove_discount","error_message","prepend","blur","scroll_to_notices","scrollElement","stringify","URLSearchParams","search","get","overlayCSS","background","opacity","ready"],"mappings":"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","file":"shortcode-checkout.min.js","sourcesContent":["/* global wc_checkout_params */\n/* global WC_Shortcode_Checkout */\njQuery( function( $ ) {\n    'use strict';\n\n    /**\n     * Object to handle Swedbank Pay checkout payment forms.\n     */\n    window.wc_sb_shortcode_checkout = {\n        customer_identified: null,\n        customer_reference: null,\n        billing_address: null,\n        shipping_address: null,\n        js_url: null,\n        payment_url: WC_Shortcode_Checkout.payment_url,\n        paymentMenu: null,\n        is_payment_menu_loaded: false,\n        xhr: false,\n        updateTimer: null,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            console.log( 'init' );\n\n            var self = this;\n\n            // Init Checkin\n            if ( this.isCheckinEnabled() ) {\n                this.loadCheckIn();\n\n                // Hide Place Order\n                if ( this.isCheckinRequired() ) {\n                    this.hidePlaceOrder();\n                }\n\n                $( document.body ).on( 'click', '#change-address-info', function ( event ) {\n                    event.preventDefault();\n\n                    // Show Address Fields\n                    self.showAddressFields();\n                } );\n\n                this.hideAddressFields();\n            }\n\n            this.form = form;\n            $( this.form )\n                // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n                // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': self}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_checkout' );\n\n            //$( document.body ).on( 'checkout_error', this.resetCheckout );\n            //$( document.body ).on( 'blur', this.onUpdatedCheckout );\n            //$( document.body ).on( 'updated_shipping_method', this.onUpdatedShippingMethod );\n\n            $( document.body ).on(\n                'updated_checkout',\n                null,\n                {'obj': self},\n                this.onInitOrUpdateCheckout\n            );\n\n            this.checkPaymentUrl( function ( loaded ) {\n                if ( ! loaded ) {\n                    // Initialize Instant Checkout\n                    self.initInstantCheckout();\n                }\n            } );\n        },\n\n        /**\n         * Check if the Checkin is active\n         * @return {boolean}\n         */\n        isCheckinEnabled() {\n            return 'yes' === WC_Shortcode_Checkout.checkin_enabled;\n        },\n\n        /**\n         * Check if the Checkin is required\n         * @return {boolean}\n         */\n        isCheckinRequired() {\n            return this.isCheckinEnabled() && 'yes' === WC_Shortcode_Checkout.checkin_required;\n        },\n\n        /**\n         * Check if customer was identified\n         * @return {boolean}\n         */\n        isCustomerIdentified() {\n            return this.customer_identified === true;\n        },\n\n        /**\n         * Check if the redirect method is active\n         * @return {boolean}\n         */\n        isRedirectMethodEnabled() {\n            return 'redirect' === WC_Shortcode_Checkout.redirect_method;\n        },\n\n        /**\n         * Load CheckIn\n         * @returns {*}\n         */\n        loadCheckIn: function() {\n            var self = this;\n\n            // Get `view-consumer-identification`\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkin',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                },\n                dataType: 'json'\n            } ).done( function ( data ) {\n                if ( ! data.success ) {\n                    self.logError( 'sb-checkin-loader', data );\n                    alert( data.details );\n                    return;\n                }\n\n                // Destroy\n                if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                    //if ( typeof window.payex.hostedView.consumer !== 'undefined' ) {\n                    //window.payex.hostedView.consumer().close();\n                    //}\n                }\n\n                // Destroy JS\n                //$( \"script[src*='px.consumer.client']\" ).remove();\n                //$( '#swedbank-pay-checkin iframe' ).remove();\n                wc_sb_common.loadJs( data.data, function () {\n                    self.initCheckIn();\n                } );\n            } );\n        },\n\n        /**\n         * Initialize CheckIn\n         */\n        initCheckIn: function() {\n            if ( typeof payex === 'undefined') {\n                return;\n            }\n\n            var self = this;\n\n            wc_sb_common.waitForLoading('payex.hostedView.consumer', function ( err ) {\n                if ( err ) {\n                    console.warn( err );\n                    return;\n                }\n\n                // Init PayEx hostedView\n                window.payex.hostedView.consumer( {\n                    container: 'swedbank-pay-checkin',\n                    culture: WC_Shortcode_Checkout.culture,\n                    style: WC_Shortcode_Checkout.checkInStyle ? JSON.parse( WC_Shortcode_Checkout.checkInStyle ) : null,\n                    onConsumerIdentified: function( data ) {\n                        console.log( 'hostedView: onConsumerIdentified' );\n                        self.onConsumerIdentified( data );\n                    },\n                    onNewConsumer: function( data ) {\n                        console.log( 'hostedView: onNewConsumer' );\n                        self.onConsumerIdentified( data );\n                    },\n                    onConsumerRemoved: function( data ) {\n                        console.log( 'hostedView: onConsumerRemoved' );\n                        console.log ( data );\n                    },\n                    onBillingDetailsAvailable: function( data ) {\n                        self.onAddressDetailsAvailable( 'billing', data );\n                    },\n                    onShippingDetailsAvailable: function( data ) {\n                        self.onAddressDetailsAvailable( 'shipping', data );\n                    },\n                    onError: function ( data ) {\n                        self.logError( 'sb-checkin', data );\n\n                        alert( data.details );\n                    }\n                } ).open();\n            });\n        },\n\n        /**\n         * On Consumer Identified\n         * @param data\n         */\n        onConsumerIdentified: function ( data ) {\n            console.log( 'onConsumerIdentified', data );\n\n            var self = this;\n\n            async.parallel(\n                {\n                    save_customer_ref: function( callback2 ) {\n                        self.saveCustomerRef( data, function ( err, response ) {\n                            if ( err ) {\n                                alert( err );\n                            }\n\n                            callback2( null, response );\n                        } );\n                    },\n                    init_checkout: function( callback2 ) {\n                        // Tick \"terms and conditions\" if exists\n                        let terms = $( '#terms' );\n                        if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                            terms.prop( 'checked', true )\n                        }\n\n                        self.showPlaceOrder();\n\n                        // Set customer is identified\n                        self.customer_identified = true;\n\n                        // Add the reference to the checkout form\n                        self.form.find( '.swedbank_pay_customer_reference' ).remove();\n                        self.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + data.consumerProfileRef + \"'/>\" );\n\n                        callback2( null, [] );\n                    },\n                },\n                function( err, results ) {\n                    console.log( 'onConsumerIdentified: loaded', results );\n\n                    // Set customer is identified\n                    self.customer_identified = true;\n\n                    // Save customer reference\n                    self.customer_reference = data.consumerProfileRef;\n                }\n            );\n        },\n\n        /**\n         * Save Customer Reference.\n         *\n         * @param data\n         * @param callback\n         */\n        saveCustomerRef: function ( data, callback ) {\n            $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_customer_profile',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    consumerProfileRef: data.consumerProfileRef\n                },\n                dataType: 'json'\n            } ).always( function ( response ) {\n                //\n            } ).done( function ( response) {\n                if ( ! response.success ) {\n                    callback( response.data.message, response );\n                } else {\n                    callback( null, response );\n                }\n            } );\n        },\n\n        /**\n         * Fetch address.\n         *\n         * @param type\n         * @param url\n         * @param callback\n         * @returns {JQueryPromise<any>}\n         */\n        fetchAddress: function ( type, url, callback ) {\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_get_address',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    type: type,\n                    url: url\n                },\n                dataType: 'json'\n            } ).always( function () {\n                //\n            } ).done( function ( response ) {\n                console.log( response );\n                if ( ! response.success ) {\n                    callback( response.data.message )\n                    return;\n                }\n\n                // Fill the address\n                let data = response.data;\n                $.each( data, function ( key, value ) {\n                    [ type ].forEach( function ( section ) {\n                        let el = $( 'input[name=\"' + section + '_' + key + '\"]' );\n                        if ( el.length === 0 ) {\n                            return;\n                        }\n\n                        el.prop('readonly', false);\n                        el.closest( '.form-row' ).removeClass( 'swedbank-pay-locked' );\n                        el.val( value ).change();\n\n                        if ( key === 'country' || key === 'state' ) {\n                            let el1 = $( '#' + section + '_' + key );\n                            if ( typeof window.Select2 !== 'undefined' ) {\n                                el1.select2( 'val', value );\n                            } else if ( typeof $.fn.chosen !== 'undefined' ) {\n                                // Chosen\n                                el1.val( value ).trigger( 'chosen:updated' );\n                                //el1.chosen().change();\n                            } else {\n                                el1.change();\n                            }\n                        }\n                    } );\n                } );\n\n                callback( null, data );\n            });\n        },\n\n        /**\n         * On Address Details Available\n         * @param type billing or shipping\n         * @param data\n         * @returns {*}\n         */\n        onAddressDetailsAvailable: function( type, data ) {\n            console.log( 'onAddressDetailsAvailable', type, data );\n\n            var self = this;\n\n            self.fetchAddress( type, data.url, function ( err ) {\n                if ( err ) {\n                    self.onError( err );\n                    return;\n                }\n\n                self[ type + '_address' ] = data;\n\n                // Show button witch allows to edit the address\n                $('#swedbank-pay-checkin-edit').show();\n\n                // Update checkout to have shipping methods\n                self.enqueueCheckoutUpdate();\n            } );\n        },\n\n        /**\n         * Hide Address Fields on the checkout\n         */\n        hideAddressFields: function () {\n            $( '#address-fields' ).hide();\n        },\n        /**\n         * Show Address Fields on the checkout\n         */\n        showAddressFields: function () {\n            $( '#address-fields' ).show();\n        },\n\n        /**\n         * Initialize Instant Checkout\n         */\n        initInstantCheckout: function () {\n            console.log( 'Initialization of Shortcode Checkout...' );\n        },\n\n        /**\n         * Initialize Checkout\n         * @param reference\n         */\n        initCheckout: function( reference ) {\n            console.log( 'initCheckout' );\n\n            // Add customer reference if exists\n            if ( reference ) {\n                this.form.find( '.swedbank_pay_customer_reference' ).remove();\n                this.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + reference + \"'/>\" );\n            }\n\n            var self = this;\n\n            self.block();\n            this.loadCheckout( function ( err ) {\n                self.unblock();\n\n                if ( err ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + err + '</div>' );\n                }\n            } );\n        },\n\n        isPaymentMethodChosen: function() {\n            //return $( '[name=\"payment_method\"]' ).is( ':checked' );\n            return true;\n        },\n\n        onSubmit: function ( event ) {\n            if ( typeof event !== 'undefined' ) {\n                event.preventDefault();\n            }\n\n            var self = event.data.obj;\n            self.loadCheckout( function ( err ) {\n                if ( err ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + err + '</div>' );\n                }\n            } );\n        },\n\n        onUpdatedCheckout: function( event ) {\n            console.log( 'onUpdatedCheckout' );\n\n            var self = event.data.obj;\n\n            if ( self.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onUpdatedCheckout: Validation is failed' );\n\n                return false;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            self.updateOrder( function () {\n                console.log( 'Order has been updated' );\n            } );\n        },\n\n        onUpdatedShippingMethod: function ( event ) {\n            console.log( 'onUpdatedShippingMethod' );\n\n            var self = event.data.obj;\n\n            if ( self.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            self.updateOrder( function () {\n                console.log( 'Order has been updated' );\n            } );\n        },\n\n        /**\n         * Load Checkout.\n         *\n         * @param callback\n         */\n        loadCheckout: function( callback ) {\n            console.log('loadCheckout');\n\n            var self = this;\n            let terms = $( '#terms' );\n\n            // Validate \"terms and conditions\" if exists\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                callback( WC_Shortcode_Checkout.terms_error );\n                return;\n            }\n\n            // Verify the checkin\n            if ( self.isCheckinEnabled() ) {\n                if ( self.isCheckinRequired() && ! self.isCustomerIdentified() ) {\n                    callback( WC_Shortcode_Checkout.needs_checkin );\n                    return;\n                }\n            }\n\n            // Validate the checkout form\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'The checkout form validation is failed.' );\n\n                callback( WC_Shortcode_Checkout.checkin_error );\n                return;\n            }\n\n            if ( ! self.isPaymentMethodChosen() ) {\n                console.log( 'payex_checkout must be chosen.' );\n\n                callback( 'Please select payment method.' );\n                return;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            self.form.addClass( 'processing' );\n            self.block();\n\n            if ( self.xhr ) {\n                self.xhr.abort();\n            }\n\n            // Place WooCommerce Order\n            self.xhr = self.placeOrder()\n                .always( function ( response ) {\n                    self.form.removeClass( 'processing' );\n                    self.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    callback( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                        callback( null, response );\n                        return;\n                    }\n\n                    if ( response.result !== 'success' ) {\n                        callback( response.messages );\n                        return;\n                    }\n\n                    if ( self.isRedirectMethodEnabled() ) {\n                        // Redirect to the payment gateway page\n                        console.log( 'Redirecting to ' + response['redirect_url'] );\n                        window.location.href = response['redirect_url'];\n\n                        callback( null, response );\n                    } else {\n                        // Load SwedBank Pay Checkout frame\n                        self.js_url = response['js_url'];\n                        self.initPaymentJS( self.js_url, function () {\n                            // Hide \"Place order\"\n                            self.hidePlaceOrder();\n\n                            callback( null, response );\n                        } );\n                    }\n                } );\n\n            return false;\n        },\n\n        resetCheckout: function() {\n            //\n        },\n\n        /**\n         * Initiate Payment Javascript\n         * @param url\n         * @param callback\n         */\n        initPaymentJS: function ( url, callback ) {\n            var self = this;\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Destroy\n            if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                if ( typeof window.payex.hostedView.paymentMenu !== 'undefined' ) {\n                    window.payex.hostedView.paymentMenu().close();\n                }\n\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n                //delete window.payex.hostedView;\n            }\n\n            // Destroy JS\n            $( \"script[src*='px.paymentmenu.client']\" ).remove();\n\n            // Load JS\n            wc_sb_common.loadJs( url, function () {\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n\n                // Load SwedBank Pay Checkout frame\n                // Initiate the payment menu in \"Instant Checkout\"\n                $( '#payment' ).hide();\n                self.initPaymentMenu( 'payment-swedbank-pay-checkout', function () {\n                    callback();\n                } );\n            } );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            var self = this;\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Load SwedBank Pay Checkout frame\n            this.paymentMenu = window.payex.hostedView.paymentMenu( {\n                container: id,\n                culture: WC_Shortcode_Checkout.culture,\n                style: WC_Shortcode_Checkout.paymentMenuStyle ? JSON.parse( WC_Shortcode_Checkout.paymentMenuStyle ) : null,\n                onApplicationConfigured: function( data ) {\n                    console.log( 'onApplicationConfigured' );\n                    console.log( data );\n                    self.is_payment_menu_loaded = true;\n                    callback( null );\n                },\n                onPaymentMenuInstrumentSelected: function ( data ) {\n                    console.log( 'onPaymentMenuInstrumentSelected' );\n                    console.log( data );\n                    self.onPaymentMenuInstrumentSelected( data.name, data.instrument );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted' );\n                    console.log( data );\n                    window.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled' );\n                    console.log( data );\n                    self.logError( 'payment-menu-cancel', data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed' );\n                    console.log( data );\n                    self.logError( 'payment-menu-failed', data );\n                    //self.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    self.logError( 'payment-menu-error', data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n\n        /**\n         * Refresh\n         */\n        refreshPaymentMenu: function() {\n            console.log( 'refreshPaymentMenu' );\n            if ( typeof this.paymentMenu !== 'undefined' && this.paymentMenu ) {\n                if ( this.paymentMenu.hasOwnProperty( 'refresh' ) && typeof this.paymentMenu.refresh === 'function' ) {\n                    this.paymentMenu.refresh();\n                } else {\n                    console.warn( 'refreshPaymentMenu: paymentMenu doesn\\'t support refresh' );\n                }\n            }\n        },\n\n        /**\n         * Place Order\n         * @return {JQueryPromise<any>}\n         */\n        placeOrder: function () {\n            console.log( 'placeOrder' );\n\n            var self = this;\n            let fields = $('.woocommerce-checkout').serialize();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'sbp_submit_order',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } ).done( function ( response ) {\n                // Reload page\n                if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                    window.location.reload();\n                    return;\n                }\n\n                if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                    self.logError( 'sb-place-order', response );\n                    self.onError( response.messages );\n                }\n            } );\n        },\n\n        /**\n         * On Init Or Update Checkout.\n         *\n         * @param event\n         * @returns {boolean}\n         */\n        onInitOrUpdateCheckout: function ( event ) {\n            console.log( 'onInitOrUpdateCheckout' );\n\n            var self = this;\n            if ( typeof event !== 'undefined' ) {\n                self = event.data.obj;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onInitOrUpdateCheckout: Validation is failed' );\n\n                return false;\n            }\n\n            if ( typeof self.paymentMenu !== 'undefined' && self.paymentMenu ) {\n                self.updateOrder( function () {\n                    console.log( 'Order has been updated' );\n                } );\n            } else {\n                // Init Checkout\n                if ( self.isCheckinRequired() && ! self.customer_reference ) {\n                    console.log( 'Checkin is required.' );\n                } else {\n                    self.initCheckout( self.customer_reference );\n                }\n            }\n        },\n\n        /**\n         * Update Order\n         * @param callback\n         * @return {JQueryPromise<any>}\n         */\n        updateOrder: function ( callback ) {\n            console.log( 'updateOrder' );\n            var self = this;\n\n            let fields = $('.woocommerce-checkout').serialize();\n\n            self.form.addClass( 'processing' );\n            self.block();\n\n            if ( self.xhr ) {\n                self.xhr.abort();\n            }\n\n            self.xhr = $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'sbp_update_order',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } )\n                .always( function ( response ) {\n                    self.xhr = false;\n                    self.form.removeClass( 'processing' );\n                    self.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    console.log( 'updateOrder error:' + textStatus );\n                    callback( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n                    callback( null, response );\n\n                    // Update is successful\n                    if ( response.hasOwnProperty('result') && response.result === 'success' ) {\n                        // Refresh Payment Menu\n                        self.refreshPaymentMenu();\n\n                        return;\n                    }\n\n                    // Errors\n                    if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                        if ( response.messages === '' ) {\n                            console.warn( 'Error message is empty.' );\n                            return;\n                        }\n\n                        // SwedBank Payment returns error that Order update is not available\n                        if ( response.messages.indexOf( 'Order update is not available.' ) > -1 ) {\n                            alert( 'Order update is not available.' );\n                            return;\n                        }\n                    }\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( response.hasOwnProperty( 'result' ) && true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                    }\n                } );\n\n            return self.xhr;\n        },\n\n        /**\n         * Enqueue Checkout Update.\n         */\n        enqueueCheckoutUpdate: function () {\n            var self = this;\n\n            if ( self.updateTimer ) {\n                window.clearTimeout( self.updateTimer );\n            }\n\n            self.updateTimer = setTimeout( function () {\n                console.log( 'Update checkout...' );\n                //self.onInitOrUpdateCheckout();\n                $( document.body ).trigger( 'update_checkout' );\n            }, 1000 );\n        },\n\n        /**\n         * On Payment Menu Instrument Selected\n         * @param name\n         * @param instrument\n         */\n        onPaymentMenuInstrumentSelected: function ( name, instrument ) {\n            console.log( 'onPaymentMenuInstrumentSelected', name, instrument );\n            //$( document.body ).trigger( 'sb_payment_menu_instrument_selected', [name, instrument] );\n\n            var self = this;\n\n            // Apply/remove additional fees\n            async.parallel(\n                {\n                    invoice_fee: function( callback2 ) {\n                        // Apply or Remove invoice fee\n                        if ( 'no' === WC_Shortcode_Checkout.invoice_fee_enabled ) {\n                            callback2( null, false );\n\n                            return;\n                        }\n\n                        self.block();\n\n                        var xhr;\n                        if ( instrument === 'Invoice' ) {\n                            xhr = sb_invoice_fee.apply_fee( false );\n                        } else {\n                            xhr = sb_invoice_fee.remove_fee( false );\n                        }\n\n                        xhr.done( function () {\n                            callback2( null, true );\n                        } );\n                    },\n                    carpay_discount: function( callback2 ) {\n                        // Apply or Remove CarPay discount\n                        if ( 'no' === WC_Shortcode_Checkout.carpay_enabled ) {\n                            callback2( null, false );\n\n                            return;\n                        }\n\n                        self.block();\n\n                        var xhr;\n                        if ( name === 'CarPay' ) {\n                            // Apply discount\n                            xhr = sb_carpay.apply_discount( false );\n                        } else {\n                            // Remove discount\n                            xhr = sb_carpay.remove_discount( false );\n                        }\n\n                        xhr.done( function () {\n                            callback2( null, true );\n                        } );\n                    },\n                },\n                function( err, results ) {\n                    if ( results.invoice_fee || results.carpay_discount ) {\n                        self.unblock();\n\n                        // Update checkout\n                        $( document.body ).trigger( 'update_checkout' );\n                        //$( document.body ).trigger( 'update' );\n                    }\n                }\n            );\n        },\n\n        onError: function ( data ) {\n            console.log( 'onError', data );\n            this.submit_error( '<div class=\"woocommerce-error\">' + data + '</div>' );\n        },\n\n        submit_error: function( error_message ) {\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            this.form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' );\n            this.form.removeClass( 'processing' ).unblock();\n            this.form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n            this.scroll_to_notices();\n            $( document.body ).trigger( 'checkout_error' );\n        },\n\n        scroll_to_notices: function() {\n            let scrollElement = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n            if ( ! scrollElement.length ) {\n                scrollElement = $( '.form.checkout' );\n            }\n\n            $.scroll_to_notices( scrollElement );\n        },\n\n        /**\n         * Log Error\n         * @param id\n         * @param data\n         * @returns {*}\n         */\n        logError: function ( id, data ) {\n            console.warn( data );\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Shortcode_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_log_error',\n                    nonce: WC_Shortcode_Checkout.nonce,\n                    id: id,\n                    data: JSON.stringify( data )\n                },\n                dataType: 'json'\n            } );\n        },\n\n        /**\n         * Check the payment url.\n         *\n         * @param callback\n         */\n        checkPaymentUrl: function ( callback ) {\n            if ( !! ( new URLSearchParams( document.location.search ) ).get( 'payment_url' ) && this.payment_url ) {\n                // Lock the checkout\n                $( '.woocommerce-checkout' ).block( {\n                    message: null,\n                    overlayCSS: {\n                        background: '#fff',\n                        opacity: 0.6\n                    }\n                } );\n\n                // Init Payment JS\n                this.initPaymentJS( this.payment_url, function () {\n                    console.log( 'Payment url has been loaded.' );\n                    callback( true );\n                } );\n            } else {\n                callback( false );\n            }\n        },\n\n        /**\n         * Block the checkout form\n         */\n        block: function() {\n            var self = this;\n            if ( self.form ) {\n                let form_data = self.form.data();\n                if ( 1 !== form_data['blockUI.isBlocked'] ) {\n                    self.form.block({\n                        message: null,\n                        overlayCSS: {\n                            background: '#fff',\n                            opacity: 0.6\n                        }\n                    });\n                }\n            }\n        },\n\n        /**\n         * Unblock the checkout form\n         */\n        unblock: function() {\n            if ( this.form ) {\n                this.form.unblock();\n            }\n        },\n\n        /**\n         * Hide \"Place order\" button.\n         */\n        hidePlaceOrder: function () {\n            $('#place_order').hide();\n            $('.place-order').hide();\n\n            // Tick \"terms and conditions\" if exists\n            let terms = $( '#terms' );\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                terms.prop( 'checked', true )\n            }\n        },\n\n        /**\n         * Show \"Place order\" button.\n         */\n        showPlaceOrder: function () {\n            $('#place_order').show();\n            $('.place-order').show();\n        }\n    };\n\n    $(document).ready( function () {\n        wc_sb_shortcode_checkout.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n});\n\n"]}