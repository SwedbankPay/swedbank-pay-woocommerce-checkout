{"version":3,"sources":["common.js"],"names":["jQuery","$","window","wc_sb_common","isInstantCheckout","WC_Gateway_Swedbank_Pay_Checkout","instant_checkout","isRedirectMethodEnabled","redirect_method","loadJs","js","callback","script","document","createElement","setAttribute","addEventListener","oHead","getElementsByTagName","appendChild","waitForLoading","var_string","obj","eval","e","attempts","timer","setInterval","clearInterval","block","wc_sb_checkout","form","data","message","overlayCSS","background","opacity","unblock","logError","id","console","warn","ajax","type","url","ajax_url","action","nonce","JSON","stringify","dataType","validateForm","$required_inputs","validated","is","find","not","length","each","$this","this","$parent","closest","validate_required","validate_email","attr","val","RegExp","test"],"mappings":"AACAA,OAAQ,SAAUC,GACdC,OAAOC,aAAe,CAKlBC,kBAAiB,IACN,QAAUC,iCAAiCC,iBAOtDC,wBAAuB,IACZ,aAAeF,iCAAiCG,gBAQ3DC,OAAQ,SAAWC,EAAIC,GAEnB,IAAIC,EAASC,SAASC,cAAe,UAGrCF,EAAOG,aAAc,MAAOL,GAC5BE,EAAOG,aAAc,OAAQ,mBAC7BH,EAAOG,aAAc,QAAS,IAC9BH,EAAOI,iBAAkB,OAAQ,WAC7BL,MACD,GAGH,IAAIM,EAAQJ,SAASK,qBAAsB,QAAS,GAMpD,OALKD,GAEDA,EAAME,YAAaP,GAGhBA,GAQXQ,eAAgB,SAAWC,WAAYV,UACnC,IACI,IAAIW,IAAMC,KAAMF,YAClB,MAAOG,GAEL,YADAb,SAAUa,GAId,IAAIC,SAAW,EACXC,MAAQxB,OAAOyB,YAAa,gBACR,IAARL,KACRpB,OAAO0B,cAAeF,OACtBf,SAAU,KAAMW,QAEhBG,UACiB,MACbvB,OAAO0B,cAAeF,OACtBf,SAAU,aAGnB,MAMPkB,MAAO,WACH,GAA+B,oBAAnBC,eAAiC,CAEpC,IADWA,eAAeC,KAAKC,OACf,sBACjBF,eAAeC,KAAKF,MAAM,CACtBI,QAAS,KACTC,WAAY,CACRC,WAAY,OACZC,QAAS,QAU7BC,QAAS,WAC0B,oBAAnBP,gBACRA,eAAeC,KAAKM,WAU5BC,SAAU,SAAWC,EAAIP,GAGrB,OAFAQ,QAAQC,KAAMT,GAEP/B,EAAEyC,KAAM,CACXC,KAAM,OACNC,IAAKvC,iCAAiCwC,SACtCb,KAAM,CACFc,OAAQ,kCACRC,MAAO1C,iCAAiC0C,MACxCR,GAAIA,EACJP,KAAMgB,KAAKC,UAAWjB,IAE1BkB,SAAU,UAQlBC,aAAc,WACV,IAAIC,EACAC,GAAY,EAoChB,OAhCID,EADCnD,EAAG,uCAAwCqD,GAAI,YAC7BrD,EAAG,mGAAoGsD,KAAK,iBAAiBC,IAAKvD,EAAG,yCAErIA,EAAG,kDAAmDsD,KAAK,iBAAiBC,IAAKvD,EAAG,0CAGrFwD,QAClBL,EAAiBM,KAAM,WACnB,IAAIC,EAAQ1D,EAAG2D,MACXC,EAAoBF,EAAMG,QAAS,aACnCC,EAAoBF,EAAQP,GAAI,sBAChCU,EAAoBH,EAAQP,GAAI,oBAE/BS,IACI,aAAeJ,EAAMM,KAAM,SAAcN,EAAML,GAAI,YAE5B,KAAhBK,EAAMO,QACdb,GAAY,GAFZA,GAAY,GAMfW,KACIL,EAAMO,QAEO,IAAIC,OAAO,84BACVC,KAAMT,EAAMO,SACvBb,GAAY,OAOzBA","file":"common.min.js","sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    window.wc_sb_common = {\n        /**\n         * Check if the Instant Checkout is active\n         * @return {boolean}\n         */\n        isInstantCheckout() {\n            return 'yes' === WC_Gateway_Swedbank_Pay_Checkout.instant_checkout;\n        },\n\n        /**\n         * Check if the redirect method is active\n         * @return {boolean}\n         */\n        isRedirectMethodEnabled() {\n            return 'redirect' === WC_Gateway_Swedbank_Pay_Checkout.redirect_method;\n        },\n\n        /**\n         * Load JS\n         * @param js\n         * @param callback\n         */\n        loadJs: function ( js, callback ) {\n            // Creates a new script tag\n            let script = document.createElement( 'script' );\n\n            // Set script tag params\n            script.setAttribute( 'src', js );\n            script.setAttribute( 'type', 'text/javascript' );\n            script.setAttribute( 'async', '' );\n            script.addEventListener( 'load', function () {\n                callback();\n            }, false );\n\n            // Gets document head element\n            let oHead = document.getElementsByTagName( 'head' )[0];\n            if ( oHead ) {\n                // Add script tag to head\n                oHead.appendChild( script );\n            }\n\n            return script;\n        },\n\n        /**\n         * Wait for object is loaded\n         * @param var_string\n         * @param callback\n         */\n        waitForLoading: function ( var_string, callback ) {\n            try {\n                var obj = eval( var_string );\n            } catch (e) {\n                callback( e );\n                return;\n            }\n\n            let attempts = 0;\n            let timer = window.setInterval( function() {\n                if ( typeof obj !== 'undefined' ) {\n                    window.clearInterval( timer );\n                    callback( null, obj );\n                } else {\n                    attempts++;\n                    if ( attempts >= 120 ) {\n                        window.clearInterval( timer );\n                        callback( 'Timeout' );\n                    }\n                }\n            }, 500 );\n        },\n\n        /**\n         * Block the checkout form\n         */\n        block: function() {\n            if ( typeof wc_sb_checkout !== 'undefined' ) {\n                let form_data = wc_sb_checkout.form.data();\n                if ( 1 !== form_data['blockUI.isBlocked'] ) {\n                    wc_sb_checkout.form.block({\n                        message: null,\n                        overlayCSS: {\n                            background: '#fff',\n                            opacity: 0.6\n                        }\n                    });\n                }\n            }\n        },\n\n        /**\n         * Unblock the checkout form\n         */\n        unblock: function() {\n            if ( typeof wc_sb_checkout !== 'undefined' ) {\n                wc_sb_checkout.form.unblock();\n            }\n        },\n\n        /**\n         * Log Error\n         * @param id\n         * @param data\n         * @returns {*}\n         */\n        logError: function ( id, data ) {\n            console.warn( data );\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_log_error',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    id: id,\n                    data: JSON.stringify( data )\n                },\n                dataType: 'json'\n            } );\n        },\n\n        /**\n         * Validate checkout fields on the checkout form\n         * @return {boolean}\n         */\n        validateForm: function () {\n            var $required_inputs,\n                validated = true;\n\n            // check to see if we need to validate shipping address\n            if ( $( '#ship-to-different-address-checkbox' ).is( ':checked' ) ) {\n                $required_inputs = $( '.woocommerce-billing-fields .validate-required, .woocommerce-shipping-fields .validate-required' ).find('input, select').not( $( '#account_password, #account_username' ) );\n            } else {\n                $required_inputs = $( '.woocommerce-billing-fields .validate-required' ).find('input, select').not( $( '#account_password, #account_username' ) );\n            }\n\n            if ( $required_inputs.length ) {\n                $required_inputs.each( function() {\n                    var $this = $( this ),\n                        $parent           = $this.closest( '.form-row' ),\n                        validate_required = $parent.is( '.validate-required' ),\n                        validate_email    = $parent.is( '.validate-email' );\n\n                    if ( validate_required ) {\n                        if ( 'checkbox' === $this.attr( 'type' ) && ! $this.is( ':checked' ) ) {\n                            validated = false;\n                        } else if ( $this.val() === '' ) {\n                            validated = false;\n                        }\n                    }\n\n                    if ( validate_email ) {\n                        if ( $this.val() ) {\n                            /* https://stackoverflow.com/questions/2855865/jquery-validate-e-mail-address-regex */\n                            var pattern = new RegExp(/^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?$/i);\n                            if ( ! pattern.test( $this.val()  ) ) {\n                                validated = false;\n                            }\n                        }\n                    }\n                });\n            }\n\n            return validated;\n        },\n    }\n} );\n"]}