{"version":3,"file":"instant-checkout.min.js","names":["jQuery","$","window","wc_sb_checkout","js_url","payment_url","WC_Gateway_Swedbank_Pay_Checkout","paymentMenu","isPaymentMenuLoaded","xhr","isLocked","init","form","this","form_submit","on","obj","onSubmit","document","body","bind","onUpdateCheckout","resetCheckout","onUpdatedCheckout","checkPaymentUrl","loaded","wc_sb_common","isInstantCheckout","initInstantCheckout","console","log","initCheckout","reference","find","remove","append","data","isPaymentMethodChosen","is","onClose","unblock","onReady","validateForm","updateOrder","event","self","terms","length","prop","submit_error","terms_error","hasOwnProperty","wc_sb_checkin","isCheckinEnabled","isCheckinRequired","isCustomerIdentified","WC_Gateway_Swedbank_Pay_Checkin","needs_checkin","e","preventDefault","addClass","block","placeOrder","always","response","removeClass","fail","jqXHR","textStatus","onError","done","result","reload","location","refresh","trigger","messages","isRedirectMethodEnabled","href","initPaymentJS","checkin_error","url","callback","payex","hostedView","close","loadJs","hide","initPaymentMenu","featherlight","variant","persist","closeOnClick","closeOnEsc","afterOpen","afterClose","id","container","culture","style","paymentMenuStyle","JSON","parse","onApplicationConfigured","onPaymentMenuInstrumentSelected","name","instrument","onPaymentCreated","onPaymentCompleted","redirectUrl","onPaymentCanceled","logError","onPaymentFailed","open","refreshPaymentMenu","warn","fields","serialize","ajax","type","ajax_url","action","nonce","dataType","compatibility","alert","abort","indexOf","error_message","prepend","blur","scroll_to_notices","scrollElement","URLSearchParams","search","get","lockCheckout","unlockCheckout","message","overlayCSS","background","opacity","ready"],"sources":["instant-checkout.js"],"sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    'use strict';\n\n    /**\n     * Object to handle Swedbank Pay checkout payment forms.\n     */\n    window.wc_sb_checkout = {\n        js_url: null,\n        payment_url: WC_Gateway_Swedbank_Pay_Checkout.payment_url,\n        paymentMenu: null,\n        isPaymentMenuLoaded: false,\n        xhr: false,\n        isLocked: false,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            this.form         = form;\n            this.form_submit  = false;\n\n            $( this.form )\n            // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n            // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': window.wc_sb_checkout}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_checkout' );\n\n            $( document.body ).bind( 'update_checkout', this.onUpdateCheckout );\n            $( document.body ).on( 'checkout_error', this.resetCheckout );\n            $( document.body ).on( 'updated_checkout', this.onUpdatedCheckout );\n            $( document.body ).on( 'blur', this.onUpdatedCheckout );\n\n            this.checkPaymentUrl( function ( loaded ) {\n                if ( ! loaded ) {\n                    // Initialize Instant Checkout\n                    if ( wc_sb_common.isInstantCheckout() ) {\n                        wc_sb_checkout.initInstantCheckout();\n                    }\n                }\n            } );\n        },\n\n        /**\n         * Initialize Instant Checkout\n         */\n        initInstantCheckout: function () {\n            console.log( 'Initialization of Instant Checkout...' );\n        },\n\n        initCheckout: function( reference ) {\n            wc_sb_checkout.form.find( '.swedbank_pay_customer_reference' ).remove();\n            wc_sb_checkout.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + reference + \"'/>\" );\n            wc_sb_checkout.onSubmit(\n                {\n                    data: {\n                        obj: window.wc_sb_checkout\n                    }\n                }\n            );\n        },\n\n        isPaymentMethodChosen: function() {\n            return $( '#payment_method_payex_checkout' ).is( ':checked' );\n        },\n\n        onClose: function() {\n            wc_sb_common.unblock();\n        },\n\n        onReady: function() {\n            console.log( 'Ready' );\n        },\n\n        onUpdateCheckout: function() {\n            console.log( 'onUpdateCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            // @todo\n        },\n\n        onUpdatedCheckout: function() {\n            console.log( 'onUpdatedCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            if ( wc_sb_checkout.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onUpdatedCheckout: Validation is failed' );\n                return false;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.updateOrder();\n        },\n\n        onSubmit: function( event ) {\n            var self = event.data.obj;\n            let terms = $( '#terms' );\n\n            // Validate \"terms and conditions\" if exists\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.terms_error + '</div>' );\n                return false;\n            }\n\n            // Verify the checkin\n            if ( window.hasOwnProperty( 'wc_sb_checkin' ) && window.wc_sb_checkin.isCheckinEnabled() ) {\n                if ( window.wc_sb_checkin.isCheckinRequired() && ! window.wc_sb_checkin.isCustomerIdentified() ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkin.needs_checkin + '</div>' );\n                    return false;\n                }\n            }\n\n            if ( self.form_submit ) {\n                return true;\n            }\n\n            if ( self.isPaymentMethodChosen() ) {\n                if ( typeof e !== 'undefined' ) {\n                    e.preventDefault();\n                }\n\n                if ( ! wc_sb_common.validateForm() ) {\n                    console.log( 'The checkout form validation is failed.' );\n\n                    if ( self.isCheckinEnabled() ) {\n                        self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.checkin_error + '</div>' );\n                    }\n\n                    return false;\n                }\n\n                console.log( 'onSubmit' );\n\n                if ( self.form.is( '.processing' ) ) {\n                    return false;\n                }\n\n                $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n                self.form.addClass( 'processing' );\n                wc_sb_common.block();\n                self.placeOrder()\n                    .always( function ( response ) {\n                        self.form.removeClass( 'processing' );\n                        wc_sb_common.unblock();\n                    } )\n                    .fail( function( jqXHR, textStatus ) {\n                        self.onError( textStatus );\n                    } )\n                    .done( function ( response) {\n                        console.log( response );\n                        if ( response.result !== 'success' ) {\n                            // Reload page\n                            if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                                window.location.reload();\n                                return;\n                            }\n\n                            // Trigger update in case we need a fresh nonce\n                            if ( true === response.result.refresh ) {\n                                $( document.body ).trigger( 'update_checkout' );\n                            }\n\n                            self.onError( response.messages );\n                            return;\n                        }\n\n                        if ( wc_sb_common.isRedirectMethodEnabled() ) {\n                            // Redirect to the payment gateway page\n                            console.log( 'Redirecting to ' + response['redirect_url'] );\n                            window.location.href = response['redirect_url'];\n                        } else {\n                            // Load SwedBank Pay Checkout frame\n                            self.js_url = response['js_url'];\n                            self.initPaymentJS( self.js_url );\n                        }\n                    } );\n\n                return false;\n            }\n\n            return true;\n        },\n\n        resetCheckout: function() {\n            wc_sb_checkout.form_submit = false;\n        },\n\n        /**\n         * Check if Checkin is enabled\n         * @return {boolean}\n         */\n        isCheckinEnabled: function () {\n            if ( window.hasOwnProperty( 'wc_sb_checkin' ) ) {\n                return window.wc_sb_checkin.isCheckinEnabled();\n            }\n\n            return false;\n        },\n\n        /**\n         * Initiate Payment Javascript\n         * @param url\n         * @param callback\n         */\n        initPaymentJS: function ( url, callback ) {\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Destroy\n            if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                if ( typeof window.payex.hostedView.paymentMenu !== 'undefined' ) {\n                    window.payex.hostedView.paymentMenu().close();\n                }\n\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n                //delete window.payex.hostedView;\n            }\n\n            // Destroy JS\n            $( \"script[src*='px.paymentmenu.client']\" ).remove();\n\n            // Load JS\n            wc_sb_common.loadJs( url, function () {\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n\n                // Load SwedBank Pay Checkout frame\n                if ( wc_sb_common.isInstantCheckout() ) {\n                    // Initiate the payment menu in \"Instant Checkout\"\n                    $( '#payment' ).hide();\n                    wc_sb_checkout.initPaymentMenu( 'payment-swedbank-pay-checkout' );\n                } else {\n                    // Initiate the payment menu in the frame\n                    console.log( 'non-instant checkout' );\n                    $.featherlight( '<div id=\"swedbank-pay-paymentmenu\">&nbsp;</div>', {\n                        variant: 'featherlight-swedbank-seamless',\n                        persist: true,\n                        closeOnClick: false,\n                        closeOnEsc: false,\n                        afterOpen: function () {\n                            wc_sb_checkout.initPaymentMenu( 'swedbank-pay-paymentmenu' );\n                        },\n                        afterClose: function () {\n                            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n                        }\n                    } );\n                }\n\n                callback()\n            } );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Load SwedBank Pay Checkout frame\n            this.paymentMenu = window.payex.hostedView.paymentMenu( {\n                container: id,\n                culture: WC_Gateway_Swedbank_Pay_Checkout.culture,\n                style: WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ? JSON.parse( WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ) : null,\n                onApplicationConfigured: function( data ) {\n                    console.log( 'onApplicationConfigured' );\n                    console.log( data );\n                    wc_sb_checkout.isPaymentMenuLoaded = true;\n                    callback( null );\n                },\n                onPaymentMenuInstrumentSelected: function ( data ) {\n                    console.log( 'onPaymentMenuInstrumentSelected' );\n                    console.log( data );\n                    wc_sb_checkout.onPaymentMenuInstrumentSelected( data.name, data.instrument );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted' );\n                    console.log( data );\n                    self.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-cancel', data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-failed', data );\n                    //self.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    wc_sb_common.logError( 'payment-menu-error', data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n\n        /**\n         * Refresh\n         */\n        refreshPaymentMenu: function() {\n            console.log( 'refreshPaymentMenu' );\n            if ( typeof this.paymentMenu !== 'undefined' && this.paymentMenu ) {\n                if ( this.paymentMenu.hasOwnProperty( 'refresh' ) && typeof this.paymentMenu.refresh === 'function' ) {\n                    this.paymentMenu.refresh();\n                } else {\n                    console.warn( 'refreshPaymentMenu: paymentMenu doesn\\'t support refresh' );\n                }\n            }\n        },\n\n        /**\n         * Place Order\n         * @return {JQueryPromise<any>}\n         */\n        placeOrder: function () {\n            console.log( 'placeOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_place_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } ).done( function ( response ) {\n                // Reload page\n                if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                    window.location.reload();\n                    return;\n         \t\t}\n\n                if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                    wc_sb_common.logError( 'sb-place-order', response );\n                    wc_sb_checkout.onError( response.messages );\n                }\n            } );\n        },\n\n        /**\n         * Update Order\n         * @param compatibility\n         * @return {JQueryPromise<any>}\n         */\n        updateOrder: function ( compatibility ) {\n            if ( this.isLocked ) {\n                return wc_sb_checkout.xhr;\n            }\n\n            console.log( 'updateOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            if ( compatibility ) {\n                alert( 'Order update is not available.' );\n            }\n\n            wc_sb_checkout.form.addClass( 'processing' );\n            wc_sb_common.block();\n\n            if ( wc_sb_checkout.xhr ) {\n                wc_sb_checkout.xhr.abort();\n            }\n\n            wc_sb_checkout.xhr = $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_update_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } )\n                .always( function ( response ) {\n                    wc_sb_checkout.xhr = false;\n                    wc_sb_checkout.form.removeClass( 'processing' );\n                    wc_sb_common.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    console.log( 'updateOrder error:' + textStatus );\n                    //wc_sb_checkout.onError( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n\n                    if ( response.hasOwnProperty('result') && response.result === 'success' ) {\n                        // Refresh Payment Menu\n                        wc_sb_checkout.js_url = response['js_url'];\n                        wc_sb_checkout.refreshPaymentMenu();\n\n                        return;\n                    }\n\n                    if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                        if (response.messages === '') {\n                            console.warn( 'Error message is empty.' );\n                            return;\n                        }\n\n                        // SwedBank Payment returns error that Order update is not available\n                        if ( response.messages.indexOf( 'Order update is not available.' ) > -1 && ! compatibility ) {\n                            // Force reload\n                            console.warn( 'refreshPaymentMenu: refresh workaround. Force reload.' );\n                            wc_sb_checkout.updateOrder( true ).done( function ( response ) {\n                                if ( response.hasOwnProperty('js_url') ) {\n                                    wc_sb_checkout.initPaymentJS( response.js_url );\n                                }\n                            } );\n\n                            return;\n                        }\n                    }\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( response.hasOwnProperty( 'result' ) && true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                    }\n\n                    wc_sb_common.logError( 'sb-update-order', response );\n                    //wc_sb_checkout.onError( response.messages );\n                } );\n\n                return wc_sb_checkout.xhr;\n        },\n\n        /**\n         * On Payment Menu Instrument Selected\n         * @param name\n         * @param instrument\n         */\n        onPaymentMenuInstrumentSelected: function ( name, instrument ) {\n            console.log( 'onPaymentMenuInstrumentSelected', name, instrument );\n            $( document.body ).trigger( 'sb_payment_menu_instrument_selected', [name, instrument] );\n        },\n        onError: function ( data ) {\n            console.log( 'onError', data );\n            wc_sb_checkout.submit_error( '<div class=\"woocommerce-error\">' + data + '</div>' );\n        },\n        submit_error: function( error_message ) {\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' );\n            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n            wc_sb_checkout.form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n            wc_sb_checkout.scroll_to_notices();\n            $( document.body ).trigger( 'checkout_error' );\n        },\n        scroll_to_notices: function() {\n            let scrollElement = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n            if ( ! scrollElement.length ) {\n                scrollElement = $( '.form.checkout' );\n            }\n\n            $.scroll_to_notices( scrollElement );\n        },\n        /**\n         * Check the payment url.\n         *\n         * @param callback\n         */\n        checkPaymentUrl: function ( callback ) {\n            if ( !! ( new URLSearchParams( document.location.search ) ).get( 'payment_url' ) && this.payment_url ) {\n                var self = this;\n                this.lockCheckout();\n                this.initPaymentJS( this.payment_url, function () {\n                    console.log( 'Payment url has been loaded.' );\n                    self.unlockCheckout();\n                    callback( true );\n                } );\n            } else {\n                callback( false );\n            }\n        },\n        /**\n         * Lock the checkout\n         */\n        lockCheckout: function () {\n            this.isLocked = true;\n            $( '.woocommerce-checkout' ).block( {\n                message: null,\n                overlayCSS: {\n                    background: '#fff',\n                    opacity: 0.6\n                }\n            } );\n        },\n        /**\n         * Unlock the checkout\n         */\n        unlockCheckout: function () {\n            this.isLocked = false;\n            $( '.woocommerce-checkout' ).unblock();\n        },\n    };\n\n    $(document).ready( function () {\n        wc_sb_checkout.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n});\n\n"],"mappings":"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"}