{"version":3,"sources":["instant-checkout.js"],"names":["jQuery","$","window","wc_sb_checkout","js_url","paymentMenu","isPaymentMenuLoaded","xhr","init","form","this","form_submit","on","obj","onSubmit","document","body","bind","onUpdateCheckout","resetCheckout","onUpdatedCheckout","wc_sb_common","isInstantCheckout","initInstantCheckout","console","log","isCheckinEnabled","consumerProfileElm","length","reference","data","initCheckout","show","find","remove","append","isPaymentMethodChosen","is","onClose","unblock","onReady","validateForm","updateOrder","event","self","terms","prop","submit_error","WC_Gateway_Swedbank_Pay_Checkout","terms_error","e","preventDefault","addClass","block","placeOrder","always","response","removeClass","fail","jqXHR","textStatus","onError","done","result","hasOwnProperty","reload","location","refresh","trigger","messages","isRedirectMethodEnabled","href","initPaymentJS","checkin_error","url","callback","payex","hostedView","close","loadJs","hide","initPaymentMenu","featherlight","variant","persist","closeOnClick","closeOnEsc","afterOpen","afterClose","id","container","culture","style","paymentMenuStyle","JSON","parse","onApplicationConfigured","onPaymentMenuInstrumentSelected","name","instrument","onPaymentCreated","onPaymentCompleted","redirectUrl","onPaymentCanceled","logError","onPaymentFailed","open","refreshPaymentMenu","warn","fields","serialize","ajax","type","ajax_url","action","nonce","dataType","compatibility","abort","indexOf","error_message","prepend","blur","scroll_to_notices","scrollElement","ready"],"mappings":"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","file":"instant-checkout.min.js","sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    'use strict';\n\n    /**\n     * Object to handle Swedbank Pay checkout payment forms.\n     */\n    window.wc_sb_checkout = {\n        js_url: null,\n        paymentMenu: null,\n        isPaymentMenuLoaded: false,\n        xhr: false,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            this.form         = form;\n            this.form_submit  = false;\n\n            $( this.form )\n            // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n            // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': window.wc_sb_checkout}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_checkout' );\n\n            $( document.body ).bind( 'update_checkout', this.onUpdateCheckout );\n            $( document.body ).on( 'checkout_error', this.resetCheckout );\n            $( document.body ).on( 'updated_checkout', this.onUpdatedCheckout );\n            $( document.body ).on( 'blur', this.onUpdatedCheckout );\n\n            // Initialize Instant Checkout\n            if ( wc_sb_common.isInstantCheckout() ) {\n                wc_sb_checkout.initInstantCheckout();\n            }\n        },\n\n        /**\n         * Initialize Instant Checkout\n         */\n        initInstantCheckout: function () {\n            console.log( 'Initialization of Instant Checkout...' );\n\n            if ( wc_sb_common.isCheckinEnabled() ) {\n                // Use saved consumerProfileRef\n                let consumerProfileElm = $( '#swedbank-pay-consumer-profile' );\n                if ( consumerProfileElm.length > 0 ) {\n                    let reference = consumerProfileElm.data( 'reference' );\n                    console.log( 'Initiate consumerProfileRef', reference );\n                }\n            }\n        },\n\n        initCheckout: function( reference ) {\n            // Show \"Change shipping info\" button\n            $( '#change-shipping-info' ).show();\n\n            wc_sb_checkout.form.find( '.swedbank_pay_customer_reference' ).remove();\n            wc_sb_checkout.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + reference + \"'/>\" );\n            wc_sb_checkout.onSubmit(\n                {\n                    data: {\n                        obj: window.wc_sb_checkout\n                    }\n                }\n           );\n        },\n\n        isPaymentMethodChosen: function() {\n            return $( '#payment_method_payex_checkout' ).is( ':checked' );\n        },\n\n        onClose: function() {\n            wc_sb_common.unblock();\n        },\n\n        onReady: function() {\n            console.log( 'Ready' );\n        },\n\n        onUpdateCheckout: function() {\n            console.log( 'onUpdateCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            // @todo\n        },\n\n        onUpdatedCheckout: function() {\n            console.log( 'onUpdatedCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            if ( wc_sb_checkout.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onUpdatedCheckout: Validation is failed' );\n                return false;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.updateOrder();\n        },\n\n        onSubmit: function( event ) {\n            var self = event.data.obj;\n            let terms = $( '#terms' );\n\n            // Validate \"terms and conditions\" if exists\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.terms_error + '</div>' );\n                return false;\n            }\n\n            if ( self.form_submit ) {\n                return true;\n            }\n\n            if ( self.isPaymentMethodChosen() ) {\n                if ( typeof e !== 'undefined' ) {\n                    e.preventDefault();\n                }\n\n                if ( ! wc_sb_common.validateForm() ) {\n                    console.log( 'The checkout form validation is failed.' );\n\n                    if ( wc_sb_common.isCheckinEnabled() ) {\n                        self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.checkin_error + '</div>' );\n                    }\n\n                    return false;\n                }\n\n                console.log( 'onSubmit' );\n\n                if ( self.form.is( '.processing' ) ) {\n                    return false;\n                }\n\n                $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n                self.form.addClass( 'processing' );\n                wc_sb_common.block();\n                self.placeOrder()\n                    .always( function ( response ) {\n                        self.form.removeClass( 'processing' );\n                        wc_sb_common.unblock();\n                    } )\n                    .fail( function( jqXHR, textStatus ) {\n                        self.onError( textStatus );\n                    } )\n                    .done( function ( response) {\n                        console.log( response );\n                        if ( response.result !== 'success' ) {\n                            // Reload page\n                            if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                                window.location.reload();\n                                return;\n                            }\n\n                            // Trigger update in case we need a fresh nonce\n                            if ( true === response.result.refresh ) {\n                                $( document.body ).trigger( 'update_checkout' );\n                            }\n\n                            self.onError( response.messages );\n                            return;\n                        }\n\n                        if ( wc_sb_common.isRedirectMethodEnabled() ) {\n                            // Redirect to the payment gateway page\n                            console.log( 'Redirecting to ' + response['redirect_url'] );\n                            window.location.href = response['redirect_url'];\n                        } else {\n                            // Load SwedBank Pay Checkout frame\n                            self.js_url = response['js_url'];\n                            self.initPaymentJS( self.js_url );\n                        }\n                    } );\n\n                return false;\n            }\n\n            return true;\n        },\n\n        resetCheckout: function() {\n            wc_sb_checkout.form_submit = false;\n        },\n\n        /**\n         * Initiate Payment Javascript\n         * @param url\n         * @param callback\n         */\n        initPaymentJS: function ( url, callback ) {\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Destroy\n            if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                if ( typeof window.payex.hostedView.paymentMenu !== 'undefined' ) {\n                    window.payex.hostedView.paymentMenu().close();\n                }\n\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n                //delete window.payex.hostedView;\n            }\n\n            // Destroy JS\n            $( \"script[src*='px.paymentmenu.client']\" ).remove();\n\n            // Load JS\n            wc_sb_common.loadJs( url, function () {\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n\n                // Load SwedBank Pay Checkout frame\n                if ( wc_sb_common.isInstantCheckout() ) {\n                    // Initiate the payment menu in \"Instant Checkout\"\n                    $( '#payment' ).hide();\n                    wc_sb_checkout.initPaymentMenu( 'payment-swedbank-pay-checkout' );\n                } else {\n                    // Initiate the payment menu in the frame\n                    console.log( 'non-instant checkout' );\n                    $.featherlight( '<div id=\"swedbank-pay-paymentmenu\">&nbsp;</div>', {\n                        variant: 'featherlight-swedbank-pay',\n                        persist: true,\n                        closeOnClick: false,\n                        closeOnEsc: false,\n                        afterOpen: function () {\n                            wc_sb_checkout.initPaymentMenu( 'swedbank-pay-paymentmenu' );\n                        },\n                        afterClose: function () {\n                            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n                        }\n                    } );\n                }\n\n                callback()\n            } );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Load SwedBank Pay Checkout frame\n            this.paymentMenu = window.payex.hostedView.paymentMenu( {\n                container: id,\n                culture: WC_Gateway_Swedbank_Pay_Checkout.culture,\n                style: WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ? JSON.parse( WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ) : null,\n                onApplicationConfigured: function( data ) {\n                    console.log( 'onApplicationConfigured' );\n                    console.log( data );\n                    wc_sb_checkout.isPaymentMenuLoaded = true;\n                    callback( null );\n                },\n                onPaymentMenuInstrumentSelected: function ( data ) {\n                    console.log( 'onPaymentMenuInstrumentSelected' );\n                    console.log( data );\n                    wc_sb_checkout.onPaymentMenuInstrumentSelected( data.name, data.instrument );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted' );\n                    console.log( data );\n                    self.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-cancel', data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-failed', data );\n                    //self.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    wc_sb_common.logError( 'payment-menu-error', data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n\n        /**\n         * Refresh\n         */\n        refreshPaymentMenu: function() {\n            console.log( 'refreshPaymentMenu' );\n            if ( typeof this.paymentMenu !== 'undefined' && this.paymentMenu ) {\n                if ( this.paymentMenu.hasOwnProperty( 'refresh' ) && typeof this.paymentMenu.refresh === 'function' ) {\n                    this.paymentMenu.refresh();\n                } else {\n                    console.warn( 'refreshPaymentMenu: paymentMenu doesn\\'t support refresh' );\n                }\n            }\n        },\n\n        /**\n         * Place Order\n         * @return {JQueryPromise<any>}\n         */\n        placeOrder: function () {\n            console.log( 'placeOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_place_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } ).done( function ( response ) {\n                // Reload page\n                if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                    window.location.reload();\n                    return;\n         \t\t}\n\n                if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                    wc_sb_common.logError( 'sb-place-order', response );\n                    wc_sb_checkout.onError( response.messages );\n                }\n            } );\n        },\n\n        /**\n         * Update Order\n         * @param compatibility\n         * @return {JQueryPromise<any>}\n         */\n        updateOrder: function ( compatibility ) {\n            console.log( 'updateOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            if ( typeof compatibility === 'undefined' ) {\n                compatibility = false;\n            }\n\n            fields += '&compatibility=' + compatibility;\n\n            wc_sb_checkout.form.addClass( 'processing' );\n            wc_sb_common.block();\n\n            if ( wc_sb_checkout.xhr ) {\n                wc_sb_checkout.xhr.abort();\n            }\n\n            wc_sb_checkout.xhr = $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_update_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } )\n                .always( function ( response ) {\n                    wc_sb_checkout.xhr = false;\n                    wc_sb_checkout.form.removeClass( 'processing' );\n                    wc_sb_common.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    console.log( 'updateOrder error:' + textStatus );\n                    //wc_sb_checkout.onError( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n\n                    if ( response.hasOwnProperty('result') && response.result === 'success' ) {\n                        // Refresh Payment Menu\n                        wc_sb_checkout.js_url = response['js_url'];\n                        wc_sb_checkout.refreshPaymentMenu();\n\n                        return;\n                    }\n\n                    if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                        if (response.messages === '') {\n                            console.warn( 'Error message is empty.' );\n                            return;\n                        }\n\n                        // SwedBank Payment returns error that Order update is not available\n                        if ( response.messages.indexOf( 'Order update is not available.' ) > -1 && ! compatibility ) {\n                            // Force reload\n                            console.warn( 'refreshPaymentMenu: refresh workaround. Force reload.' );\n                            wc_sb_checkout.updateOrder( true ).done( function ( response ) {\n                                if ( response.hasOwnProperty('js_url') ) {\n                                    wc_sb_checkout.initPaymentJS( response.js_url );\n                                }\n                            } );\n\n                            return;\n                        }\n                    }\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                    }\n\n                    wc_sb_common.logError( 'sb-update-order', response );\n                    //wc_sb_checkout.onError( response.messages );\n                } );\n\n                return  wc_sb_checkout.xhr;\n        },\n\n        /**\n         * On Payment Menu Instrument Selected\n         * @param name\n         * @param instrument\n         */\n        onPaymentMenuInstrumentSelected: function ( name, instrument ) {\n            console.log( 'onPaymentMenuInstrumentSelected', name, instrument );\n            $( document.body ).trigger( 'sb_payment_menu_instrument_selected', [name, instrument] );\n        },\n        onError: function ( data ) {\n            console.log( 'onError', data );\n            wc_sb_checkout.submit_error( '<div class=\"woocommerce-error\">' + data + '</div>' );\n        },\n        submit_error: function( error_message ) {\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' );\n            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n            wc_sb_checkout.form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n            wc_sb_checkout.scroll_to_notices();\n            $( document.body ).trigger( 'checkout_error' );\n        },\n        scroll_to_notices: function() {\n            let scrollElement = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n            if ( ! scrollElement.length ) {\n                scrollElement = $( '.form.checkout' );\n            }\n\n            $.scroll_to_notices( scrollElement );\n        },\n    };\n\n    $(document).ready( function () {\n        wc_sb_checkout.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n});\n\n"]}