{"version":3,"sources":["instant-checkout.js"],"names":["jQuery","$","window","wc_sb_checkout","js_url","paymentMenu","isPaymentMenuLoaded","xhr","init","form","this","form_submit","on","obj","onSubmit","document","body","bind","onUpdateCheckout","resetCheckout","onUpdatedCheckout","wc_sb_common","isInstantCheckout","initInstantCheckout","console","log","initCheckout","reference","find","remove","append","data","isPaymentMethodChosen","is","onClose","unblock","onReady","validateForm","updateOrder","event","self","terms","length","prop","submit_error","WC_Gateway_Swedbank_Pay_Checkout","terms_error","hasOwnProperty","wc_sb_checkin","isCheckinEnabled","isCheckinRequired","isCustomerIdentified","WC_Gateway_Swedbank_Pay_Checkin","needs_checkin","e","preventDefault","addClass","block","placeOrder","always","response","removeClass","fail","jqXHR","textStatus","onError","done","result","reload","location","refresh","trigger","messages","isRedirectMethodEnabled","href","initPaymentJS","checkin_error","url","callback","payex","hostedView","close","loadJs","hide","initPaymentMenu","featherlight","variant","persist","closeOnClick","closeOnEsc","afterOpen","afterClose","id","container","culture","style","paymentMenuStyle","JSON","parse","onApplicationConfigured","onPaymentMenuInstrumentSelected","name","instrument","onPaymentCreated","onPaymentCompleted","redirectUrl","onPaymentCanceled","logError","onPaymentFailed","open","refreshPaymentMenu","warn","fields","serialize","ajax","type","ajax_url","action","nonce","dataType","compatibility","abort","indexOf","error_message","prepend","blur","scroll_to_notices","scrollElement","ready"],"mappings":"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","file":"instant-checkout.min.js","sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    'use strict';\n\n    /**\n     * Object to handle Swedbank Pay checkout payment forms.\n     */\n    window.wc_sb_checkout = {\n        js_url: null,\n        paymentMenu: null,\n        isPaymentMenuLoaded: false,\n        xhr: false,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            this.form         = form;\n            this.form_submit  = false;\n\n            $( this.form )\n            // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n            // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': window.wc_sb_checkout}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_checkout' );\n\n            $( document.body ).bind( 'update_checkout', this.onUpdateCheckout );\n            $( document.body ).on( 'checkout_error', this.resetCheckout );\n            $( document.body ).on( 'updated_checkout', this.onUpdatedCheckout );\n            $( document.body ).on( 'blur', this.onUpdatedCheckout );\n\n            // Initialize Instant Checkout\n            if ( wc_sb_common.isInstantCheckout() ) {\n                wc_sb_checkout.initInstantCheckout();\n            }\n        },\n\n        /**\n         * Initialize Instant Checkout\n         */\n        initInstantCheckout: function () {\n            console.log( 'Initialization of Instant Checkout...' );\n        },\n\n        initCheckout: function( reference ) {\n            wc_sb_checkout.form.find( '.swedbank_pay_customer_reference' ).remove();\n            wc_sb_checkout.form.append( \"<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='\" + reference + \"'/>\" );\n            wc_sb_checkout.onSubmit(\n                {\n                    data: {\n                        obj: window.wc_sb_checkout\n                    }\n                }\n            );\n        },\n\n        isPaymentMethodChosen: function() {\n            return $( '#payment_method_payex_checkout' ).is( ':checked' );\n        },\n\n        onClose: function() {\n            wc_sb_common.unblock();\n        },\n\n        onReady: function() {\n            console.log( 'Ready' );\n        },\n\n        onUpdateCheckout: function() {\n            console.log( 'onUpdateCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            // @todo\n        },\n\n        onUpdatedCheckout: function() {\n            console.log( 'onUpdatedCheckout' );\n\n            if ( ! wc_sb_common.isInstantCheckout() ) {\n                return false;\n            }\n\n            if ( wc_sb_checkout.form.is( '.processing' ) ) {\n                return false;\n            }\n\n            if ( ! wc_sb_common.validateForm() ) {\n                console.log( 'onUpdatedCheckout: Validation is failed' );\n                return false;\n            }\n\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.updateOrder();\n        },\n\n        onSubmit: function( event ) {\n            var self = event.data.obj;\n            let terms = $( '#terms' );\n\n            // Validate \"terms and conditions\" if exists\n            if ( terms.length > 0 && ! terms.prop( 'checked' ) ) {\n                self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.terms_error + '</div>' );\n                return false;\n            }\n\n            // Verify the checkin\n            if ( window.hasOwnProperty( 'wc_sb_checkin' ) && window.wc_sb_checkin.isCheckinEnabled() ) {\n                if ( window.wc_sb_checkin.isCheckinRequired() && ! window.wc_sb_checkin.isCustomerIdentified() ) {\n                    self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkin.needs_checkin + '</div>' );\n                    return false;\n                }\n            }\n\n            if ( self.form_submit ) {\n                return true;\n            }\n\n            if ( self.isPaymentMethodChosen() ) {\n                if ( typeof e !== 'undefined' ) {\n                    e.preventDefault();\n                }\n\n                if ( ! wc_sb_common.validateForm() ) {\n                    console.log( 'The checkout form validation is failed.' );\n\n                    if ( self.isCheckinEnabled() ) {\n                        self.submit_error( '<div class=\"woocommerce-error\">' + WC_Gateway_Swedbank_Pay_Checkout.checkin_error + '</div>' );\n                    }\n\n                    return false;\n                }\n\n                console.log( 'onSubmit' );\n\n                if ( self.form.is( '.processing' ) ) {\n                    return false;\n                }\n\n                $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n                self.form.addClass( 'processing' );\n                wc_sb_common.block();\n                self.placeOrder()\n                    .always( function ( response ) {\n                        self.form.removeClass( 'processing' );\n                        wc_sb_common.unblock();\n                    } )\n                    .fail( function( jqXHR, textStatus ) {\n                        self.onError( textStatus );\n                    } )\n                    .done( function ( response) {\n                        console.log( response );\n                        if ( response.result !== 'success' ) {\n                            // Reload page\n                            if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                                window.location.reload();\n                                return;\n                            }\n\n                            // Trigger update in case we need a fresh nonce\n                            if ( true === response.result.refresh ) {\n                                $( document.body ).trigger( 'update_checkout' );\n                            }\n\n                            self.onError( response.messages );\n                            return;\n                        }\n\n                        if ( wc_sb_common.isRedirectMethodEnabled() ) {\n                            // Redirect to the payment gateway page\n                            console.log( 'Redirecting to ' + response['redirect_url'] );\n                            window.location.href = response['redirect_url'];\n                        } else {\n                            // Load SwedBank Pay Checkout frame\n                            self.js_url = response['js_url'];\n                            self.initPaymentJS( self.js_url );\n                        }\n                    } );\n\n                return false;\n            }\n\n            return true;\n        },\n\n        resetCheckout: function() {\n            wc_sb_checkout.form_submit = false;\n        },\n\n        /**\n         * Check if Checkin is enabled\n         * @return {boolean}\n         */\n        isCheckinEnabled: function () {\n            if ( window.hasOwnProperty( 'wc_sb_checkin' ) ) {\n                return window.wc_sb_checkin.isCheckinEnabled();\n            }\n\n            return false;\n        },\n\n        /**\n         * Initiate Payment Javascript\n         * @param url\n         * @param callback\n         */\n        initPaymentJS: function ( url, callback ) {\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Destroy\n            if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                if ( typeof window.payex.hostedView.paymentMenu !== 'undefined' ) {\n                    window.payex.hostedView.paymentMenu().close();\n                }\n\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n                //delete window.payex.hostedView;\n            }\n\n            // Destroy JS\n            $( \"script[src*='px.paymentmenu.client']\" ).remove();\n\n            // Load JS\n            wc_sb_common.loadJs( url, function () {\n                $( '#payment-swedbank-pay-checkout iframe' ).remove();\n\n                // Load SwedBank Pay Checkout frame\n                if ( wc_sb_common.isInstantCheckout() ) {\n                    // Initiate the payment menu in \"Instant Checkout\"\n                    $( '#payment' ).hide();\n                    wc_sb_checkout.initPaymentMenu( 'payment-swedbank-pay-checkout' );\n                } else {\n                    // Initiate the payment menu in the frame\n                    console.log( 'non-instant checkout' );\n                    $.featherlight( '<div id=\"swedbank-pay-paymentmenu\">&nbsp;</div>', {\n                        variant: 'featherlight-swedbank-seamless',\n                        persist: true,\n                        closeOnClick: false,\n                        closeOnEsc: false,\n                        afterOpen: function () {\n                            wc_sb_checkout.initPaymentMenu( 'swedbank-pay-paymentmenu' );\n                        },\n                        afterClose: function () {\n                            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n                        }\n                    } );\n                }\n\n                callback()\n            } );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Load SwedBank Pay Checkout frame\n            this.paymentMenu = window.payex.hostedView.paymentMenu( {\n                container: id,\n                culture: WC_Gateway_Swedbank_Pay_Checkout.culture,\n                style: WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ? JSON.parse( WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle ) : null,\n                onApplicationConfigured: function( data ) {\n                    console.log( 'onApplicationConfigured' );\n                    console.log( data );\n                    wc_sb_checkout.isPaymentMenuLoaded = true;\n                    callback( null );\n                },\n                onPaymentMenuInstrumentSelected: function ( data ) {\n                    console.log( 'onPaymentMenuInstrumentSelected' );\n                    console.log( data );\n                    wc_sb_checkout.onPaymentMenuInstrumentSelected( data.name, data.instrument );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted' );\n                    console.log( data );\n                    self.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-cancel', data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed' );\n                    console.log( data );\n                    wc_sb_common.logError( 'payment-menu-failed', data );\n                    //self.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    wc_sb_common.logError( 'payment-menu-error', data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n\n        /**\n         * Refresh\n         */\n        refreshPaymentMenu: function() {\n            console.log( 'refreshPaymentMenu' );\n            if ( typeof this.paymentMenu !== 'undefined' && this.paymentMenu ) {\n                if ( this.paymentMenu.hasOwnProperty( 'refresh' ) && typeof this.paymentMenu.refresh === 'function' ) {\n                    this.paymentMenu.refresh();\n                } else {\n                    console.warn( 'refreshPaymentMenu: paymentMenu doesn\\'t support refresh' );\n                }\n            }\n        },\n\n        /**\n         * Place Order\n         * @return {JQueryPromise<any>}\n         */\n        placeOrder: function () {\n            console.log( 'placeOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_place_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } ).done( function ( response ) {\n                // Reload page\n                if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                    window.location.reload();\n                    return;\n         \t\t}\n\n                if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                    wc_sb_common.logError( 'sb-place-order', response );\n                    wc_sb_checkout.onError( response.messages );\n                }\n            } );\n        },\n\n        /**\n         * Update Order\n         * @param compatibility\n         * @return {JQueryPromise<any>}\n         */\n        updateOrder: function ( compatibility ) {\n            console.log( 'updateOrder' );\n            let fields = $('.woocommerce-checkout').serialize();\n\n            if ( typeof compatibility === 'undefined' ) {\n                compatibility = false;\n            }\n\n            fields += '&compatibility=' + compatibility;\n\n            wc_sb_checkout.form.addClass( 'processing' );\n            wc_sb_common.block();\n\n            if ( wc_sb_checkout.xhr ) {\n                wc_sb_checkout.xhr.abort();\n            }\n\n            wc_sb_checkout.xhr = $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_update_order',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    data: fields\n                },\n                dataType: 'json'\n            } )\n                .always( function ( response ) {\n                    wc_sb_checkout.xhr = false;\n                    wc_sb_checkout.form.removeClass( 'processing' );\n                    wc_sb_common.unblock();\n                } )\n                .fail( function( jqXHR, textStatus ) {\n                    console.log( 'updateOrder error:' + textStatus );\n                    //wc_sb_checkout.onError( textStatus );\n                } )\n                .done( function ( response) {\n                    console.log( response );\n\n                    if ( response.hasOwnProperty('result') && response.result === 'success' ) {\n                        // Refresh Payment Menu\n                        wc_sb_checkout.js_url = response['js_url'];\n                        wc_sb_checkout.refreshPaymentMenu();\n\n                        return;\n                    }\n\n                    if ( response.hasOwnProperty('result') && response.result === 'failure' ) {\n                        if (response.messages === '') {\n                            console.warn( 'Error message is empty.' );\n                            return;\n                        }\n\n                        // SwedBank Payment returns error that Order update is not available\n                        if ( response.messages.indexOf( 'Order update is not available.' ) > -1 && ! compatibility ) {\n                            // Force reload\n                            console.warn( 'refreshPaymentMenu: refresh workaround. Force reload.' );\n                            wc_sb_checkout.updateOrder( true ).done( function ( response ) {\n                                if ( response.hasOwnProperty('js_url') ) {\n                                    wc_sb_checkout.initPaymentJS( response.js_url );\n                                }\n                            } );\n\n                            return;\n                        }\n                    }\n\n                    // Reload page\n                    if ( response.hasOwnProperty('reload') && true === response.reload ) {\n                        window.location.reload();\n\n                        return;\n                    }\n\n                    // Trigger update in case we need a fresh nonce\n                    if ( response.hasOwnProperty( 'result' ) && true === response.result.refresh ) {\n                        $( document.body ).trigger( 'update_checkout' );\n                    }\n\n                    wc_sb_common.logError( 'sb-update-order', response );\n                    //wc_sb_checkout.onError( response.messages );\n                } );\n\n                return wc_sb_checkout.xhr;\n        },\n\n        /**\n         * On Payment Menu Instrument Selected\n         * @param name\n         * @param instrument\n         */\n        onPaymentMenuInstrumentSelected: function ( name, instrument ) {\n            console.log( 'onPaymentMenuInstrumentSelected', name, instrument );\n            $( document.body ).trigger( 'sb_payment_menu_instrument_selected', [name, instrument] );\n        },\n        onError: function ( data ) {\n            console.log( 'onError', data );\n            wc_sb_checkout.submit_error( '<div class=\"woocommerce-error\">' + data + '</div>' );\n        },\n        submit_error: function( error_message ) {\n            $( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\n            wc_sb_checkout.form.prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' );\n            wc_sb_checkout.form.removeClass( 'processing' ).unblock();\n            wc_sb_checkout.form.find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\n            wc_sb_checkout.scroll_to_notices();\n            $( document.body ).trigger( 'checkout_error' );\n        },\n        scroll_to_notices: function() {\n            let scrollElement = $( '.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout' );\n            if ( ! scrollElement.length ) {\n                scrollElement = $( '.form.checkout' );\n            }\n\n            $.scroll_to_notices( scrollElement );\n        },\n    };\n\n    $(document).ready( function () {\n        wc_sb_checkout.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n});\n\n"]}