jQuery(function(e){"use strict";window.wc_sb_checkin={init:function(){wc_sb_common.isCheckinEnabled()&&(e(document.body).on("change","#checkin_country",function(){wc_sb_checkin.loadCheckIn(e(this).val())}),e(document.body).on("click","#change-shipping-info",function(){e("#change-shipping-info").hide(),wc_sb_checkin.showAddressFields()}),wc_sb_checkin.hideAddressFields(),wc_sb_checkin.initCheckIn())},loadCheckIn:function(n){return e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkin",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,country:n},dataType:"json"}).done(function(n){if(!n.success)return wc_sb_common.logError("sb-checkin-loader",n),void alert(n.details);window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&void 0!==window.payex.hostedView.consumer&&window.payex.hostedView.consumer().close(),e("script[src*='px.consumer.client']").remove(),e("#swedbank-pay-checkin iframe").remove(),wc_sb_common.loadJs(n.data,function(){wc_sb_checkin.initCheckIn()})})},initCheckIn:function(){"undefined"!=typeof payex&&wc_sb_common.waitForLoading("payex.hostedView.consumer",function(e){e?console.warn(e):window.payex.hostedView.consumer({container:"swedbank-pay-checkin",culture:WC_Gateway_Swedbank_Pay_Checkout.culture,style:WC_Gateway_Swedbank_Pay_Checkout.checkInStyle?JSON.parse(WC_Gateway_Swedbank_Pay_Checkout.checkInStyle):null,onConsumerIdentified:function(e){console.log("hostedView: onConsumerIdentified"),wc_sb_checkin.onConsumerIdentified(e)},onNewConsumer:function(e){console.log("hostedView: onNewConsumer"),wc_sb_checkin.onConsumerIdentified(e)},onConsumerRemoved:function(e){console.log("hostedView: onConsumerRemoved")},onBillingDetailsAvailable:function(e){wc_sb_checkin.onAddressDetailsAvailable("billing",e)},onShippingDetailsAvailable:function(e){(WC_Gateway_Swedbank_Pay_Checkout.needs_shipping_address||WC_Gateway_Swedbank_Pay_Checkout.ship_to_billing_address_only)&&wc_sb_checkin.onAddressDetailsAvailable("billing",e),wc_sb_checkin.onAddressDetailsAvailable("shipping",e)},onError:function(e){wc_sb_common.logError("sb-checkin",e),alert(e.details)}}).open()})},onConsumerIdentified:function(n){return console.log("onConsumerIdentified",n),e("#change-shipping-info").show(),e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkout_customer_profile",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,consumerProfileRef:n.consumerProfileRef},dataType:"json"}).always(function(e){}).done(function(e){console.log(e),e.success?wc_sb_common.isInstantCheckout&&wc_sb_checkout.initCheckout(n.consumerProfileRef):alert(e.data.message)})},onAddressDetailsAvailable:function(n,o){return console.log("onAddressDetailsAvailable",n,o),e("#change-shipping-info").show(),wc_sb_common.block(),e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkout_get_address",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,type:n,url:o.url},dataType:"json"}).always(function(e){wc_sb_common.unblock()}).done(function(o){if(console.log(o),!o.success)return wc_sb_common.logError("sb-address-details",o),void alert(o.data.message);let c=o.data;e.each(c,function(o,c){[n].forEach(function(n){let i=e('input[name="'+n+"_"+o+'"]');if(0!==i.length&&(i.prop("readonly",!1),i.closest(".form-row").removeClass("swedbank-pay-locked"),i.val(c).change(),"country"===o||"state"===o)){let i=e("#"+n+"_"+o);void 0!==window.Select2?i.select2("val",c):void 0!==e.fn.chosen?i.val(c).trigger("chosen:updated"):i.change()}})}),e(document.body).trigger("update_checkout")})},hideAddressFields:function(){e(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").hide()},showAddressFields:function(){e(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").show()}},e(document).ready(function(){wc_sb_checkin.init(e("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNraW4uanMiXSwibmFtZXMiOlsialF1ZXJ5IiwiJCIsIndpbmRvdyIsIndjX3NiX2NoZWNraW4iLCJpbml0Iiwid2Nfc2JfY29tbW9uIiwiaXNDaGVja2luRW5hYmxlZCIsImRvY3VtZW50IiwiYm9keSIsIm9uIiwibG9hZENoZWNrSW4iLCJ0aGlzIiwidmFsIiwiaGlkZSIsInNob3dBZGRyZXNzRmllbGRzIiwiaGlkZUFkZHJlc3NGaWVsZHMiLCJpbml0Q2hlY2tJbiIsImNvdW50cnkiLCJhamF4IiwidHlwZSIsInVybCIsIldDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0IiwiYWpheF91cmwiLCJkYXRhIiwiYWN0aW9uIiwibm9uY2UiLCJkYXRhVHlwZSIsImRvbmUiLCJzdWNjZXNzIiwibG9nRXJyb3IiLCJhbGVydCIsImRldGFpbHMiLCJoYXNPd25Qcm9wZXJ0eSIsInBheWV4IiwiaG9zdGVkVmlldyIsImNvbnN1bWVyIiwiY2xvc2UiLCJyZW1vdmUiLCJsb2FkSnMiLCJ3YWl0Rm9yTG9hZGluZyIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiY29udGFpbmVyIiwiY3VsdHVyZSIsInN0eWxlIiwiY2hlY2tJblN0eWxlIiwiSlNPTiIsInBhcnNlIiwib25Db25zdW1lcklkZW50aWZpZWQiLCJsb2ciLCJvbk5ld0NvbnN1bWVyIiwib25Db25zdW1lclJlbW92ZWQiLCJvbkJpbGxpbmdEZXRhaWxzQXZhaWxhYmxlIiwib25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSIsIm9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlIiwibmVlZHNfc2hpcHBpbmdfYWRkcmVzcyIsInNoaXBfdG9fYmlsbGluZ19hZGRyZXNzX29ubHkiLCJvbkVycm9yIiwib3BlbiIsInNob3ciLCJjb25zdW1lclByb2ZpbGVSZWYiLCJhbHdheXMiLCJyZXNwb25zZSIsImlzSW5zdGFudENoZWNrb3V0Iiwid2Nfc2JfY2hlY2tvdXQiLCJpbml0Q2hlY2tvdXQiLCJtZXNzYWdlIiwiYmxvY2siLCJ1bmJsb2NrIiwiZWFjaCIsImtleSIsInZhbHVlIiwiZm9yRWFjaCIsInNlY3Rpb24iLCJlbCIsImxlbmd0aCIsInByb3AiLCJjbG9zZXN0IiwicmVtb3ZlQ2xhc3MiLCJjaGFuZ2UiLCJlbDEiLCJTZWxlY3QyIiwic2VsZWN0MiIsImZuIiwiY2hvc2VuIiwidHJpZ2dlciIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQUFDQUEsT0FBUSxTQUFVQyxHQUNkLGFBRUFDLE9BQU9DLGNBQWdCLENBSW5CQyxLQUFNLFdBQ0dDLGFBQWFDLHFCQUNkTCxFQUFHTSxTQUFTQyxNQUFPQyxHQUFJLFNBQVUsbUJBQW9CLFdBQ2pETixjQUFjTyxZQUFhVCxFQUFFVSxNQUFNQyxTQUd2Q1gsRUFBR00sU0FBU0MsTUFBT0MsR0FBSSxRQUFTLHdCQUF5QixXQUVyRFIsRUFBRyx5QkFBMEJZLE9BRzdCVixjQUFjVyxzQkFHbEJYLGNBQWNZLG9CQUNkWixjQUFjYSxnQkFVdEJOLFlBQWEsU0FBVU8sR0FDbkIsT0FBT2hCLEVBQUVpQixLQUFNLENBQ1hDLEtBQU0sT0FDTkMsSUFBS0MsaUNBQWlDQyxTQUN0Q0MsS0FBTSxDQUNGQyxPQUFRLHVCQUNSQyxNQUFPSixpQ0FBaUNJLE1BQ3hDUixRQUFTQSxHQUViUyxTQUFVLFNBQ1ZDLEtBQU0sU0FBV0osR0FDakIsSUFBT0EsRUFBS0ssUUFHUixPQUZBdkIsYUFBYXdCLFNBQVUsb0JBQXFCTixRQUM1Q08sTUFBT1AsRUFBS1EsU0FLWDdCLE9BQU84QixlQUFnQixVQUFhOUIsT0FBTytCLE1BQU1ELGVBQWdCLG9CQUNqQixJQUFyQzlCLE9BQU8rQixNQUFNQyxXQUFXQyxVQUNoQ2pDLE9BQU8rQixNQUFNQyxXQUFXQyxXQUFXQyxRQUszQ25DLEVBQUcscUNBQXNDb0MsU0FDekNwQyxFQUFHLGdDQUFpQ29DLFNBQ3BDaEMsYUFBYWlDLE9BQVFmLEVBQUtBLEtBQU0sV0FDNUJwQixjQUFjYSxtQkFRMUJBLFlBQWEsV0FDYSxvQkFBVmlCLE9BSVo1QixhQUFha0MsZUFB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ZCxFQUFHLDRFQUE2RVksUUFLcEZDLGtCQUFtQixXQUNmYixFQUFHLDRFQUE2RTJELFNBSXhGM0QsRUFBRU0sVUFBVWdGLE1BQU8sV0FDZnBGLGNBQWNDLEtBQU1ILEVBQUciLCJmaWxlIjoiY2hlY2tpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgd2NfY2hlY2tvdXRfcGFyYW1zICovXG5qUXVlcnkoIGZ1bmN0aW9uKCAkICkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHdpbmRvdy53Y19zYl9jaGVja2luID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZVxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnY2hhbmdlJywgJyNjaGVja2luX2NvdW50cnknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ubG9hZENoZWNrSW4oICQodGhpcykudmFsKCkgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdjbGljaycsICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgXCJDaGFuZ2Ugc2hpcHBpbmcgaW5mb1wiIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IEFkZHJlc3MgRmllbGRzXG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4uc2hvd0FkZHJlc3NGaWVsZHMoKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLmhpZGVBZGRyZXNzRmllbGRzKCk7XG4gICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tpbi5pbml0Q2hlY2tJbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvYWQgQ2hlY2tJblxuICAgICAgICAgKiBAcGFyYW0gY291bnRyeVxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIGxvYWRDaGVja0luOiBmdW5jdGlvbiggY291bnRyeSApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV9jaGVja2luJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiBjb3VudHJ5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgIGlmICggISBkYXRhLnN1Y2Nlc3MgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3NiLWNoZWNraW4tbG9hZGVyJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICBhbGVydCggZGF0YS5kZXRhaWxzICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBEZXN0cm95XG4gICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cuaGFzT3duUHJvcGVydHkoICdwYXlleCcgKSAmJiB3aW5kb3cucGF5ZXguaGFzT3duUHJvcGVydHkoICdob3N0ZWRWaWV3JyApICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lciAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcigpLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBEZXN0cm95IEpTXG4gICAgICAgICAgICAgICAgJCggXCJzY3JpcHRbc3JjKj0ncHguY29uc3VtZXIuY2xpZW50J11cIiApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoICcjc3dlZGJhbmstcGF5LWNoZWNraW4gaWZyYW1lJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2FkSnMoIGRhdGEuZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLmluaXRDaGVja0luKCk7XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIENoZWNrSW5cbiAgICAgICAgICovXG4gICAgICAgIGluaXRDaGVja0luOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHBheWV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2Nfc2JfY29tbW9uLndhaXRGb3JMb2FkaW5nKCdwYXlleC5ob3N0ZWRWaWV3LmNvbnN1bWVyJywgZnVuY3Rpb24gKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggZXJyICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0IFBheUV4IGhvc3RlZFZpZXdcbiAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcigge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdzd2VkYmFuay1wYXktY2hlY2tpbicsXG4gICAgICAgICAgICAgICAgICAgIGN1bHR1cmU6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmN1bHR1cmUsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5jaGVja0luU3R5bGUgPyBKU09OLnBhcnNlKCBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5jaGVja0luU3R5bGUgKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIG9uQ29uc3VtZXJJZGVudGlmaWVkOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaG9zdGVkVmlldzogb25Db25zdW1lcklkZW50aWZpZWQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLm9uQ29uc3VtZXJJZGVudGlmaWVkKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uTmV3Q29uc3VtZXI6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdob3N0ZWRWaWV3OiBvbk5ld0NvbnN1bWVyJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tpbi5vbkNvbnN1bWVySWRlbnRpZmllZCggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkNvbnN1bWVyUmVtb3ZlZDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ2hvc3RlZFZpZXc6IG9uQ29uc3VtZXJSZW1vdmVkJyApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkJpbGxpbmdEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ2JpbGxpbmcnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIG9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQubmVlZHNfc2hpcHBpbmdfYWRkcmVzcyB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LnNoaXBfdG9fYmlsbGluZ19hZGRyZXNzX29ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ2JpbGxpbmcnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ub25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSggJ3NoaXBwaW5nJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdzYi1jaGVja2luJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIGRhdGEuZGV0YWlscyApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApLm9wZW4oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPbiBDb25zdW1lciBJZGVudGlmaWVkXG4gICAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICAgKi9cbiAgICAgICAgb25Db25zdW1lcklkZW50aWZpZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25Db25zdW1lcklkZW50aWZpZWQnLCBkYXRhICk7XG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc3dlZGJhbmtfcGF5X2NoZWNrb3V0X2N1c3RvbWVyX3Byb2ZpbGUnLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbnN1bWVyUHJvZmlsZVJlZjogZGF0YS5jb25zdW1lclByb2ZpbGVSZWZcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH0gKS5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIH0gKS5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhdGUgQ2hlY2tvdXQgaWYgYWN0aXZlXG4gICAgICAgICAgICAgICAgaWYgKCB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRDaGVja291dCggZGF0YS5jb25zdW1lclByb2ZpbGVSZWYgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9uIEFkZHJlc3MgRGV0YWlscyBBdmFpbGFibGVcbiAgICAgICAgICogQHBhcmFtIHR5cGVcbiAgICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgICAqL1xuICAgICAgICBvbkFkZHJlc3NEZXRhaWxzQXZhaWxhYmxlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZScsIHR5cGUsIGRhdGEgKTtcblxuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5ibG9jaygpO1xuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc3dlZGJhbmtfcGF5X2NoZWNrb3V0X2dldF9hZGRyZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IGRhdGEudXJsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi51bmJsb2NrKCk7XG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCdzYi1hZGRyZXNzLWRldGFpbHMnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFkZHJlc3NcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIFt0eXBlXS5mb3JFYWNoKGZ1bmN0aW9uKHNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlbCA9ICQoJ2lucHV0W25hbWU9XCInICsgc2VjdGlvbiArICdfJyArIGtleSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnByb3AoJ3JlYWRvbmx5JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xvc2VzdCgnLmZvcm0tcm93JykucmVtb3ZlQ2xhc3MoJ3N3ZWRiYW5rLXBheS1sb2NrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnZhbCh2YWx1ZSkuY2hhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdjb3VudHJ5JyB8fCBrZXkgPT09ICdzdGF0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZWwxID0gJCgnIycgKyBzZWN0aW9uICsgJ18nICsga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5TZWxlY3QyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDEuc2VsZWN0MigndmFsJywgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mICQuZm4uY2hvc2VuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaG9zZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLnZhbCh2YWx1ZSkudHJpZ2dlcignY2hvc2VuOnVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9lbDEuY2hvc2VuKCkuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGUgQWRkcmVzcyBGaWVsZHMgb24gdGhlIGNoZWNrb3V0XG4gICAgICAgICAqL1xuICAgICAgICBoaWRlQWRkcmVzc0ZpZWxkczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1iaWxsaW5nLWZpZWxkc19fZmllbGQtd3JhcHBlciwgLndvb2NvbW1lcmNlLXNoaXBwaW5nLWZpZWxkcycgKS5oaWRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93IEFkZHJlc3MgRmllbGRzIG9uIHRoZSBjaGVja291dFxuICAgICAgICAgKi9cbiAgICAgICAgc2hvd0FkZHJlc3NGaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHNfX2ZpZWxkLXdyYXBwZXIsIC53b29jb21tZXJjZS1zaGlwcGluZy1maWVsZHMnICkuc2hvdygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2Nfc2JfY2hlY2tpbi5pbml0KCAkKCBcImZvcm0uY2hlY2tvdXQsIGZvcm0jb3JkZXJfcmV2aWV3LCBmb3JtI2FkZF9wYXltZW50X21ldGhvZFwiICkgKTtcbiAgICB9ICk7XG59ICk7Il19
