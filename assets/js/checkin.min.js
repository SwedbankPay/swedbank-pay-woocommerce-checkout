jQuery(function(e){"use strict";window.wc_sb_checkin={init:function(){wc_sb_common.isCheckinEnabled()&&(e(document.body).on("change","#checkin_country",function(){wc_sb_checkin.loadCheckIn(e(this).val())}),e(document.body).on("click","#change-shipping-info",function(){e("#change-shipping-info").hide(),wc_sb_checkin.showAddressFields()}),wc_sb_checkin.hideAddressFields(),wc_sb_checkin.initCheckIn())},loadCheckIn:function(n){return e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkin",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,country:n},dataType:"json"}).done(function(n){if(!n.success)return wc_sb_common.logError("sb-checkin-loader",n),void alert(n.details);window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&void 0!==window.payex.hostedView.consumer&&window.payex.hostedView.consumer().close(),e("script[src*='px.consumer.client']").remove(),e("#swedbank-pay-checkin iframe").remove(),wc_sb_checkin.loadJs(n.data,function(){wc_sb_checkin.initCheckIn()})})},initCheckIn:function(){"undefined"!=typeof payex&&wc_sb_common.waitForLoading("payex.hostedView.consumer",function(e){e?console.warn(e):window.payex.hostedView.consumer({container:"swedbank-pay-checkin",culture:WC_Gateway_Swedbank_Pay_Checkout.culture,style:WC_Gateway_Swedbank_Pay_Checkout.checkInStyle?JSON.parse(WC_Gateway_Swedbank_Pay_Checkout.checkInStyle):null,onConsumerIdentified:function(e){console.log("hostedView: onConsumerIdentified"),wc_sb_checkin.onConsumerIdentified(e)},onNewConsumer:function(e){console.log("hostedView: onNewConsumer"),wc_sb_checkin.onConsumerIdentified(e)},onConsumerRemoved:function(e){console.log("hostedView: onConsumerRemoved")},onBillingDetailsAvailable:function(e){wc_sb_checkin.onAddressDetailsAvailable("billing",e)},onShippingDetailsAvailable:function(e){(WC_Gateway_Swedbank_Pay_Checkout.needs_shipping_address||WC_Gateway_Swedbank_Pay_Checkout.ship_to_billing_address_only)&&wc_sb_checkin.onAddressDetailsAvailable("billing",e),wc_sb_checkin.onAddressDetailsAvailable("shipping",e)},onError:function(e){wc_sb_common.logError("sb-checkin",e),alert(e.details)}}).open()})},onConsumerIdentified:function(n){return console.log("onConsumerIdentified",n),e("#change-shipping-info").show(),e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkout_customer_profile",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,consumerProfileRef:n.consumerProfileRef},dataType:"json"}).always(function(e){}).done(function(e){console.log(e),e.success?wc_sb_common.isInstantCheckout&&wc_sb_checkout.initCheckout(n.consumerProfileRef):alert(e.data.message)})},onAddressDetailsAvailable:function(n,o){return console.log("onAddressDetailsAvailable",n,o),e("#change-shipping-info").show(),wc_sb_common.block(),e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_checkout_get_address",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,type:n,url:o.url},dataType:"json"}).always(function(e){wc_sb_common.unblock()}).done(function(o){if(console.log(o),!o.success)return wc_sb_common.logError("sb-address-details",o),void alert(o.data.message);let c=o.data;e.each(c,function(o,c){[n].forEach(function(n){let i=e('input[name="'+n+"_"+o+'"]');if(0!==i.length&&(i.prop("readonly",!1),i.closest(".form-row").removeClass("swedbank-pay-locked"),i.val(c).change(),"country"===o||"state"===o)){let i=e("#"+n+"_"+o);void 0!==window.Select2?i.select2("val",c):void 0!==e.fn.chosen?i.val(c).trigger("chosen:updated"):i.change()}})}),e(document.body).trigger("update_checkout")})},hideAddressFields:function(){e(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").hide()},showAddressFields:function(){e(".woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields").show()}},e(document).ready(function(){wc_sb_checkin.init(e("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNraW4uanMiXSwibmFtZXMiOlsialF1ZXJ5IiwiJCIsIndpbmRvdyIsIndjX3NiX2NoZWNraW4iLCJpbml0Iiwid2Nfc2JfY29tbW9uIiwiaXNDaGVja2luRW5hYmxlZCIsImRvY3VtZW50IiwiYm9keSIsIm9uIiwibG9hZENoZWNrSW4iLCJ0aGlzIiwidmFsIiwiaGlkZSIsInNob3dBZGRyZXNzRmllbGRzIiwiaGlkZUFkZHJlc3NGaWVsZHMiLCJpbml0Q2hlY2tJbiIsImNvdW50cnkiLCJhamF4IiwidHlwZSIsInVybCIsIldDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0IiwiYWpheF91cmwiLCJkYXRhIiwiYWN0aW9uIiwibm9uY2UiLCJkYXRhVHlwZSIsImRvbmUiLCJzdWNjZXNzIiwibG9nRXJyb3IiLCJhbGVydCIsImRldGFpbHMiLCJoYXNPd25Qcm9wZXJ0eSIsInBheWV4IiwiaG9zdGVkVmlldyIsImNvbnN1bWVyIiwiY2xvc2UiLCJyZW1vdmUiLCJsb2FkSnMiLCJ3YWl0Rm9yTG9hZGluZyIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiY29udGFpbmVyIiwiY3VsdHVyZSIsInN0eWxlIiwiY2hlY2tJblN0eWxlIiwiSlNPTiIsInBhcnNlIiwib25Db25zdW1lcklkZW50aWZpZWQiLCJsb2ciLCJvbk5ld0NvbnN1bWVyIiwib25Db25zdW1lclJlbW92ZWQiLCJvbkJpbGxpbmdEZXRhaWxzQXZhaWxhYmxlIiwib25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZSIsIm9uU2hpcHBpbmdEZXRhaWxzQXZhaWxhYmxlIiwibmVlZHNfc2hpcHBpbmdfYWRkcmVzcyIsInNoaXBfdG9fYmlsbGluZ19hZGRyZXNzX29ubHkiLCJvbkVycm9yIiwib3BlbiIsInNob3ciLCJjb25zdW1lclByb2ZpbGVSZWYiLCJhbHdheXMiLCJyZXNwb25zZSIsImlzSW5zdGFudENoZWNrb3V0Iiwid2Nfc2JfY2hlY2tvdXQiLCJpbml0Q2hlY2tvdXQiLCJtZXNzYWdlIiwiYmxvY2siLCJ1bmJsb2NrIiwiZWFjaCIsImtleSIsInZhbHVlIiwiZm9yRWFjaCIsInNlY3Rpb24iLCJlbCIsImxlbmd0aCIsInByb3AiLCJjbG9zZXN0IiwicmVtb3ZlQ2xhc3MiLCJjaGFuZ2UiLCJlbDEiLCJTZWxlY3QyIiwic2VsZWN0MiIsImZuIiwiY2hvc2VuIiwidHJpZ2dlciIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQUFDQUEsT0FBUSxTQUFVQyxHQUNkLGFBRUFDLE9BQU9DLGNBQWdCLENBSW5CQyxLQUFNLFdBQ0dDLGFBQWFDLHFCQUNkTCxFQUFHTSxTQUFTQyxNQUFPQyxHQUFJLFNBQVUsbUJBQW9CLFdBQ2pETixjQUFjTyxZQUFhVCxFQUFFVSxNQUFNQyxTQUd2Q1gsRUFBR00sU0FBU0MsTUFBT0MsR0FBSSxRQUFTLHdCQUF5QixXQUVyRFIsRUFBRyx5QkFBMEJZLE9BRzdCVixjQUFjVyxzQkFHbEJYLGNBQWNZLG9CQUNkWixjQUFjYSxnQkFVdEJOLFlBQWEsU0FBVU8sR0FDbkIsT0FBT2hCLEVBQUVpQixLQUFNLENBQ1hDLEtBQU0sT0FDTkMsSUFBS0MsaUNBQWlDQyxTQUN0Q0MsS0FBTSxDQUNGQyxPQUFRLHVCQUNSQyxNQUFPSixpQ0FBaUNJLE1BQ3hDUixRQUFTQSxHQUViUyxTQUFVLFNBQ1ZDLEtBQU0sU0FBV0osR0FDakIsSUFBT0EsRUFBS0ssUUFHUixPQUZBdkIsYUFBYXdCLFNBQVUsb0JBQXFCTixRQUM1Q08sTUFBT1AsRUFBS1EsU0FLWDdCLE9BQU84QixlQUFnQixVQUFhOUIsT0FBTytCLE1BQU1ELGVBQWdCLG9CQUNqQixJQUFyQzlCLE9BQU8rQixNQUFNQyxXQUFXQyxVQUNoQ2pDLE9BQU8rQixNQUFNQyxXQUFXQyxXQUFXQyxRQUszQ25DLEVBQUcscUNBQXNDb0MsU0FDekNwQyxFQUFHLGdDQUFpQ29DLFNBQ3BDbEMsY0FBY21DLE9BQVFmLEVBQUtBLEtBQU0sV0FDN0JwQixjQUFjYSxtQkFRMUJBLFlBQWEsV0FDYSxvQkFBVmlCLE9BSVo1QixhQUFha0MsZUFB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ZCxFQUFHLDRFQUE2RVksUUFLcEZDLGtCQUFtQixXQUNmYixFQUFHLDRFQUE2RTJELFNBSXhGM0QsRUFBRU0sVUFBVWdGLE1BQU8sV0FDZnBGLGNBQWNDLEtBQU1ILEVBQUciLCJmaWxlIjoiY2hlY2tpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgd2NfY2hlY2tvdXRfcGFyYW1zICovXG5qUXVlcnkoIGZ1bmN0aW9uKCAkICkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHdpbmRvdy53Y19zYl9jaGVja2luID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZVxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnY2hhbmdlJywgJyNjaGVja2luX2NvdW50cnknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ubG9hZENoZWNrSW4oICQodGhpcykudmFsKCkgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdjbGljaycsICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgXCJDaGFuZ2Ugc2hpcHBpbmcgaW5mb1wiIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLmhpZGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IEFkZHJlc3MgRmllbGRzXG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4uc2hvd0FkZHJlc3NGaWVsZHMoKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLmhpZGVBZGRyZXNzRmllbGRzKCk7XG4gICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tpbi5pbml0Q2hlY2tJbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvYWQgQ2hlY2tJblxuICAgICAgICAgKiBAcGFyYW0gY291bnRyeVxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIGxvYWRDaGVja0luOiBmdW5jdGlvbiggY291bnRyeSApIHtcbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV9jaGVja2luJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiBjb3VudHJ5XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgIGlmICggISBkYXRhLnN1Y2Nlc3MgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3NiLWNoZWNraW4tbG9hZGVyJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICBhbGVydCggZGF0YS5kZXRhaWxzICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBEZXN0cm95XG4gICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cuaGFzT3duUHJvcGVydHkoICdwYXlleCcgKSAmJiB3aW5kb3cucGF5ZXguaGFzT3duUHJvcGVydHkoICdob3N0ZWRWaWV3JyApICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lciAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcigpLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBEZXN0cm95IEpTXG4gICAgICAgICAgICAgICAgJCggXCJzY3JpcHRbc3JjKj0ncHguY29uc3VtZXIuY2xpZW50J11cIiApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoICcjc3dlZGJhbmstcGF5LWNoZWNraW4gaWZyYW1lJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ubG9hZEpzKCBkYXRhLmRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tpbi5pbml0Q2hlY2tJbigpO1xuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBDaGVja0luXG4gICAgICAgICAqL1xuICAgICAgICBpbml0Q2hlY2tJbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBwYXlleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdjX3NiX2NvbW1vbi53YWl0Rm9yTG9hZGluZygncGF5ZXguaG9zdGVkVmlldy5jb25zdW1lcicsIGZ1bmN0aW9uICggZXJyICkge1xuICAgICAgICAgICAgICAgIGlmICggZXJyICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIGVyciApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gSW5pdCBQYXlFeCBob3N0ZWRWaWV3XG4gICAgICAgICAgICAgICAgd2luZG93LnBheWV4Lmhvc3RlZFZpZXcuY29uc3VtZXIoIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAnc3dlZGJhbmstcGF5LWNoZWNraW4nLFxuICAgICAgICAgICAgICAgICAgICBjdWx0dXJlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQuY2hlY2tJblN0eWxlID8gSlNPTi5wYXJzZSggV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQuY2hlY2tJblN0eWxlICkgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBvbkNvbnN1bWVySWRlbnRpZmllZDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ2hvc3RlZFZpZXc6IG9uQ29uc3VtZXJJZGVudGlmaWVkJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tpbi5vbkNvbnN1bWVySWRlbnRpZmllZCggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvbk5ld0NvbnN1bWVyOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaG9zdGVkVmlldzogb25OZXdDb25zdW1lcicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNraW4ub25Db25zdW1lcklkZW50aWZpZWQoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25Db25zdW1lclJlbW92ZWQ6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdob3N0ZWRWaWV3OiBvbkNvbnN1bWVyUmVtb3ZlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25CaWxsaW5nRGV0YWlsc0F2YWlsYWJsZTogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUoICdiaWxsaW5nJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblNoaXBwaW5nRGV0YWlsc0F2YWlsYWJsZTogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5lZWRzX3NoaXBwaW5nX2FkZHJlc3MgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5zaGlwX3RvX2JpbGxpbmdfYWRkcmVzc19vbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUoICdiaWxsaW5nJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja2luLm9uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUoICdzaGlwcGluZycsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAnc2ItY2hlY2tpbicsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCBkYXRhLmRldGFpbHMgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKS5vcGVuKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT24gQ29uc3VtZXIgSWRlbnRpZmllZFxuICAgICAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICovXG4gICAgICAgIG9uQ29uc3VtZXJJZGVudGlmaWVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQ29uc3VtZXJJZGVudGlmaWVkJywgZGF0YSApO1xuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV9jaGVja291dF9jdXN0b21lcl9wcm9maWxlJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBjb25zdW1lclByb2ZpbGVSZWY6IGRhdGEuY29uc3VtZXJQcm9maWxlUmVmXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIENoZWNrb3V0IGlmIGFjdGl2ZVxuICAgICAgICAgICAgICAgIGlmICggd2Nfc2JfY29tbW9uLmlzSW5zdGFudENoZWNrb3V0ICkge1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0Q2hlY2tvdXQoIGRhdGEuY29uc3VtZXJQcm9maWxlUmVmICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPbiBBZGRyZXNzIERldGFpbHMgQXZhaWxhYmxlXG4gICAgICAgICAqIEBwYXJhbSB0eXBlXG4gICAgICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAgICAgKi9cbiAgICAgICAgb25BZGRyZXNzRGV0YWlsc0F2YWlsYWJsZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQWRkcmVzc0RldGFpbHNBdmFpbGFibGUnLCB0eXBlLCBkYXRhICk7XG5cbiAgICAgICAgICAgICQoICcjY2hhbmdlLXNoaXBwaW5nLWluZm8nICkuc2hvdygpO1xuXG4gICAgICAgICAgICB3Y19zYl9jb21tb24uYmxvY2soKTtcbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV9jaGVja291dF9nZXRfYWRkcmVzcycsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBkYXRhLnVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24udW5ibG9jaygpO1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvcignc2ItYWRkcmVzcy1kZXRhaWxzJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhZGRyZXNzXG4gICAgICAgICAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBbdHlwZV0uZm9yRWFjaChmdW5jdGlvbihzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZWwgPSAkKCdpbnB1dFtuYW1lPVwiJyArIHNlY3Rpb24gKyAnXycgKyBrZXkgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5wcm9wKCdyZWFkb25seScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmNsb3Nlc3QoJy5mb3JtLXJvdycpLnJlbW92ZUNsYXNzKCdzd2VkYmFuay1wYXktbG9ja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC52YWwodmFsdWUpLmNoYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnY291bnRyeScgfHwga2V5ID09PSAnc3RhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVsMSA9ICQoJyMnICsgc2VjdGlvbiArICdfJyArIGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuU2VsZWN0MiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwxLnNlbGVjdDIoJ3ZhbCcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAkLmZuLmNob3NlbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hvc2VuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsMS52YWwodmFsdWUpLnRyaWdnZXIoJ2Nob3Nlbjp1cGRhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWwxLmNob3NlbigpLmNoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsMS5jaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlIEFkZHJlc3MgRmllbGRzIG9uIHRoZSBjaGVja291dFxuICAgICAgICAgKi9cbiAgICAgICAgaGlkZUFkZHJlc3NGaWVsZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtYmlsbGluZy1maWVsZHNfX2ZpZWxkLXdyYXBwZXIsIC53b29jb21tZXJjZS1zaGlwcGluZy1maWVsZHMnICkuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvdyBBZGRyZXNzIEZpZWxkcyBvbiB0aGUgY2hlY2tvdXRcbiAgICAgICAgICovXG4gICAgICAgIHNob3dBZGRyZXNzRmllbGRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLWJpbGxpbmctZmllbGRzX19maWVsZC13cmFwcGVyLCAud29vY29tbWVyY2Utc2hpcHBpbmctZmllbGRzJyApLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdjX3NiX2NoZWNraW4uaW5pdCggJCggXCJmb3JtLmNoZWNrb3V0LCBmb3JtI29yZGVyX3JldmlldywgZm9ybSNhZGRfcGF5bWVudF9tZXRob2RcIiApICk7XG4gICAgfSApO1xufSApOyJdfQ==
