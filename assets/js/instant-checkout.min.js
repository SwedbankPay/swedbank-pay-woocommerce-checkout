jQuery(function(e){"use strict";window.wc_sb_checkout={js_url:null,paymentMenu:null,isPaymentMenuLoaded:!1,xhr:!1,init:function(o){this.form=o,this.form_submit=!1,e(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_payex_checkout"),e(document.body).bind("update_checkout",this.onUpdateCheckout),e(document.body).on("checkout_error",this.resetCheckout),e(document.body).on("updated_checkout",this.onUpdatedCheckout),e(document.body).on("blur",this.onUpdatedCheckout),wc_sb_common.isInstantCheckout()&&wc_sb_checkout.initInstantCheckout()},initInstantCheckout:function(){if(console.log("Initialization of Instant Checkout..."),wc_sb_common.isCheckinEnabled(),wc_sb_common.isCheckinEnabled()){let o=e("#swedbank-pay-consumer-profile");if(o.length>0){let e=o.data("reference");console.log("Initiate consumerProfileRef",e)}}},initCheckout:function(o){e("#change-shipping-info").show(),wc_sb_checkout.form.find(".swedbank_pay_customer_reference").remove(),wc_sb_checkout.form.append("<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='"+o+"'/>"),wc_sb_checkout.onSubmit()},isPaymentMethodChosen:function(){return e("#payment_method_payex_checkout").is(":checked")},onClose:function(){wc_sb_common.unblock()},onReady:function(){console.log("Ready")},onUpdateCheckout:function(){if(console.log("onUpdateCheckout"),!wc_sb_common.isInstantCheckout())return!1},onUpdatedCheckout:function(){return console.log("onUpdatedCheckout"),!!wc_sb_common.isInstantCheckout()&&(!wc_sb_checkout.form.is(".processing")&&(wc_sb_common.validateForm()?(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),void wc_sb_checkout.updateOrder()):(console.log("onUpdatedCheckout: Validation is failed"),!1)))},onSubmit:function(o){return!!wc_sb_checkout.form_submit||(!wc_sb_checkout.isPaymentMethodChosen()||(void 0!==o&&o.preventDefault(),!!wc_sb_common.validateForm()&&(console.log("onSubmit"),!wc_sb_checkout.form.is(".processing")&&(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_sb_checkout.form.addClass("processing"),wc_sb_common.block(),wc_sb_checkout.placeOrder().always(function(e){wc_sb_checkout.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){wc_sb_checkout.onError(o)}).done(function(o){if(console.log(o),"success"!==o.result)return o.hasOwnProperty("reload")&&!0===o.reload?void window.location.reload():(!0===o.result.refresh&&e(document.body).trigger("update_checkout"),void wc_sb_checkout.onError(o.messages));wc_sb_common.isRedirectMethodEnabled()?(console.log("Redirecting to "+o.redirect_url),self.location.href=o.redirect_url):(wc_sb_checkout.js_url=o.js_url,wc_sb_checkout.initPaymentJS(wc_sb_checkout.js_url))}),!1))))},resetCheckout:function(){wc_sb_checkout.form_submit=!1},initPaymentJS:function(o,n){void 0===n&&(n=function(){}),window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&(void 0!==window.payex.hostedView.paymentMenu&&window.payex.hostedView.paymentMenu().close(),e("#payment-swedbank-pay-checkout iframe").remove()),e("script[src*='px.paymentmenu.client']").remove(),wc_sb_common.loadJs(o,function(){e("#payment-swedbank-pay-checkout iframe").remove(),wc_sb_common.isInstantCheckout()?(e("#payment").hide(),wc_sb_checkout.initPaymentMenu("payment-swedbank-pay-checkout")):(console.log("non-instant checkout"),e.featherlight('<div id="swedbank-pay-paymentmenu">&nbsp;</div>',{variant:"featherlight-swedbank-pay",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_sb_checkout.initPaymentMenu("swedbank-pay-paymentmenu")},afterClose:function(){wc_sb_checkout.form.removeClass("processing").unblock()}})),n()})},initPaymentMenu:function(e,o){console.log("initPaymentMenu"),void 0===o&&(o=function(){}),this.paymentMenu=window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_Swedbank_Pay_Checkout.culture,style:WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle?JSON.parse(WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle):null,onApplicationConfigured:function(e){console.log("onApplicationConfigured"),console.log(e),wc_sb_checkout.isPaymentMenuLoaded=!0,o(null)},onPaymentMenuInstrumentSelected:function(e){console.log("onPaymentMenuInstrumentSelected"),console.log(e),wc_sb_checkout.onPaymentMenuInstrumentSelected(e.name,e.instrument)},onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentCanceled:function(e){console.log("onPaymentCanceled"),console.log(e),wc_sb_common.logError("payment-menu-cancel",e)},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e),wc_sb_common.logError("payment-menu-failed",e)},onError:function(e){wc_sb_common.logError("payment-menu-error",e),o(e)}}),this.paymentMenu.open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),void 0!==this.paymentMenu&&this.paymentMenu&&this.paymentMenu.hasOwnProperty("refresh")&&"function"==typeof this.paymentMenu.refresh?this.paymentMenu.refresh():console.warn("refreshPaymentMenu: refresh workaround")},placeOrder:function(){console.log("placeOrder");let o=e(".woocommerce-checkout").serialize();return e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_place_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:o},dataType:"json"}).done(function(e){e.hasOwnProperty("reload")&&!0===e.reload?window.location.reload():e.hasOwnProperty("result")&&"failure"===e.result&&(wc_sb_common.logError("sb-place-order",e),wc_sb_checkout.onError(e.messages))})},updateOrder:function(o){console.log("updateOrder");let n=e(".woocommerce-checkout").serialize();return void 0===o&&(o=!1),n+="&compatibility="+o,wc_sb_checkout.form.addClass("processing"),wc_sb_common.block(),wc_sb_checkout.xhr&&wc_sb_checkout.xhr.abort(),wc_sb_checkout.xhr=e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_update_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:n},dataType:"json"}).always(function(e){wc_sb_checkout.xhr=!1,wc_sb_checkout.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o)}).done(function(n){if(console.log(n),n.hasOwnProperty("result")&&"success"===n.result)return wc_sb_checkout.js_url=n.js_url,void wc_sb_checkout.refreshPaymentMenu();if(n.hasOwnProperty("result")&&"failure"===n.result){if(""===n.messages)return void console.warn("Error message is empty.");if(n.messages.indexOf("Order update is not available.")>-1&&!o)return console.warn("refreshPaymentMenu: refresh workaround. Force reload."),void wc_sb_checkout.updateOrder(!0).done(function(e){e.hasOwnProperty("js_url")&&wc_sb_checkout.initPaymentJS(e.js_url)})}n.hasOwnProperty("reload")&&!0===n.reload?window.location.reload():(!0===n.result.refresh&&e(document.body).trigger("update_checkout"),wc_sb_common.logError("sb-update-order",n))}),wc_sb_checkout.xhr},onPaymentMenuInstrumentSelected:function(o,n){console.log("onPaymentMenuInstrumentSelected",o,n),e(document.body).trigger("sb_payment_menu_instrument_selected",[o,n])},onError:function(e){console.log("onError",e),wc_sb_checkout.submit_error('<div class="woocommerce-error">'+e+"</div>")},submit_error:function(o){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_sb_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+o+"</div>"),wc_sb_checkout.form.removeClass("processing").unblock(),wc_sb_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_sb_checkout.scroll_to_notices(),e(document.body).trigger("checkout_error")},scroll_to_notices:function(){let o=e(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");o.length||(o=e(".form.checkout")),e.scroll_to_notices(o)}},e(document).ready(function(){wc_sb_checkout.init(e("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbnQtY2hlY2tvdXQuanMiXSwibmFtZXMiOlsialF1ZXJ5IiwiJCIsIndpbmRvdyIsIndjX3NiX2NoZWNrb3V0IiwianNfdXJsIiwicGF5bWVudE1lbnUiLCJpc1BheW1lbnRNZW51TG9hZGVkIiwieGhyIiwiaW5pdCIsImZvcm0iLCJ0aGlzIiwiZm9ybV9zdWJtaXQiLCJvbiIsIm9uU3VibWl0IiwiZG9jdW1lbnQiLCJib2R5IiwiYmluZCIsIm9uVXBkYXRlQ2hlY2tvdXQiLCJyZXNldENoZWNrb3V0Iiwib25VcGRhdGVkQ2hlY2tvdXQiLCJ3Y19zYl9jb21tb24iLCJpc0luc3RhbnRDaGVja291dCIsImluaXRJbnN0YW50Q2hlY2tvdXQiLCJjb25zb2xlIiwibG9nIiwiaXNDaGVja2luRW5hYmxlZCIsImNvbnN1bWVyUHJvZmlsZUVsbSIsImxlbmd0aCIsInJlZmVyZW5jZSIsImRhdGEiLCJpbml0Q2hlY2tvdXQiLCJzaG93IiwiZmluZCIsInJlbW92ZSIsImFwcGVuZCIsImlzUGF5bWVudE1ldGhvZENob3NlbiIsImlzIiwib25DbG9zZSIsInVuYmxvY2siLCJvblJlYWR5IiwidmFsaWRhdGVGb3JtIiwidXBkYXRlT3JkZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJhZGRDbGFzcyIsImJsb2NrIiwicGxhY2VPcmRlciIsImFsd2F5cyIsInJlc3BvbnNlIiwicmVtb3ZlQ2xhc3MiLCJmYWlsIiwianFYSFIiLCJ0ZXh0U3RhdHVzIiwib25FcnJvciIsImRvbmUiLCJyZXN1bHQiLCJoYXNPd25Qcm9wZXJ0eSIsInJlbG9hZCIsImxvY2F0aW9uIiwicmVmcmVzaCIsInRyaWdnZXIiLCJtZXNzYWdlcyIsImlzUmVkaXJlY3RNZXRob2RFbmFibGVkIiwic2VsZiIsImhyZWYiLCJpbml0UGF5bWVudEpTIiwidXJsIiwiY2FsbGJhY2siLCJwYXlleCIsImhvc3RlZFZpZXciLCJjbG9zZSIsImxvYWRKcyIsImhpZGUiLCJpbml0UGF5bWVudE1lbnUiLCJmZWF0aGVybGlnaHQiLCJ2YXJpYW50IiwicGVyc2lzdCIsImNsb3NlT25DbGljayIsImNsb3NlT25Fc2MiLCJhZnRlck9wZW4iLCJhZnRlckNsb3NlIiwiaWQiLCJjb250YWluZXIiLCJjdWx0dXJlIiwiV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQiLCJzdHlsZSIsInBheW1lbnRNZW51U3R5bGUiLCJKU09OIiwicGFyc2UiLCJvbkFwcGxpY2F0aW9uQ29uZmlndXJlZCIsIm9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQiLCJuYW1lIiwiaW5zdHJ1bWVudCIsIm9uUGF5bWVudENyZWF0ZWQiLCJvblBheW1lbnRDb21wbGV0ZWQiLCJyZWRpcmVjdFVybCIsIm9uUGF5bWVudENhbmNlbGVkIiwibG9nRXJyb3IiLCJvblBheW1lbnRGYWlsZWQiLCJvcGVuIiwicmVmcmVzaFBheW1lbnRNZW51Iiwid2FybiIsImZpZWxkcyIsInNlcmlhbGl6ZSIsImFqYXgiLCJ0eXBlIiwiYWpheF91cmwiLCJhY3Rpb24iLCJub25jZSIsImRhdGFUeXBlIiwiY29tcGF0aWJpbGl0eSIsImFib3J0IiwiaW5kZXhPZiIsInN1Ym1pdF9lcnJvciIsImVycm9yX21lc3NhZ2UiLCJwcmVwZW5kIiwiYmx1ciIsInNjcm9sbF90b19ub3RpY2VzIiwic2Nyb2xsRWxlbWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQUFDQUEsT0FBUSxTQUFVQyxHQUNkLGFBS0FDLE9BQU9DLGVBQWlCLENBQ3BCQyxPQUFRLEtBQ1JDLFlBQWEsS0FDYkMscUJBQXFCLEVBQ3JCQyxLQUFLLEVBS0xDLEtBQU0sU0FBVUMsR0FDWkMsS0FBS0QsS0FBZUEsRUFDcEJDLEtBQUtDLGFBQWUsRUFFcEJWLEVBQUdTLEtBQUtELE1BR0hHLEdBQUksUUFBUyxlQUFnQkYsS0FBS0csVUFHbENELEdBQUksOENBRVRYLEVBQUdhLFNBQVNDLE1BQU9DLEtBQU0sa0JBQW1CTixLQUFLTyxrQkFDakRoQixFQUFHYSxTQUFTQyxNQUFPSCxHQUFJLGlC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QixVQUN4SC9HLGVBQWVNLEtBQUt3QyxZQUFhLGNBQWVYLFVBQ2hEbkMsZUFBZU0sS0FBS3VCLEtBQU0sdUNBQXdDNEIsUUFBUyxZQUFhd0QsT0FDeEZqSCxlQUFla0gsb0JBQ2ZwSCxFQUFHYSxTQUFTQyxNQUFPNkMsUUFBUyxtQkFFaEN5RCxrQkFBbUIsV0FDZixJQUFJQyxFQUFnQnJILEVBQUcsaUZBQ2hCcUgsRUFBYzNGLFNBQ2pCMkYsRUFBZ0JySCxFQUFHLG1CQUd2QkEsRUFBRW9ILGtCQUFtQkMsS0FJN0JySCxFQUFFYSxVQUFVeUcsTUFBTyxXQUNmcEgsZUFBZUssS0FBTVAsRUFBRyIsImZpbGUiOiJpbnN0YW50LWNoZWNrb3V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCB3Y19jaGVja291dF9wYXJhbXMgKi9cbmpRdWVyeSggZnVuY3Rpb24oICQgKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLyoqXG4gICAgICogT2JqZWN0IHRvIGhhbmRsZSBTd2VkYmFuayBQYXkgY2hlY2tvdXQgcGF5bWVudCBmb3Jtcy5cbiAgICAgKi9cbiAgICB3aW5kb3cud2Nfc2JfY2hlY2tvdXQgPSB7XG4gICAgICAgIGpzX3VybDogbnVsbCxcbiAgICAgICAgcGF5bWVudE1lbnU6IG51bGwsXG4gICAgICAgIGlzUGF5bWVudE1lbnVMb2FkZWQ6IGZhbHNlLFxuICAgICAgICB4aHI6IGZhbHNlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIGUgaGFuZGxlcnMgYW5kIFVJIHN0YXRlLlxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIGZvcm0gKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm0gICAgICAgICA9IGZvcm07XG4gICAgICAgICAgICB0aGlzLmZvcm1fc3VibWl0ICA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkKCB0aGlzLmZvcm0gKVxuICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBiaW5kIGRpcmVjdGx5IHRvIHRoZSBjbGljayAoYW5kIG5vdCBjaGVja291dF9wbGFjZV9vcmRlcl9wYXlleF9jaGVja291dCkgdG8gYXZvaWQgcG9wdXAgYmxvY2tlcnNcbiAgICAgICAgICAgIC8vIGVzcGVjaWFsbHkgb24gbW9iaWxlIGRldmljZXMgKGxpa2Ugb24gQ2hyb21lIGZvciBpT1MpIGZyb20gYmxvY2tpbmcgcGF5ZXhfY2hlY2tvdXQocGF5bWVudF9pZCwge30sICdvcGVuJyk7IGZyb20gb3BlbmluZyBhIHRhYlxuICAgICAgICAgICAgICAgIC5vbiggJ2NsaWNrJywgJyNwbGFjZV9vcmRlcicsIHRoaXMub25TdWJtaXQgKVxuXG4gICAgICAgICAgICAgICAgLy8gV29vQ29tbWVyY2UgbGV0cyB1cyByZXR1cm4gYSBmYWxzZSBvbiBjaGVja291dF9wbGFjZV9vcmRlcl97Z2F0ZXdheX0gdG8ga2VlcCB0aGUgZm9ybSBmcm9tIHN1Ym1pdHRpbmdcbiAgICAgICAgICAgICAgICAub24oICdzdWJtaXQgY2hlY2tvdXRfcGxhY2Vfb3JkZXJfcGF5ZXhfY2hlY2tvdXQnICk7XG5cbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5iaW5kKCAndXBkYXRlX2NoZWNrb3V0JywgdGhpcy5vblVwZGF0ZUNoZWNrb3V0ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICdjaGVja291dF9lcnJvcicsIHRoaXMucmVzZXRDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAndXBkYXRlZF9jaGVja291dCcsIHRoaXMub25VcGRhdGVkQ2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ2JsdXInLCB0aGlzLm9uVXBkYXRlZENoZWNrb3V0ICk7XG5cbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgSW5zdGFudCBDaGVja291dFxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0SW5zdGFudENoZWNrb3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemUgSW5zdGFudCBDaGVja291dFxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdEluc3RhbnRDaGVja291dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdJbml0aWFsaXphdGlvbiBvZiBJbnN0YW50IENoZWNrb3V0Li4uJyApO1xuXG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2hlY2tvdXQgd2lsbCBiZSBsb2FkZWQgYWZ0ZXIgY2hlY2tpblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0LmluaXRDaGVja291dCggZGF0YS5jb25zdW1lclByb2ZpbGVSZWYgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jb21tb24uaXNDaGVja2luRW5hYmxlZCgpICkge1xuICAgICAgICAgICAgICAgIC8vLy93Y19zYl9jb21tb24uaGlkZUFkZHJlc3NGaWVsZHMoKTtcblxuICAgICAgICAgICAgICAgIC8vIFVzZSBzYXZlZCBjb25zdW1lclByb2ZpbGVSZWZcbiAgICAgICAgICAgICAgICBsZXQgY29uc3VtZXJQcm9maWxlRWxtID0gJCggJyNzd2VkYmFuay1wYXktY29uc3VtZXItcHJvZmlsZScgKTtcbiAgICAgICAgICAgICAgICBpZiAoIGNvbnN1bWVyUHJvZmlsZUVsbS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVmZXJlbmNlID0gY29uc3VtZXJQcm9maWxlRWxtLmRhdGEoICdyZWZlcmVuY2UnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnSW5pdGlhdGUgY29uc3VtZXJQcm9maWxlUmVmJywgcmVmZXJlbmNlICk7XG4gICAgICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQuaW5pdENoZWNrb3V0KCByZWZlcmVuY2UgKTtcbiAgICAgICAgICAgICAgICAgICAgLy8vL3djX3NiX2NoZWNraW4uaW5pdENoZWNrSW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWF0ZSBjaGVja2luXG4gICAgICAgICAgICAgICAgICAgIC8vLy93Y19zYl9jaGVja2luLmluaXRDaGVja0luKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRDaGVja291dDogZnVuY3Rpb24oIHJlZmVyZW5jZSApIHtcbiAgICAgICAgICAgIC8vIFNob3cgXCJDaGFuZ2Ugc2hpcHBpbmcgaW5mb1wiIGJ1dHRvblxuICAgICAgICAgICAgJCggJyNjaGFuZ2Utc2hpcHBpbmctaW5mbycgKS5zaG93KCk7XG5cbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0uZmluZCggJy5zd2VkYmFua19wYXlfY3VzdG9tZXJfcmVmZXJlbmNlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5hcHBlbmQoIFwiPGlucHV0IHR5cGU9J2hpZGRlbicgY2xhc3M9J3N3ZWRiYW5rX3BheV9jdXN0b21lcl9yZWZlcmVuY2UnIG5hbWU9J3N3ZWRiYW5rX3BheV9jdXN0b21lcl9yZWZlcmVuY2UnIHZhbHVlPSdcIiArIHJlZmVyZW5jZSArIFwiJy8+XCIgKTtcblxuICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5mb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQub25TdWJtaXQoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1BheW1lbnRNZXRob2RDaG9zZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoICcjcGF5bWVudF9tZXRob2RfcGF5ZXhfY2hlY2tvdXQnICkuaXMoICc6Y2hlY2tlZCcgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdjX3NiX2NvbW1vbi51bmJsb2NrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ1JlYWR5JyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uVXBkYXRlQ2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZUNoZWNrb3V0JyApO1xuXG4gICAgICAgICAgICBpZiAoICEgd2Nfc2JfY29tbW9uLmlzSW5zdGFudENoZWNrb3V0KCkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBAdG9kb1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uVXBkYXRlZENoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVkQ2hlY2tvdXQnICk7XG5cbiAgICAgICAgICAgIGlmICggISB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggd2Nfc2JfY2hlY2tvdXQuZm9ybS5pcyggJy5wcm9jZXNzaW5nJyApICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCAhIHdjX3NiX2NvbW1vbi52YWxpZGF0ZUZvcm0oKSApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uVXBkYXRlZENoZWNrb3V0OiBWYWxpZGF0aW9uIGlzIGZhaWxlZCcgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQsIC53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC51cGRhdGVPcmRlcigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiggZSApIHtcbiAgICAgICAgICAgIGlmICggd2Nfc2JfY2hlY2tvdXQuZm9ybV9zdWJtaXQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggd2Nfc2JfY2hlY2tvdXQuaXNQYXltZW50TWV0aG9kQ2hvc2VuKCkgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2YgZSAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoICEgd2Nfc2JfY29tbW9uLnZhbGlkYXRlRm9ybSgpICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblN1Ym1pdCcgKTtcblxuICAgICAgICAgICAgICAgIGlmICggd2Nfc2JfY2hlY2tvdXQuZm9ybS5pcyggJy5wcm9jZXNzaW5nJyApICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLmFkZENsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24uYmxvY2soKTtcbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5wbGFjZU9yZGVyKClcbiAgICAgICAgICAgICAgICAgICAgLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIC5mYWlsKCBmdW5jdGlvbigganFYSFIsIHRleHRTdGF0dXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICAuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLnJlc3VsdCAhPT0gJ3N1Y2Nlc3MnICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVsb2FkJykgJiYgdHJ1ZSA9PT0gcmVzcG9uc2UucmVsb2FkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIHVwZGF0ZSBpbiBjYXNlIHdlIG5lZWQgYSBmcmVzaCBub25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlZnJlc2ggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAndXBkYXRlX2NoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0Lm9uRXJyb3IoIHJlc3BvbnNlLm1lc3NhZ2VzICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc1JlZGlyZWN0TWV0aG9kRW5hYmxlZCgpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBwYXltZW50IGdhdGV3YXkgcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnUmVkaXJlY3RpbmcgdG8gJyArIHJlc3BvbnNlWydyZWRpcmVjdF91cmwnXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb24uaHJlZiA9IHJlc3BvbnNlWydyZWRpcmVjdF91cmwnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBTd2VkQmFuayBQYXkgQ2hlY2tvdXQgZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5qc191cmwgPSByZXNwb25zZVsnanNfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggd2Nfc2JfY2hlY2tvdXQuanNfdXJsICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXRDaGVja291dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtX3N1Ym1pdCA9IGZhbHNlO1xuICAgICAgICB9LFxuXG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGUgUGF5bWVudCBKYXZhc2NyaXB0XG4gICAgICAgICAqIEBwYXJhbSB1cmxcbiAgICAgICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICBpbml0UGF5bWVudEpTOiBmdW5jdGlvbiAoIHVybCwgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjYWxsYmFjayA9PT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVzdHJveVxuICAgICAgICAgICAgaWYgKCB3aW5kb3cuaGFzT3duUHJvcGVydHkoICdwYXlleCcgKSAmJiB3aW5kb3cucGF5ZXguaGFzT3duUHJvcGVydHkoICdob3N0ZWRWaWV3JyApICkge1xuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LnBheW1lbnRNZW51ICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnBheWV4Lmhvc3RlZFZpZXcucGF5bWVudE1lbnUoKS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoICcjcGF5bWVudC1zd2VkYmFuay1wYXktY2hlY2tvdXQgaWZyYW1lJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIC8vZGVsZXRlIHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZXN0cm95IEpTXG4gICAgICAgICAgICAkKCBcInNjcmlwdFtzcmMqPSdweC5wYXltZW50bWVudS5jbGllbnQnXVwiICkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIExvYWQgSlNcbiAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2FkSnMoIHVybCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoICcjcGF5bWVudC1zd2VkYmFuay1wYXktY2hlY2tvdXQgaWZyYW1lJyApLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgLy8gTG9hZCBTd2VkQmFuayBQYXkgQ2hlY2tvdXQgZnJhbWVcbiAgICAgICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWF0ZSB0aGUgcGF5bWVudCBtZW51IGluIFwiSW5zdGFudCBDaGVja291dFwiXG4gICAgICAgICAgICAgICAgICAgICQoICcjcGF5bWVudCcgKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRQYXltZW50TWVudSggJ3BheW1lbnQtc3dlZGJhbmstcGF5LWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIHRoZSBwYXltZW50IG1lbnUgaW4gdGhlIGZyYW1lXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnbm9uLWluc3RhbnQgY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgICQuZmVhdGhlcmxpZ2h0KCAnPGRpdiBpZD1cInN3ZWRiYW5rLXBheS1wYXltZW50bWVudVwiPiZuYnNwOzwvZGl2PicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ6ICdmZWF0aGVybGlnaHQtc3dlZGJhbmstcGF5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBlcnNpc3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ2xpY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkVzYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhZnRlck9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0UGF5bWVudE1lbnUoICdzd2VkYmFuay1wYXktcGF5bWVudG1lbnUnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApLnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKClcbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhdGUgUGF5bWVudCBNZW51LlxuICAgICAgICAgKiBQYXltZW50IEphdmFzY3JpcHQgbXVzdCBiZSBsb2FkZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBpZFxuICAgICAgICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICAgICAgICovXG4gICAgICAgIGluaXRQYXltZW50TWVudTogZnVuY3Rpb24gKCBpZCwgY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ2luaXRQYXltZW50TWVudScgKTtcblxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgY2FsbGJhY2sgPT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYWQgU3dlZEJhbmsgUGF5IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51ID0gd2luZG93LnBheWV4Lmhvc3RlZFZpZXcucGF5bWVudE1lbnUoIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IGlkLFxuICAgICAgICAgICAgICAgIGN1bHR1cmU6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmN1bHR1cmUsXG4gICAgICAgICAgICAgICAgc3R5bGU6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LnBheW1lbnRNZW51U3R5bGUgPyBKU09OLnBhcnNlKCBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5wYXltZW50TWVudVN0eWxlICkgOiBudWxsLFxuICAgICAgICAgICAgICAgIG9uQXBwbGljYXRpb25Db25maWd1cmVkOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvbkFwcGxpY2F0aW9uQ29uZmlndXJlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaXNQYXltZW50TWVudUxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBudWxsICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQub25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCggZGF0YS5uYW1lLCBkYXRhLmluc3RydW1lbnQgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENyZWF0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRDcmVhdGVkJyApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50Q29tcGxldGVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q29tcGxldGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uLmhyZWYgPSBkYXRhLnJlZGlyZWN0VXJsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50Q2FuY2VsZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRDYW5jZWxlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWNhbmNlbCcsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudEZhaWxlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudEZhaWxlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWZhaWxlZCcsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmxvY2F0aW9uLmhyZWYgPSBkYXRhLnJlZGlyZWN0VXJsO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdwYXltZW50LW1lbnUtZXJyb3InLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51Lm9wZW4oKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVmcmVzaFxuICAgICAgICAgKi9cbiAgICAgICAgcmVmcmVzaFBheW1lbnRNZW51OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAncmVmcmVzaFBheW1lbnRNZW51JyApO1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgdGhpcy5wYXltZW50TWVudSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51ICYmXG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudS5oYXNPd25Qcm9wZXJ0eSggJ3JlZnJlc2gnICkgJiZcbiAgICAgICAgICAgICAgICB0eXBlb2YgdGhpcy5wYXltZW50TWVudS5yZWZyZXNoID09PSAnZnVuY3Rpb24nIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51LnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAncmVmcmVzaFBheW1lbnRNZW51OiByZWZyZXNoIHdvcmthcm91bmQnICk7XG4gICAgICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5pbml0UGF5bWVudEpTKCB3Y19zYl9jaGVja291dC5qc191cmwgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQbGFjZSBPcmRlclxuICAgICAgICAgKiBAcmV0dXJuIHtKUXVlcnlQcm9taXNlPGFueT59XG4gICAgICAgICAqL1xuICAgICAgICBwbGFjZU9yZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3BsYWNlT3JkZXInICk7XG4gICAgICAgICAgICBsZXQgZmllbGRzID0gJCgnLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykuc2VyaWFsaXplKCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV9wbGFjZV9vcmRlcicsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmllbGRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9ICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3JlbG9hZCcpICYmIHRydWUgPT09IHJlc3BvbnNlLnJlbG9hZCApIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICBcdFx0fVxuXG4gICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVzdWx0JykgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnZmFpbHVyZScgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3NiLXBsYWNlLW9yZGVyJywgcmVzcG9uc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSBPcmRlclxuICAgICAgICAgKiBAcGFyYW0gY29tcGF0aWJpbGl0eVxuICAgICAgICAgKiBAcmV0dXJuIHtKUXVlcnlQcm9taXNlPGFueT59XG4gICAgICAgICAqL1xuICAgICAgICB1cGRhdGVPcmRlcjogZnVuY3Rpb24gKCBjb21wYXRpYmlsaXR5ICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlcicgKTtcbiAgICAgICAgICAgIGxldCBmaWVsZHMgPSAkKCcud29vY29tbWVyY2UtY2hlY2tvdXQnKS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgY29tcGF0aWJpbGl0eSA9PT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgY29tcGF0aWJpbGl0eSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmaWVsZHMgKz0gJyZjb21wYXRpYmlsaXR5PScgKyBjb21wYXRpYmlsaXR5O1xuXG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLmFkZENsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5ibG9jaygpO1xuXG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NoZWNrb3V0LnhociApIHtcbiAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC54aHIuYWJvcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQueGhyID0gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdzd2VkYmFua19wYXlfdXBkYXRlX29yZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBmaWVsZHNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgIC5hbHdheXMoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnhociA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLnVuYmxvY2soKTtcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuZmFpbCggZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ3VwZGF0ZU9yZGVyIGVycm9yOicgKyB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQub25FcnJvciggdGV4dFN0YXR1cyApO1xuICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgIC5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCByZXNwb25zZSApO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3VsdCcpICYmIHJlc3BvbnNlLnJlc3VsdCA9PT0gJ3N1Y2Nlc3MnICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCBQYXltZW50IE1lbnVcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmpzX3VybCA9IHJlc3BvbnNlWydqc191cmwnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnJlZnJlc2hQYXltZW50TWVudSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZXN1bHQnKSAmJiByZXNwb25zZS5yZXN1bHQgPT09ICdmYWlsdXJlJyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlcyA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oICdFcnJvciBtZXNzYWdlIGlzIGVtcHR5LicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN3ZWRCYW5rIFBheW1lbnQgcmV0dXJucyBlcnJvciB0aGF0IE9yZGVyIHVwZGF0ZSBpcyBub3QgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLm1lc3NhZ2VzLmluZGV4T2YoICdPcmRlciB1cGRhdGUgaXMgbm90IGF2YWlsYWJsZS4nICkgPiAtMSAmJiAhIGNvbXBhdGliaWxpdHkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yY2UgcmVsb2FkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAncmVmcmVzaFBheW1lbnRNZW51OiByZWZyZXNoIHdvcmthcm91bmQuIEZvcmNlIHJlbG9hZC4nICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQudXBkYXRlT3JkZXIoIHRydWUgKS5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdqc191cmwnKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRQYXltZW50SlMoIHJlc3BvbnNlLmpzX3VybCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVsb2FkJykgJiYgdHJ1ZSA9PT0gcmVzcG9uc2UucmVsb2FkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIHVwZGF0ZSBpbiBjYXNlIHdlIG5lZWQgYSBmcmVzaCBub25jZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIHRydWUgPT09IHJlc3BvbnNlLnJlc3VsdC5yZWZyZXNoICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdzYi11cGRhdGUtb3JkZXInLCByZXNwb25zZSApO1xuICAgICAgICAgICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0Lm9uRXJyb3IoIHJlc3BvbnNlLm1lc3NhZ2VzICk7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICB3Y19zYl9jaGVja291dC54aHI7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9uIFBheW1lbnQgTWVudSBJbnN0cnVtZW50IFNlbGVjdGVkXG4gICAgICAgICAqIEBwYXJhbSBuYW1lXG4gICAgICAgICAqIEBwYXJhbSBpbnN0cnVtZW50XG4gICAgICAgICAqL1xuICAgICAgICBvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkOiBmdW5jdGlvbiAoIG5hbWUsIGluc3RydW1lbnQgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQnLCBuYW1lLCBpbnN0cnVtZW50ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3NiX3BheW1lbnRfbWVudV9pbnN0cnVtZW50X3NlbGVjdGVkJywgW25hbWUsIGluc3RydW1lbnRdICk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25FcnJvcicsIGRhdGEgKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnN1Ym1pdF9lcnJvciggJzxkaXYgY2xhc3M9XCJ3b29jb21tZXJjZS1lcnJvclwiPicgKyBkYXRhICsgJzwvZGl2PicgKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0X2Vycm9yOiBmdW5jdGlvbiggZXJyb3JfbWVzc2FnZSApIHtcbiAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQsIC53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLnByZXBlbmQoICc8ZGl2IGNsYXNzPVwid29vY29tbWVyY2UtTm90aWNlR3JvdXAgd29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXRcIj4nICsgZXJyb3JfbWVzc2FnZSArICc8L2Rpdj4nICk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKS51bmJsb2NrKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLmZpbmQoICcuaW5wdXQtdGV4dCwgc2VsZWN0LCBpbnB1dDpjaGVja2JveCcgKS50cmlnZ2VyKCAndmFsaWRhdGUnICkuYmx1cigpO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuc2Nyb2xsX3RvX25vdGljZXMoKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAnY2hlY2tvdXRfZXJyb3InICk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjcm9sbF90b19ub3RpY2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBzY3JvbGxFbGVtZW50ID0gJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC11cGRhdGVPcmRlclJldmlldywgLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0JyApO1xuICAgICAgICAgICAgaWYgKCAhIHNjcm9sbEVsZW1lbnQubGVuZ3RoICkge1xuICAgICAgICAgICAgICAgIHNjcm9sbEVsZW1lbnQgPSAkKCAnLmZvcm0uY2hlY2tvdXQnICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQuc2Nyb2xsX3RvX25vdGljZXMoIHNjcm9sbEVsZW1lbnQgKTtcbiAgICAgICAgfSxcbiAgICB9O1xuXG4gICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaW5pdCggJCggXCJmb3JtLmNoZWNrb3V0LCBmb3JtI29yZGVyX3JldmlldywgZm9ybSNhZGRfcGF5bWVudF9tZXRob2RcIiApICk7XG4gICAgfSApO1xufSk7XG5cbiJdfQ==
