jQuery(function(e){"use strict";window.wc_sb_checkout={js_url:null,paymentMenu:null,isPaymentMenuLoaded:!1,xhr:!1,init:function(o){this.form=o,this.form_submit=!1,e(this.form).on("click","#place_order",this.onSubmit).on("submit checkout_place_order_payex_checkout"),e(document.body).bind("update_checkout",this.onUpdateCheckout),e(document.body).on("checkout_error",this.resetCheckout),e(document.body).on("updated_checkout",this.onUpdatedCheckout),e(document.body).on("blur",this.onUpdatedCheckout),wc_sb_common.isInstantCheckout()&&wc_sb_checkout.initInstantCheckout()},initInstantCheckout:function(){if(console.log("Initialization of Instant Checkout..."),wc_sb_common.isCheckinEnabled(),wc_sb_common.isCheckinEnabled()){let o=e("#swedbank-pay-consumer-profile");if(o.length>0){let e=o.data("reference");console.log("Initiate consumerProfileRef",e)}}},initCheckout:function(o){e("#change-shipping-info").show(),wc_sb_checkout.form.find(".swedbank_pay_customer_reference").remove(),wc_sb_checkout.form.append("<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='"+o+"'/>"),wc_sb_checkout.onSubmit()},isPaymentMethodChosen:function(){return e("#payment_method_payex_checkout").is(":checked")},onClose:function(){wc_sb_common.unblock()},onReady:function(){console.log("Ready")},onUpdateCheckout:function(){if(console.log("onUpdateCheckout"),!wc_sb_common.isInstantCheckout())return!1},onUpdatedCheckout:function(){return console.log("onUpdatedCheckout"),!!wc_sb_common.isInstantCheckout()&&(!wc_sb_checkout.form.is(".processing")&&(wc_sb_common.validateForm()?(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),void wc_sb_checkout.updateOrder()):(console.log("onUpdatedCheckout: Validation is failed"),!1)))},onSubmit:function(o){return!!wc_sb_checkout.form_submit||(!wc_sb_checkout.isPaymentMethodChosen()||(void 0!==o&&o.preventDefault(),!!wc_sb_common.validateForm()&&(console.log("onSubmit"),!wc_sb_checkout.form.is(".processing")&&(e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_sb_checkout.form.addClass("processing"),wc_sb_common.block(),wc_sb_checkout.placeOrder().always(function(e){wc_sb_checkout.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){wc_sb_checkout.onError(o)}).done(function(o){if(console.log(o),"success"!==o.result)return o.hasOwnProperty("reload")&&!0===o.reload?void window.location.reload():(!0===o.result.refresh&&e(document.body).trigger("update_checkout"),void wc_sb_checkout.onError(o.messages));wc_sb_checkout.js_url=o.js_url,wc_sb_checkout.initPaymentJS(wc_sb_checkout.js_url)}),!1))))},resetCheckout:function(){wc_sb_checkout.form_submit=!1},initPaymentJS:function(o,n){void 0===n&&(n=function(){}),window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&(void 0!==window.payex.hostedView.paymentMenu&&window.payex.hostedView.paymentMenu().close(),e("#payment-swedbank-pay-checkout iframe").remove()),e("script[src*='px.paymentmenu.client']").remove(),wc_sb_common.loadJs(o,function(){e("#payment-swedbank-pay-checkout iframe").remove(),wc_sb_common.isInstantCheckout()?(e("#payment").hide(),wc_sb_checkout.initPaymentMenu("payment-swedbank-pay-checkout")):(console.log("non-instant checkout"),e.featherlight('<div id="swedbank-pay-paymentmenu">&nbsp;</div>',{variant:"featherlight-swedbank-pay",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_sb_checkout.initPaymentMenu("swedbank-pay-paymentmenu")},afterClose:function(){wc_sb_checkout.form.removeClass("processing").unblock()}})),n()})},initPaymentMenu:function(e,o){console.log("initPaymentMenu"),void 0===o&&(o=function(){}),this.paymentMenu=window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_Swedbank_Pay_Checkout.culture,style:WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle?JSON.parse(WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle):null,onApplicationConfigured:function(e){console.log("onApplicationConfigured"),console.log(e),wc_sb_checkout.isPaymentMenuLoaded=!0,o(null)},onPaymentMenuInstrumentSelected:function(e){console.log("onPaymentMenuInstrumentSelected"),console.log(e),wc_sb_checkout.onPaymentMenuInstrumentSelected(e.name,e.instrument)},onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentCanceled:function(e){console.log("onPaymentCanceled"),console.log(e),wc_sb_common.logError("payment-menu-cancel",e)},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e),wc_sb_common.logError("payment-menu-failed",e)},onError:function(e){wc_sb_common.logError("payment-menu-error",e),o(e)}}),this.paymentMenu.open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),void 0!==this.paymentMenu&&this.paymentMenu&&this.paymentMenu.hasOwnProperty("refresh")&&"function"==typeof this.paymentMenu.refresh?this.paymentMenu.refresh():console.warn("refreshPaymentMenu: refresh workaround")},placeOrder:function(){console.log("placeOrder");let o=e(".woocommerce-checkout").serialize();return e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_place_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:o},dataType:"json"}).done(function(e){e.hasOwnProperty("reload")&&!0===e.reload?window.location.reload():e.hasOwnProperty("result")&&"failure"===e.result&&(wc_sb_common.logError("sb-place-order",e),wc_sb_checkout.onError(e.messages))})},updateOrder:function(o){console.log("updateOrder");let n=e(".woocommerce-checkout").serialize();return void 0===o&&(o=!1),n+="&compatibility="+o,wc_sb_checkout.form.addClass("processing"),wc_sb_common.block(),wc_sb_checkout.xhr&&wc_sb_checkout.xhr.abort(),wc_sb_checkout.xhr=e.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_update_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:n},dataType:"json"}).always(function(e){wc_sb_checkout.xhr=!1,wc_sb_checkout.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o)}).done(function(n){if(console.log(n),n.hasOwnProperty("result")&&"success"===n.result)return wc_sb_checkout.js_url=n.js_url,void wc_sb_checkout.refreshPaymentMenu();if(n.hasOwnProperty("result")&&"failure"===n.result){if(""===n.messages)return void console.warn("Error message is empty.");if(n.messages.indexOf("Order update is not available.")>-1&&!o)return console.warn("refreshPaymentMenu: refresh workaround. Force reload."),void wc_sb_checkout.updateOrder(!0).done(function(e){e.hasOwnProperty("js_url")&&wc_sb_checkout.initPaymentJS(e.js_url)})}n.hasOwnProperty("reload")&&!0===n.reload?window.location.reload():(!0===n.result.refresh&&e(document.body).trigger("update_checkout"),wc_sb_common.logError("sb-update-order",n))}),wc_sb_checkout.xhr},onPaymentMenuInstrumentSelected:function(o,n){console.log("onPaymentMenuInstrumentSelected",o,n),e(document.body).trigger("sb_payment_menu_instrument_selected",[o,n])},onError:function(e){console.log("onError",e),wc_sb_checkout.submit_error('<div class="woocommerce-error">'+e+"</div>")},submit_error:function(o){e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_sb_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+o+"</div>"),wc_sb_checkout.form.removeClass("processing").unblock(),wc_sb_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_sb_checkout.scroll_to_notices(),e(document.body).trigger("checkout_error")},scroll_to_notices:function(){let o=e(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");o.length||(o=e(".form.checkout")),e.scroll_to_notices(o)}},e(document).ready(function(){wc_sb_checkout.init(e("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbnQtY2hlY2tvdXQuanMiXSwibmFtZXMiOlsialF1ZXJ5IiwiJCIsIndpbmRvdyIsIndjX3NiX2NoZWNrb3V0IiwianNfdXJsIiwicGF5bWVudE1lbnUiLCJpc1BheW1lbnRNZW51TG9hZGVkIiwieGhyIiwiaW5pdCIsImZvcm0iLCJ0aGlzIiwiZm9ybV9zdWJtaXQiLCJvbiIsIm9uU3VibWl0IiwiZG9jdW1lbnQiLCJib2R5IiwiYmluZCIsIm9uVXBkYXRlQ2hlY2tvdXQiLCJyZXNldENoZWNrb3V0Iiwib25VcGRhdGVkQ2hlY2tvdXQiLCJ3Y19zYl9jb21tb24iLCJpc0luc3RhbnRDaGVja291dCIsImluaXRJbnN0YW50Q2hlY2tvdXQiLCJjb25zb2xlIiwibG9nIiwiaXNDaGVja2luRW5hYmxlZCIsImNvbnN1bWVyUHJvZmlsZUVsbSIsImxlbmd0aCIsInJlZmVyZW5jZSIsImRhdGEiLCJpbml0Q2hlY2tvdXQiLCJzaG93IiwiZmluZCIsInJlbW92ZSIsImFwcGVuZCIsImlzUGF5bWVudE1ldGhvZENob3NlbiIsImlzIiwib25DbG9zZSIsInVuYmxvY2siLCJvblJlYWR5IiwidmFsaWRhdGVGb3JtIiwidXBkYXRlT3JkZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJhZGRDbGFzcyIsImJsb2NrIiwicGxhY2VPcmRlciIsImFsd2F5cyIsInJlc3BvbnNlIiwicmVtb3ZlQ2xhc3MiLCJmYWlsIiwianFYSFIiLCJ0ZXh0U3RhdHVzIiwib25FcnJvciIsImRvbmUiLCJyZXN1bHQiLCJoYXNPd25Qcm9wZXJ0eSIsInJlbG9hZCIsImxvY2F0aW9uIiwicmVmcmVzaCIsInRyaWdnZXIiLCJtZXNzYWdlcyIsImluaXRQYXltZW50SlMiLCJ1cmwiLCJjYWxsYmFjayIsInBheWV4IiwiaG9zdGVkVmlldyIsImNsb3NlIiwibG9hZEpzIiwiaGlkZSIsImluaXRQYXltZW50TWVudSIsImZlYXRoZXJsaWdodCIsInZhcmlhbnQiLCJwZXJzaXN0IiwiY2xvc2VPbkNsaWNrIiwiY2xvc2VPbkVzYyIsImFmdGVyT3BlbiIsImFmdGVyQ2xvc2UiLCJpZCIsImNvbnRhaW5lciIsImN1bHR1cmUiLCJXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dCIsInN0eWxlIiwicGF5bWVudE1lbnVTdHlsZSIsIkpTT04iLCJwYXJzZSIsIm9uQXBwbGljYXRpb25Db25maWd1cmVkIiwib25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCIsIm5hbWUiLCJpbnN0cnVtZW50Iiwib25QYXltZW50Q3JlYXRlZCIsIm9uUGF5bWVudENvbXBsZXRlZCIsInNlbGYiLCJocmVmIiwicmVkaXJlY3RVcmwiLCJvblBheW1lbnRDYW5jZWxlZCIsImxvZ0Vycm9yIiwib25QYXltZW50RmFpbGVkIiwib3BlbiIsInJlZnJlc2hQYXltZW50TWVudSIsIndhcm4iLCJmaWVsZHMiLCJzZXJpYWxpemUiLCJhamF4IiwidHlwZSIsImFqYXhfdXJsIiwiYWN0aW9uIiwibm9uY2UiLCJkYXRhVHlwZSIsImNvbXBhdGliaWxpdHkiLCJhYm9ydCIsImluZGV4T2YiLCJzdWJtaXRfZXJyb3IiLCJlcnJvcl9tZXNzYWdlIiwicHJlcGVuZCIsImJsdXIiLCJzY3JvbGxfdG9fbm90aWNlcyIsInNjcm9sbEVsZW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0FBLE9BQVEsU0FBVUMsR0FDZCxhQUtBQyxPQUFPQyxlQUFpQixDQUNwQkMsT0FBUSxLQUNSQyxZQUFhLEtBQ2JDLHFCQUFxQixFQUNyQkMsS0FBSyxFQUtMQyxLQUFNLFNBQVVDLEdBQ1pDLEtBQUtELEtBQWVBLEVBQ3BCQyxLQUFLQyxhQUFlLEVBRXBCVixFQUFHUyxLQUFLRCxNQUdIRyxHQUFJLFFBQVMsZUFBZ0JGLEtBQUtHLFVBR2xDRCxHQUFJLDhDQUVUWCxFQUFHYSxTQUFTQyxNQUFPQyxLQUFNLGtCQUFtQk4sS0FBS08sa0JBQ2pEaEIsRUFBR2EsU0FBU0MsTUFBT0gsR0FBSSxpQkFBa0JGLEtBQUtRLGVBQzlDakIsRUFBR2Es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QUdhLFNBQVNDLE1BQU82QyxRQUFTLG1CQUVoQ3dELGtCQUFtQixXQUNmLElBQUlDLEVBQWdCcEgsRUFBRyxpRkFDaEJvSCxFQUFjMUYsU0FDakIwRixFQUFnQnBILEVBQUcsbUJBR3ZCQSxFQUFFbUgsa0JBQW1CQyxLQUk3QnBILEVBQUVhLFVBQVV3RyxNQUFPLFdBQ2ZuSCxlQUFlSyxLQUFNUCxFQUFHIiwiZmlsZSI6Imluc3RhbnQtY2hlY2tvdXQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIHdjX2NoZWNrb3V0X3BhcmFtcyAqL1xualF1ZXJ5KCBmdW5jdGlvbiggJCApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBPYmplY3QgdG8gaGFuZGxlIFN3ZWRiYW5rIFBheSBjaGVja291dCBwYXltZW50IGZvcm1zLlxuICAgICAqL1xuICAgIHdpbmRvdy53Y19zYl9jaGVja291dCA9IHtcbiAgICAgICAganNfdXJsOiBudWxsLFxuICAgICAgICBwYXltZW50TWVudTogbnVsbCxcbiAgICAgICAgaXNQYXltZW50TWVudUxvYWRlZDogZmFsc2UsXG4gICAgICAgIHhocjogZmFsc2UsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemUgZSBoYW5kbGVycyBhbmQgVUkgc3RhdGUuXG4gICAgICAgICAqL1xuICAgICAgICBpbml0OiBmdW5jdGlvbiggZm9ybSApIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybSAgICAgICAgID0gZm9ybTtcbiAgICAgICAgICAgIHRoaXMuZm9ybV9zdWJtaXQgID0gZmFsc2U7XG5cbiAgICAgICAgICAgICQoIHRoaXMuZm9ybSApXG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGJpbmQgZGlyZWN0bHkgdG8gdGhlIGNsaWNrIChhbmQgbm90IGNoZWNrb3V0X3BsYWNlX29yZGVyX3BheWV4X2NoZWNrb3V0KSB0byBhdm9pZCBwb3B1cCBibG9ja2Vyc1xuICAgICAgICAgICAgLy8gZXNwZWNpYWxseSBvbiBtb2JpbGUgZGV2aWNlcyAobGlrZSBvbiBDaHJvbWUgZm9yIGlPUykgZnJvbSBibG9ja2luZyBwYXlleF9jaGVja291dChwYXltZW50X2lkLCB7fSwgJ29wZW4nKTsgZnJvbSBvcGVuaW5nIGEgdGFiXG4gICAgICAgICAgICAgICAgLm9uKCAnY2xpY2snLCAnI3BsYWNlX29yZGVyJywgdGhpcy5vblN1Ym1pdCApXG5cbiAgICAgICAgICAgICAgICAvLyBXb29Db21tZXJjZSBsZXRzIHVzIHJldHVybiBhIGZhbHNlIG9uIGNoZWNrb3V0X3BsYWNlX29yZGVyX3tnYXRld2F5fSB0byBrZWVwIHRoZSBmb3JtIGZyb20gc3VibWl0dGluZ1xuICAgICAgICAgICAgICAgIC5vbiggJ3N1Ym1pdCBjaGVja291dF9wbGFjZV9vcmRlcl9wYXlleF9jaGVja291dCcgKTtcblxuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLmJpbmQoICd1cGRhdGVfY2hlY2tvdXQnLCB0aGlzLm9uVXBkYXRlQ2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ2NoZWNrb3V0X2Vycm9yJywgdGhpcy5yZXNldENoZWNrb3V0ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICd1cGRhdGVkX2NoZWNrb3V0JywgdGhpcy5vblVwZGF0ZWRDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnYmx1cicsIHRoaXMub25VcGRhdGVkQ2hlY2tvdXQgKTtcblxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRJbnN0YW50Q2hlY2tvdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAqL1xuICAgICAgICBpbml0SW5zdGFudENoZWNrb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ0luaXRpYWxpemF0aW9uIG9mIEluc3RhbnQgQ2hlY2tvdXQuLi4nICk7XG5cbiAgICAgICAgICAgIGlmICggd2Nfc2JfY29tbW9uLmlzQ2hlY2tpbkVuYWJsZWQoKSApIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVja291dCB3aWxsIGJlIGxvYWRlZCBhZnRlciBjaGVja2luXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQuaW5pdENoZWNrb3V0KCBkYXRhLmNvbnN1bWVyUHJvZmlsZVJlZiApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgLy8vL3djX3NiX2NvbW1vbi5oaWRlQWRkcmVzc0ZpZWxkcygpO1xuXG4gICAgICAgICAgICAgICAgLy8gVXNlIHNhdmVkIGNvbnN1bWVyUHJvZmlsZVJlZlxuICAgICAgICAgICAgICAgIGxldCBjb25zdW1lclByb2ZpbGVFbG0gPSAkKCAnI3N3ZWRiYW5rLXBheS1jb25zdW1lci1wcm9maWxlJyApO1xuICAgICAgICAgICAgICAgIGlmICggY29uc3VtZXJQcm9maWxlRWxtLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZWZlcmVuY2UgPSBjb25zdW1lclByb2ZpbGVFbG0uZGF0YSggJ3JlZmVyZW5jZScgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdJbml0aWF0ZSBjb25zdW1lclByb2ZpbGVSZWYnLCByZWZlcmVuY2UgKTtcbiAgICAgICAgICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5pbml0Q2hlY2tvdXQoIHJlZmVyZW5jZSApO1xuICAgICAgICAgICAgICAgICAgICAvLy8vd2Nfc2JfY2hlY2tpbi5pbml0Q2hlY2tJbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIGNoZWNraW5cbiAgICAgICAgICAgICAgICAgICAgLy8vL3djX3NiX2NoZWNraW4uaW5pdENoZWNrSW4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdENoZWNrb3V0OiBmdW5jdGlvbiggcmVmZXJlbmNlICkge1xuICAgICAgICAgICAgLy8gU2hvdyBcIkNoYW5nZSBzaGlwcGluZyBpbmZvXCIgYnV0dG9uXG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5maW5kKCAnLnN3ZWRiYW5rX3BheV9jdXN0b21lcl9yZWZlcmVuY2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLmFwcGVuZCggXCI8aW5wdXQgdHlwZT0naGlkZGVuJyBjbGFzcz0nc3dlZGJhbmtfcGF5X2N1c3RvbWVyX3JlZmVyZW5jZScgbmFtZT0nc3dlZGJhbmtfcGF5X2N1c3RvbWVyX3JlZmVyZW5jZScgdmFsdWU9J1wiICsgcmVmZXJlbmNlICsgXCInLz5cIiApO1xuXG4gICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0LmZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5vblN1Ym1pdCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzUGF5bWVudE1ldGhvZENob3NlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJCggJyNwYXltZW50X21ldGhvZF9wYXlleF9jaGVja291dCcgKS5pcyggJzpjaGVja2VkJyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2Nfc2JfY29tbW9uLnVuYmxvY2soKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnUmVhZHknICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25VcGRhdGVDaGVja291dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uVXBkYXRlQ2hlY2tvdXQnICk7XG5cbiAgICAgICAgICAgIGlmICggISB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEB0b2RvXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25VcGRhdGVkQ2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZWRDaGVja291dCcgKTtcblxuICAgICAgICAgICAgaWYgKCAhIHdjX3NiX2NvbW1vbi5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC5mb3JtLmlzKCAnLnByb2Nlc3NpbmcnICkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICEgd2Nfc2JfY29tbW9uLnZhbGlkYXRlRm9ybSgpICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVkQ2hlY2tvdXQ6IFZhbGlkYXRpb24gaXMgZmFpbGVkJyApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnVwZGF0ZU9yZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uKCBlICkge1xuICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC5mb3JtX3N1Ym1pdCApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC5pc1BheW1lbnRNZXRob2RDaG9zZW4oKSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggISB3Y19zYl9jb21tb24udmFsaWRhdGVGb3JtKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uU3VibWl0JyApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC5mb3JtLmlzKCAnLnByb2Nlc3NpbmcnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0uYWRkQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5ibG9jaygpO1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnBsYWNlT3JkZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24udW5ibG9jaygpO1xuICAgICAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAgICAgLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0Lm9uRXJyb3IoIHRleHRTdGF0dXMgKTtcbiAgICAgICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgICAgIC5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggcmVzcG9uc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UucmVzdWx0ICE9PSAnc3VjY2VzcycgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZWxvYWQnKSAmJiB0cnVlID09PSByZXNwb25zZS5yZWxvYWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgdXBkYXRlIGluIGNhc2Ugd2UgbmVlZCBhIGZyZXNoIG5vbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB0cnVlID09PSByZXNwb25zZS5yZXN1bHQucmVmcmVzaCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICd1cGRhdGVfY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgU3dlZEJhbmsgUGF5IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5qc191cmwgPSByZXNwb25zZVsnanNfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0UGF5bWVudEpTKCB3Y19zYl9jaGVja291dC5qc191cmwgKTtcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldENoZWNrb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm1fc3VibWl0ID0gZmFsc2U7XG4gICAgICAgIH0sXG5cblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWF0ZSBQYXltZW50IEphdmFzY3JpcHRcbiAgICAgICAgICogQHBhcmFtIHVybFxuICAgICAgICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICAgICAgICovXG4gICAgICAgIGluaXRQYXltZW50SlM6IGZ1bmN0aW9uICggdXJsLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIGNhbGxiYWNrID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEZXN0cm95XG4gICAgICAgICAgICBpZiAoIHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSggJ3BheWV4JyApICYmIHdpbmRvdy5wYXlleC5oYXNPd25Qcm9wZXJ0eSggJ2hvc3RlZFZpZXcnICkgKSB7XG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Ygd2luZG93LnBheWV4Lmhvc3RlZFZpZXcucGF5bWVudE1lbnUgIT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5wYXltZW50TWVudSgpLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJCggJyNwYXltZW50LXN3ZWRiYW5rLXBheS1jaGVja291dCBpZnJhbWUnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgLy9kZWxldGUgd2luZG93LnBheWV4Lmhvc3RlZFZpZXc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERlc3Ryb3kgSlNcbiAgICAgICAgICAgICQoIFwic2NyaXB0W3NyYyo9J3B4LnBheW1lbnRtZW51LmNsaWVudCddXCIgKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgLy8gTG9hZCBKU1xuICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvYWRKcyggdXJsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJCggJyNwYXltZW50LXN3ZWRiYW5rLXBheS1jaGVja291dCBpZnJhbWUnICkucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBMb2FkIFN3ZWRCYW5rIFBheSBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgICAgIGlmICggd2Nfc2JfY29tbW9uLmlzSW5zdGFudENoZWNrb3V0KCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIHRoZSBwYXltZW50IG1lbnUgaW4gXCJJbnN0YW50IENoZWNrb3V0XCJcbiAgICAgICAgICAgICAgICAgICAgJCggJyNwYXltZW50JyApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCAncGF5bWVudC1zd2VkYmFuay1wYXktY2hlY2tvdXQnICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5pdGlhdGUgdGhlIHBheW1lbnQgbWVudSBpbiB0aGUgZnJhbWVcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdub24taW5zdGFudCBjaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgJC5mZWF0aGVybGlnaHQoICc8ZGl2IGlkPVwic3dlZGJhbmstcGF5LXBheW1lbnRtZW51XCI+Jm5ic3A7PC9kaXY+Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudDogJ2ZlYXRoZXJsaWdodC1zd2VkYmFuay1wYXknLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25DbGljazogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uRXNjOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRQYXltZW50TWVudSggJ3N3ZWRiYW5rLXBheS1wYXltZW50bWVudScgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhZnRlckNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICkudW5ibG9jaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKVxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWF0ZSBQYXltZW50IE1lbnUuXG4gICAgICAgICAqIFBheW1lbnQgSmF2YXNjcmlwdCBtdXN0IGJlIGxvYWRlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIGlkXG4gICAgICAgICAqIEBwYXJhbSBjYWxsYmFja1xuICAgICAgICAgKi9cbiAgICAgICAgaW5pdFBheW1lbnRNZW51OiBmdW5jdGlvbiAoIGlkLCBjYWxsYmFjayApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnaW5pdFBheW1lbnRNZW51JyApO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjYWxsYmFjayA9PT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hZCBTd2VkQmFuayBQYXkgQ2hlY2tvdXQgZnJhbWVcbiAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUgPSB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5wYXltZW50TWVudSgge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogaWQsXG4gICAgICAgICAgICAgICAgY3VsdHVyZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQuY3VsdHVyZSxcbiAgICAgICAgICAgICAgICBzdHlsZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQucGF5bWVudE1lbnVTdHlsZSA/IEpTT04ucGFyc2UoIFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LnBheW1lbnRNZW51U3R5bGUgKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgb25BcHBsaWNhdGlvbkNvbmZpZ3VyZWQ6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uQXBwbGljYXRpb25Db25maWd1cmVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pc1BheW1lbnRNZW51TG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soIG51bGwgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5vblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkKCBkYXRhLm5hbWUsIGRhdGEuaW5zdHJ1bWVudCApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50Q3JlYXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENyZWF0ZWQnICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDb21wbGV0ZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRDb21wbGV0ZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb24uaHJlZiA9IGRhdGEucmVkaXJlY3RVcmw7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDYW5jZWxlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENhbmNlbGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdwYXltZW50LW1lbnUtY2FuY2VsJywgZGF0YSApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50RmFpbGVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50RmFpbGVkJyApO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdwYXltZW50LW1lbnUtZmFpbGVkJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICAvL3NlbGYubG9jYXRpb24uaHJlZiA9IGRhdGEucmVkaXJlY3RVcmw7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3BheW1lbnQtbWVudS1lcnJvcicsIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soIGRhdGEgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUub3BlbigpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWZyZXNoXG4gICAgICAgICAqL1xuICAgICAgICByZWZyZXNoUGF5bWVudE1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdyZWZyZXNoUGF5bWVudE1lbnUnICk7XG4gICAgICAgICAgICBpZiAoIHR5cGVvZiB0aGlzLnBheW1lbnRNZW51ICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnBheW1lbnRNZW51Lmhhc093blByb3BlcnR5KCAncmVmcmVzaCcgKSAmJlxuICAgICAgICAgICAgICAgIHR5cGVvZiB0aGlzLnBheW1lbnRNZW51LnJlZnJlc2ggPT09ICdmdW5jdGlvbicgKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUucmVmcmVzaCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oICdyZWZyZXNoUGF5bWVudE1lbnU6IHJlZnJlc2ggd29ya2Fyb3VuZCcgKTtcbiAgICAgICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0LmluaXRQYXltZW50SlMoIHdjX3NiX2NoZWNrb3V0LmpzX3VybCApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBsYWNlIE9yZGVyXG4gICAgICAgICAqIEByZXR1cm4ge0pRdWVyeVByb21pc2U8YW55Pn1cbiAgICAgICAgICovXG4gICAgICAgIHBsYWNlT3JkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAncGxhY2VPcmRlcicgKTtcbiAgICAgICAgICAgIGxldCBmaWVsZHMgPSAkKCcud29vY29tbWVyY2UtY2hlY2tvdXQnKS5zZXJpYWxpemUoKTtcblxuICAgICAgICAgICAgcmV0dXJuICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc3dlZGJhbmtfcGF5X3BsYWNlX29yZGVyJyxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0Lm5vbmNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBmaWVsZHNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH0gKS5kb25lKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVsb2FkJykgJiYgdHJ1ZSA9PT0gcmVzcG9uc2UucmVsb2FkICkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgIFx0XHR9XG5cbiAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZXN1bHQnKSAmJiByZXNwb25zZS5yZXN1bHQgPT09ICdmYWlsdXJlJyApIHtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAnc2ItcGxhY2Utb3JkZXInLCByZXNwb25zZSApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5vbkVycm9yKCByZXNwb25zZS5tZXNzYWdlcyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlIE9yZGVyXG4gICAgICAgICAqIEBwYXJhbSBjb21wYXRpYmlsaXR5XG4gICAgICAgICAqIEByZXR1cm4ge0pRdWVyeVByb21pc2U8YW55Pn1cbiAgICAgICAgICovXG4gICAgICAgIHVwZGF0ZU9yZGVyOiBmdW5jdGlvbiAoIGNvbXBhdGliaWxpdHkgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3VwZGF0ZU9yZGVyJyApO1xuICAgICAgICAgICAgbGV0IGZpZWxkcyA9ICQoJy53b29jb21tZXJjZS1jaGVja291dCcpLnNlcmlhbGl6ZSgpO1xuXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiBjb21wYXRpYmlsaXR5ID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICBjb21wYXRpYmlsaXR5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZpZWxkcyArPSAnJmNvbXBhdGliaWxpdHk9JyArIGNvbXBhdGliaWxpdHk7XG5cbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0uYWRkQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmJsb2NrKCk7XG5cbiAgICAgICAgICAgIGlmICggd2Nfc2JfY2hlY2tvdXQueGhyICkge1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0Lnhoci5hYm9ydCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC54aHIgPSAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5hamF4X3VybCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3N3ZWRiYW5rX3BheV91cGRhdGVfb3JkZXInLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZpZWxkc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmFsd2F5cyggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQueGhyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24udW5ibG9jaygpO1xuICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgIC5mYWlsKCBmdW5jdGlvbigganFYSFIsIHRleHRTdGF0dXMgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAndXBkYXRlT3JkZXIgZXJyb3I6JyArIHRleHRTdGF0dXMgKTtcbiAgICAgICAgICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVzdWx0JykgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnc3VjY2VzcycgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWZyZXNoIFBheW1lbnQgTWVudVxuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuanNfdXJsID0gcmVzcG9uc2VbJ2pzX3VybCddO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQucmVmcmVzaFBheW1lbnRNZW51KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3VsdCcpICYmIHJlc3BvbnNlLnJlc3VsdCA9PT0gJ2ZhaWx1cmUnICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2VzID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggJ0Vycm9yIG1lc3NhZ2UgaXMgZW1wdHkuJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3dlZEJhbmsgUGF5bWVudCByZXR1cm5zIGVycm9yIHRoYXQgT3JkZXIgdXBkYXRlIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UubWVzc2FnZXMuaW5kZXhPZiggJ09yZGVyIHVwZGF0ZSBpcyBub3QgYXZhaWxhYmxlLicgKSA+IC0xICYmICEgY29tcGF0aWJpbGl0eSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JjZSByZWxvYWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oICdyZWZyZXNoUGF5bWVudE1lbnU6IHJlZnJlc2ggd29ya2Fyb3VuZC4gRm9yY2UgcmVsb2FkLicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC51cGRhdGVPcmRlciggdHJ1ZSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ2pzX3VybCcpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggcmVzcG9uc2UuanNfdXJsICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZWxvYWQgcGFnZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZWxvYWQnKSAmJiB0cnVlID09PSByZXNwb25zZS5yZWxvYWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXIgdXBkYXRlIGluIGNhc2Ugd2UgbmVlZCBhIGZyZXNoIG5vbmNlXG4gICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlZnJlc2ggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ3VwZGF0ZV9jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3NiLXVwZGF0ZS1vcmRlcicsIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gIHdjX3NiX2NoZWNrb3V0LnhocjtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT24gUGF5bWVudCBNZW51IEluc3RydW1lbnQgU2VsZWN0ZWRcbiAgICAgICAgICogQHBhcmFtIG5hbWVcbiAgICAgICAgICogQHBhcmFtIGluc3RydW1lbnRcbiAgICAgICAgICovXG4gICAgICAgIG9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQ6IGZ1bmN0aW9uICggbmFtZSwgaW5zdHJ1bWVudCApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZCcsIG5hbWUsIGluc3RydW1lbnQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAnc2JfcGF5bWVudF9tZW51X2luc3RydW1lbnRfc2VsZWN0ZWQnLCBbbmFtZSwgaW5zdHJ1bWVudF0gKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25FcnJvcjogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvbkVycm9yJywgZGF0YSApO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuc3VibWl0X2Vycm9yKCAnPGRpdiBjbGFzcz1cIndvb2NvbW1lcmNlLWVycm9yXCI+JyArIGRhdGEgKyAnPC9kaXY+JyApO1xuICAgICAgICB9LFxuICAgICAgICBzdWJtaXRfZXJyb3I6IGZ1bmN0aW9uKCBlcnJvcl9tZXNzYWdlICkge1xuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0ucHJlcGVuZCggJzxkaXYgY2xhc3M9XCJ3b29jb21tZXJjZS1Ob3RpY2VHcm91cCB3b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dFwiPicgKyBlcnJvcl9tZXNzYWdlICsgJzwvZGl2PicgKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0ucmVtb3ZlQ2xhc3MoICdwcm9jZXNzaW5nJyApLnVuYmxvY2soKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmZvcm0uZmluZCggJy5pbnB1dC10ZXh0LCBzZWxlY3QsIGlucHV0OmNoZWNrYm94JyApLnRyaWdnZXIoICd2YWxpZGF0ZScgKS5ibHVyKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5zY3JvbGxfdG9fbm90aWNlcygpO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICdjaGVja291dF9lcnJvcicgKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2Nyb2xsX3RvX25vdGljZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IHNjcm9sbEVsZW1lbnQgPSAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLXVwZGF0ZU9yZGVyUmV2aWV3LCAud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQnICk7XG4gICAgICAgICAgICBpZiAoICEgc2Nyb2xsRWxlbWVudC5sZW5ndGggKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsRWxlbWVudCA9ICQoICcuZm9ybS5jaGVja291dCcgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5zY3JvbGxfdG9fbm90aWNlcyggc2Nyb2xsRWxlbWVudCApO1xuICAgICAgICB9LFxuICAgIH07XG5cbiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkge1xuICAgICAgICB3Y19zYl9jaGVja291dC5pbml0KCAkKCBcImZvcm0uY2hlY2tvdXQsIGZvcm0jb3JkZXJfcmV2aWV3LCBmb3JtI2FkZF9wYXltZW50X21ldGhvZFwiICkgKTtcbiAgICB9ICk7XG59KTtcblxuIl19
