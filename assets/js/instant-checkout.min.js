jQuery(function(o){"use strict";window.wc_sb_checkout={js_url:null,paymentMenu:null,isPaymentMenuLoaded:!1,xhr:!1,init:function(e){this.form=e,this.form_submit=!1,o(this.form).on("click","#place_order",{obj:window.wc_sb_checkout},this.onSubmit).on("submit checkout_place_order_payex_checkout"),o(document.body).bind("update_checkout",this.onUpdateCheckout),o(document.body).on("checkout_error",this.resetCheckout),o(document.body).on("updated_checkout",this.onUpdatedCheckout),o(document.body).on("blur",this.onUpdatedCheckout),wc_sb_common.isInstantCheckout()&&wc_sb_checkout.initInstantCheckout()},initInstantCheckout:function(){if(console.log("Initialization of Instant Checkout..."),wc_sb_common.isCheckinEnabled(),wc_sb_common.isCheckinEnabled()){let e=o("#swedbank-pay-consumer-profile");if(e.length>0){let o=e.data("reference");console.log("Initiate consumerProfileRef",o)}}},initCheckout:function(e){o("#change-shipping-info").show(),wc_sb_checkout.form.find(".swedbank_pay_customer_reference").remove(),wc_sb_checkout.form.append("<input type='hidden' class='swedbank_pay_customer_reference' name='swedbank_pay_customer_reference' value='"+e+"'/>"),wc_sb_checkout.onSubmit()},isPaymentMethodChosen:function(){return o("#payment_method_payex_checkout").is(":checked")},onClose:function(){wc_sb_common.unblock()},onReady:function(){console.log("Ready")},onUpdateCheckout:function(){if(console.log("onUpdateCheckout"),!wc_sb_common.isInstantCheckout())return!1},onUpdatedCheckout:function(){return console.log("onUpdatedCheckout"),!!wc_sb_common.isInstantCheckout()&&(!wc_sb_checkout.form.is(".processing")&&(wc_sb_common.validateForm()?(o(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),void wc_sb_checkout.updateOrder()):(console.log("onUpdatedCheckout: Validation is failed"),!1)))},onSubmit:function(n){var t=n.data.obj;let c=o("#terms");return c.length>0&&!c.prop("checked")?(t.submit_error('<div class="woocommerce-error">'+WC_Gateway_Swedbank_Pay_Checkout.terms_error+"</div>"),!1):!!t.form_submit||(!t.isPaymentMethodChosen()||("undefined"!=typeof e&&e.preventDefault(),!!wc_sb_common.validateForm()&&(console.log("onSubmit"),!t.form.is(".processing")&&(o(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),t.form.addClass("processing"),wc_sb_common.block(),t.placeOrder().always(function(e){t.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){t.onError(o)}).done(function(e){if(console.log(e),"success"!==e.result)return e.hasOwnProperty("reload")&&!0===e.reload?void window.location.reload():(!0===e.result.refresh&&o(document.body).trigger("update_checkout"),void t.onError(e.messages));wc_sb_common.isRedirectMethodEnabled()?(console.log("Redirecting to "+e.redirect_url),window.location.href=e.redirect_url):(t.js_url=e.js_url,t.initPaymentJS(t.js_url))}),!1))))},resetCheckout:function(){wc_sb_checkout.form_submit=!1},initPaymentJS:function(e,n){void 0===n&&(n=function(){}),window.hasOwnProperty("payex")&&window.payex.hasOwnProperty("hostedView")&&(void 0!==window.payex.hostedView.paymentMenu&&window.payex.hostedView.paymentMenu().close(),o("#payment-swedbank-pay-checkout iframe").remove()),o("script[src*='px.paymentmenu.client']").remove(),wc_sb_common.loadJs(e,function(){o("#payment-swedbank-pay-checkout iframe").remove(),wc_sb_common.isInstantCheckout()?(o("#payment").hide(),wc_sb_checkout.initPaymentMenu("payment-swedbank-pay-checkout")):(console.log("non-instant checkout"),o.featherlight('<div id="swedbank-pay-paymentmenu">&nbsp;</div>',{variant:"featherlight-swedbank-pay",persist:!0,closeOnClick:!1,closeOnEsc:!1,afterOpen:function(){wc_sb_checkout.initPaymentMenu("swedbank-pay-paymentmenu")},afterClose:function(){wc_sb_checkout.form.removeClass("processing").unblock()}})),n()})},initPaymentMenu:function(e,o){console.log("initPaymentMenu"),void 0===o&&(o=function(){}),this.paymentMenu=window.payex.hostedView.paymentMenu({container:e,culture:WC_Gateway_Swedbank_Pay_Checkout.culture,style:WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle?JSON.parse(WC_Gateway_Swedbank_Pay_Checkout.paymentMenuStyle):null,onApplicationConfigured:function(e){console.log("onApplicationConfigured"),console.log(e),wc_sb_checkout.isPaymentMenuLoaded=!0,o(null)},onPaymentMenuInstrumentSelected:function(e){console.log("onPaymentMenuInstrumentSelected"),console.log(e),wc_sb_checkout.onPaymentMenuInstrumentSelected(e.name,e.instrument)},onPaymentCreated:function(){console.log("onPaymentCreated")},onPaymentCompleted:function(e){console.log("onPaymentCompleted"),console.log(e),self.location.href=e.redirectUrl},onPaymentCanceled:function(e){console.log("onPaymentCanceled"),console.log(e),wc_sb_common.logError("payment-menu-cancel",e)},onPaymentFailed:function(e){console.log("onPaymentFailed"),console.log(e),wc_sb_common.logError("payment-menu-failed",e)},onError:function(e){wc_sb_common.logError("payment-menu-error",e),o(e)}}),this.paymentMenu.open()},refreshPaymentMenu:function(){console.log("refreshPaymentMenu"),void 0!==this.paymentMenu&&this.paymentMenu&&this.paymentMenu.hasOwnProperty("refresh")&&"function"==typeof this.paymentMenu.refresh?this.paymentMenu.refresh():console.warn("refreshPaymentMenu: refresh workaround")},placeOrder:function(){console.log("placeOrder");let e=o(".woocommerce-checkout").serialize();return o.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_place_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:e},dataType:"json"}).done(function(e){e.hasOwnProperty("reload")&&!0===e.reload?window.location.reload():e.hasOwnProperty("result")&&"failure"===e.result&&(wc_sb_common.logError("sb-place-order",e),wc_sb_checkout.onError(e.messages))})},updateOrder:function(e){console.log("updateOrder");let n=o(".woocommerce-checkout").serialize();return void 0===e&&(e=!1),n+="&compatibility="+e,wc_sb_checkout.form.addClass("processing"),wc_sb_common.block(),wc_sb_checkout.xhr&&wc_sb_checkout.xhr.abort(),wc_sb_checkout.xhr=o.ajax({type:"POST",url:WC_Gateway_Swedbank_Pay_Checkout.ajax_url,data:{action:"swedbank_pay_update_order",nonce:WC_Gateway_Swedbank_Pay_Checkout.nonce,data:n},dataType:"json"}).always(function(e){wc_sb_checkout.xhr=!1,wc_sb_checkout.form.removeClass("processing"),wc_sb_common.unblock()}).fail(function(e,o){console.log("updateOrder error:"+o)}).done(function(n){if(console.log(n),n.hasOwnProperty("result")&&"success"===n.result)return wc_sb_checkout.js_url=n.js_url,void wc_sb_checkout.refreshPaymentMenu();if(n.hasOwnProperty("result")&&"failure"===n.result){if(""===n.messages)return void console.warn("Error message is empty.");if(n.messages.indexOf("Order update is not available.")>-1&&!e)return console.warn("refreshPaymentMenu: refresh workaround. Force reload."),void wc_sb_checkout.updateOrder(!0).done(function(e){e.hasOwnProperty("js_url")&&wc_sb_checkout.initPaymentJS(e.js_url)})}n.hasOwnProperty("reload")&&!0===n.reload?window.location.reload():(!0===n.result.refresh&&o(document.body).trigger("update_checkout"),wc_sb_common.logError("sb-update-order",n))}),wc_sb_checkout.xhr},onPaymentMenuInstrumentSelected:function(e,n){console.log("onPaymentMenuInstrumentSelected",e,n),o(document.body).trigger("sb_payment_menu_instrument_selected",[e,n])},onError:function(e){console.log("onError",e),wc_sb_checkout.submit_error('<div class="woocommerce-error">'+e+"</div>")},submit_error:function(e){o(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),wc_sb_checkout.form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),wc_sb_checkout.form.removeClass("processing").unblock(),wc_sb_checkout.form.find(".input-text, select, input:checkbox").trigger("validate").blur(),wc_sb_checkout.scroll_to_notices(),o(document.body).trigger("checkout_error")},scroll_to_notices:function(){let e=o(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=o(".form.checkout")),o.scroll_to_notices(e)}},o(document).ready(function(){wc_sb_checkout.init(o("form.checkout, form#order_review, form#add_payment_method"))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbnQtY2hlY2tvdXQuanMiXSwibmFtZXMiOlsialF1ZXJ5IiwiJCIsIndpbmRvdyIsIndjX3NiX2NoZWNrb3V0IiwianNfdXJsIiwicGF5bWVudE1lbnUiLCJpc1BheW1lbnRNZW51TG9hZGVkIiwieGhyIiwiaW5pdCIsImZvcm0iLCJ0aGlzIiwiZm9ybV9zdWJtaXQiLCJvbiIsIm9iaiIsIm9uU3VibWl0IiwiZG9jdW1lbnQiLCJib2R5IiwiYmluZCIsIm9uVXBkYXRlQ2hlY2tvdXQiLCJyZXNldENoZWNrb3V0Iiwib25VcGRhdGVkQ2hlY2tvdXQiLCJ3Y19zYl9jb21tb24iLCJpc0luc3RhbnRDaGVja291dCIsImluaXRJbnN0YW50Q2hlY2tvdXQiLCJjb25zb2xlIiwibG9nIiwiaXNDaGVja2luRW5hYmxlZCIsImNvbnN1bWVyUHJvZmlsZUVsbSIsImxlbmd0aCIsInJlZmVyZW5jZSIsImRhdGEiLCJpbml0Q2hlY2tvdXQiLCJzaG93IiwiZmluZCIsInJlbW92ZSIsImFwcGVuZCIsImlzUGF5bWVudE1ldGhvZENob3NlbiIsImlzIiwib25DbG9zZSIsInVuYmxvY2siLCJvblJlYWR5IiwidmFsaWRhdGVGb3JtIiwidXBkYXRlT3JkZXIiLCJldmVudCIsInNlbGYiLCJ0ZXJtcyIsInByb3AiLCJzdWJtaXRfZXJyb3IiLCJXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dCIsInRlcm1zX2Vycm9yIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCJibG9jayIsInBsYWNlT3JkZXIiLCJhbHdheXMiLCJyZXNwb25zZSIsInJlbW92ZUNsYXNzIiwiZmFpbCIsImpxWEhSIiwidGV4dFN0YXR1cyIsIm9uRXJyb3IiLCJkb25lIiwicmVzdWx0IiwiaGFzT3duUHJvcGVydHkiLCJyZWxvYWQiLCJsb2NhdGlvbiIsInJlZnJlc2giLCJ0cmlnZ2VyIiwibWVzc2FnZXMiLCJpc1JlZGlyZWN0TWV0aG9kRW5hYmxlZCIsImhyZWYiLCJpbml0UGF5bWVudEpTIiwidXJsIiwiY2FsbGJhY2siLCJwYXlleCIsImhvc3RlZFZpZXciLCJjbG9zZSIsImxvYWRKcyIsImhpZGUiLCJpbml0UGF5bWVudE1lbnUiLCJmZWF0aGVybGlnaHQiLCJ2YXJpYW50IiwicGVyc2lzdCIsImNsb3NlT25DbGljayIsImNsb3NlT25Fc2MiLCJhZnRlck9wZW4iLCJhZnRlckNsb3NlIiwiaWQiLCJjb250YWluZXIiLCJjdWx0dXJlIiwic3R5bGUiLCJwYXltZW50TWVudVN0eWxlIiwiSlNPTiIsInBhcnNlIiwib25BcHBsaWNhdGlvbkNvbmZpZ3VyZWQiLCJvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkIiwibmFtZSIsImluc3RydW1lbnQiLCJvblBheW1lbnRDcmVhdGVkIiwib25QYXltZW50Q29tcGxldGVkIiwicmVkaXJlY3RVcmwiLCJvblBheW1lbnRDYW5jZWxlZCIsImxvZ0Vycm9yIiwib25QYXltZW50RmFpbGVkIiwib3BlbiIsInJlZnJlc2hQYXltZW50TWVudSIsIndhcm4iLCJmaWVsZHMiLCJzZXJpYWxpemUiLCJhamF4IiwidHlwZSIsImFqYXhfdXJsIiwiYWN0aW9uIiwibm9uY2UiLCJkYXRhVHlwZSIsImNvbXBhdGliaWxpdHkiLCJhYm9ydCIsImluZGV4T2YiLCJlcnJvcl9tZXNzYWdlIiwicHJlcGVuZCIsImJsdXIiLCJzY3JvbGxfdG9fbm90aWNlcyIsInNjcm9sbEVsZW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0FBLE9BQVEsU0FBVUMsR0FDZCxhQUtBQyxPQUFPQyxlQUFpQixDQUNwQkMsT0FBUSxLQUNSQyxZQUFhLEtBQ2JDLHFCQUFxQixFQUNyQkMsS0FBSyxFQUtMQyxLQUFNLFNBQVVDLEdBQ1pDLEtBQUtELEtBQWVBLEVBQ3BCQyxLQUFLQyxhQUFlLEVBRXBCVixFQUFHUyxLQUFLRCxNQUdIRyxHQUFJLFFBQVMsZUFBZ0IsQ0FBQ0MsSUFBT1gsT0FBT0MsZ0JBQWlCTyxLQUFLSSxVQUdsRUYsR0FBSSw4Q0FFVFgsRUFBR2MsU0FBU0MsTUFBT0MsS0FBTSxrQkFBbUJQLEtBQUtRLGtCQUNqRGpCLEVBQUdjLFNBQVNDLE1BQU9KLEdBQUksaUJBQWtCRixLQUFLUyxlQUM5Q2xCLEVBQUdjLFNBQVNDLE1BQU9KLEdBQUksbUJBQW9CRixLQUFLVSxtQkFDaERuQixFQUFHYyxTQUFTQyxNQUFPSixHQUFJLE9BQVFGLEtBQUtVLG1CQUcvQkMsYUFBYUMscUJBQ2RuQixlQUFlb0IsdUJBT3ZCQSxvQkFBcUIsV0FTakIsR0FSQUMsUUFBUUMsSUFBSyx5Q0FFUkosYUFBYUssbUJBTWJMLGFBQWFLLG1CQUFxQixDQUluQyxJQUFJQyxFQUFxQjFCLEVBQUcsa0NBQzVCLEdBQUswQixFQUFtQkMsT0FBUyxFQUFJLENBQ2pDLElBQUlDLEVBQVlGLEVBQW1CRyxLQUFNLGFBQ3pDTixRQUFRQyxJQUFLLDhCQUErQkksTUFVeERFLGFBQWMsU0FBVUYsR0FFcEI1QixFQUFHLHlCQUEwQitCLE9BRTdCN0IsZUFBZU0sS0FBS3dCLEtBQU0sb0NBQXFDQyxTQUMvRC9CLGVBQWVNLEtBQUswQixPQUFRLDhHQUFnSE4sRUFBWSxPQUd4SjFCLGVBQWVXLFlBR25Cc0Isc0JBQXVCLFdBQ25CLE9BQU9uQyxFQUFHLGtDQUFtQ29DLEdBQUksYUFHckRDLFFBQVMsV0FDTGpCLGFBQWFrQixXQUdqQkMsUUFBUyxXQUNMaEIsUUFBUUMsSUFBSyxVQUdqQlAsaUJBQWtCLFdBR2QsR0FGQU0sUUFBUUMsSUFBSyxxQkFFTkosYUFBYUMsb0JBQ2hCLE9BQU8sR0FNZkYsa0JBQW1CLFdBR2YsT0FGQUksUUFBUUMsSUFBSyx1QkFFTkosYUFBYUMsdUJBSWZuQixlQUFlTSxLQUFLNEIsR0FBSSxpQkFJdEJoQixhQUFhb0IsZ0JBS3BCeEMsRUFBRywrRUFBZ0ZpQyxjQUNuRi9CLGVBQWV1QyxnQkFMWGxCLFFBQVFDLElBQUssNENBQ04sTUFPZlgsU0FBVSxTQUFVNkIsR0FDaEIsSUFBSUMsRUFBT0QsRUFBTWIsS0FBS2pCLElBQ3RCLElBQUlnQyxFQUFRNUMsRUFBRyxVQUdmLE9BQUs0QyxFQUFNakIsT0FBUyxJQUFPaUIsRUFBTUMsS0FBTSxZQUNuQ0YsRUFBS0csYUFBYyxrQ0FBb0NDLGlDQUFpQ0MsWUFBYyxXQUMvRixLQUdOTCxFQUFLakMsZUFJTGlDLEVBQUtSLDBCQUNZLG9CQUFOYyxHQUNSQSxFQUFFQyxtQkFHQzlCLGFBQWFvQixpQkFJcEJqQixRQUFRQyxJQUFLLGFBRVJtQixFQUFLbkMsS0FBSzRCLEdBQUksaUJBSW5CcEMsRUFBRywrRUFBZ0ZpQyxTQUNuRlUsRUFBS25DLEtBQUsyQyxTQUFVLGNBQ3BCL0IsYUFBYWdDLFFBQ2JULEVBQUtVLGFBQ0FDLE9BQVEsU0FBV0MsR0FDaEJaLEVBQUtuQyxLQUFLZ0QsWUFBYSxjQUN2QnBDLGFBQWFrQixZQUVoQm1CLEtBQU0sU0FBVUMsRUFBT0MsR0FDcEJoQixFQUFLaUIsUUFBU0QsS0FFakJFLEtBQU0sU0FBV04sR0FFZCxHQURBaEMsUUFBUUMsSUFBSytCLEdBQ1ksWUFBcEJBLEVBQVNPLE9BRVYsT0FBS1AsRUFBU1EsZUFBZSxZQUFhLElBQVNSLEVBQVNTLFlBQ3hEL0QsT0FBT2dFLFNBQVNELFdBS2YsSUFBU1QsRUFBU08sT0FBT0ksU0FDMUJsRSxFQUFHYyxTQUFTQyxNQUFPb0QsUUFBUyx3QkFHaEN4QixFQUFLaUIsUUFBU0wsRUFBU2EsV0FJdEJoRCxhQUFhaUQsMkJBRWQ5QyxRQUFRQyxJQUFLLGtCQUFvQitCLEVBQXVCLGNBQ3hEdEQsT0FBT2dFLFNBQVNLLEtBQU9mLEVBQXVCLGVBRzlDWixFQUFLeEMsT0FBU29ELEVBQWlCLE9BQy9CWixFQUFLNEIsY0FBZTVCLEVBQUt4QyxZQUk5QixPQU1mZSxjQUFlLFdBQ1hoQixlQUFlUSxhQUFjLEdBVWpDNkQsY0FBZSxTQUFXQyxFQUFLQyxRQUNGLElBQWJBLElBQ1JBLEVBQVcsY0FJVnhFLE9BQU84RCxlQUFnQixVQUFhOUQsT0FBT3lFLE1BQU1YLGVBQWdCLHFCQUNkLElBQXhDOUQsT0FBT3lFLE1BQU1DLFdBQVd2RSxhQUNoQ0gsT0FBT3lFLE1BQU1DLFdBQVd2RSxjQUFjd0UsUUFHMUM1RSxFQUFHLHlDQUEwQ2lDLFVBS2pEakMsRUFBRyx3Q0FBeUNpQyxTQUc1Q2IsYUFBYXlELE9BQVFMLEVBQUssV0FDdEJ4RSxFQUFHLHlDQUEwQ2lDLFNBR3hDYixhQUFhQyxxQkFFZHJCLEVBQUcsWUFBYThFLE9BQ2hCNUUsZUFBZTZFLGdCQUFpQixtQ0FHaEN4RCxRQUFRQyxJQUFLLHdCQUNieEIsRUFBRWdGLGFBQWMsa0RBQW1ELENBQy9EQyxRQUFTLDRCQUNUQyxTQUFTLEVBQ1RDLGNBQWMsRUFDZEMsWUFBWSxFQUNaQyxVQUFXLFdBQ1BuRixlQUFlNkUsZ0JBQWlCLDZCQUVwQ08sV0FBWSxXQUNScEYsZUFBZU0sS0FBS2dELFlBQWEsY0FBZWxCLGNBSzVEbUMsT0FXUk0sZ0JBQWlCLFNBQVdRLEVBQUlkLEdBQzVCbEQsUUFBUUMsSUFBSyx3QkFFWSxJQUFiaUQsSUFDUkEsRUFBVyxjQUlmaEUsS0FBS0wsWUFBY0gsT0FBT3lFLE1BQU1DLFdBQVd2RSxZQUFhLENBQ3BEb0YsVUFBV0QsRUFDWEUsUUFBUzFDLGlDQUFpQzBDLFFBQzFDQyxNQUFPM0MsaUNBQWlDNEMsaUJBQW1CQyxLQUFLQyxNQUFPOUMsaUNBQWlDNEMsa0JBQXFCLEtBQzdIRyx3QkFBeUIsU0FBVWpFLEdBQy9CTixRQUFRQyxJQUFLLDJCQUNiRCxRQUFRQyxJQUFLSyxHQUNiM0IsZUFBZUcscUJBQXNCLEVBQ3JDb0UsRUFBVSxPQUVkc0IsZ0NBQWlDLFNBQVdsRSxHQUN4Q04sUUFBUUMsSUFBSyxtQ0FDYkQsUUFBUUMsSUFBS0ssR0FDYjNCLGVBQWU2RixnQ0FBaUNsRSxFQUFLbUUsS0FBTW5FLEVBQUtvRSxhQUVwRUMsaUJBQWtCLFdBQ2QzRSxRQUFRQyxJQUFLLHFCQUVqQjJFLG1CQUFvQixTQUFXdEUsR0FDM0JOLFFBQVFDLElBQUssc0JBQ2JELFFBQVFDLElBQUtLLEdBQ2JjLEtBQUtzQixTQUFTSyxLQUFPekMsRUFBS3VFLGFBRTlCQyxrQkFBbUIsU0FBV3hFLEdBQzFCTixRQUFRQyxJQUFLLHFCQUNiRCxRQUFRQyxJQUFLSyxHQUNiVCxhQUFha0YsU0FBVSxzQkFBdUJ6RSxJQUVsRDBFLGdCQUFpQixTQUFXMUUsR0FDeEJOLFFBQVFDLElBQUssbUJBQ2JELFFBQVFDLElBQUtLLEdBQ2JULGFBQWFrRixTQUFVLHNCQUF1QnpFLElBR2xEK0IsUUFBUyxTQUFXL0IsR0FDaEJULGFBQWFrRixTQUFVLHFCQUFzQnpFLEdBQzdDNEMsRUFBVTVDLE1BSWxCcEIsS0FBS0wsWUFBWW9HLFFBTXJCQyxtQkFBb0IsV0FDaEJsRixRQUFRQyxJQUFLLDJCQUNvQixJQUFyQmYsS0FBS0wsYUFDYkssS0FBS0wsYUFDTEssS0FBS0wsWUFBWTJELGVBQWdCLFlBQ0csbUJBQTdCdEQsS0FBS0wsWUFBWThELFFBRXhCekQsS0FBS0wsWUFBWThELFVBRWpCM0MsUUFBUW1GLEtBQU0sMkNBU3RCckQsV0FBWSxXQUNSOUIsUUFBUUMsSUFBSyxjQUNiLElBQUltRixFQUFTM0csRUFBRSx5QkFBeUI0RyxZQUV4QyxPQUFPNUcsRUFBRTZHLEtBQU0sQ0FDWEMsS0FBTSxPQUNOdEMsSUFBS3pCLGlDQUFpQ2dFLFNBQ3RDbEYsS0FBTSxDQUNGbUYsT0FBUSwyQkFDUkMsTUFBT2xFLGlDQUFpQ2tFLE1BQ3hDcEYsS0FBTThFLEdBRVZPLFNBQVUsU0FDVnJELEtBQU0sU0FBV04sR0FFWkEsRUFBU1EsZUFBZSxZQUFhLElBQVNSLEVBQVNTLE9BQ3hEL0QsT0FBT2dFLFNBQVNELFNBSWZULEVBQVNRLGVBQWUsV0FBaUMsWUFBcEJSLEVBQVNPLFNBQy9DMUMsYUFBYWtGLFNBQVUsaUJBQWtCL0MsR0FDekNyRCxlQUFlMEQsUUFBU0wsRUFBU2EsY0FVN0MzQixZQUFhLFNBQVcwRSxHQUNwQjVGLFFBQVFDLElBQUssZUFDYixJQUFJbUYsRUFBUzNHLEVBQUUseUJBQXlCNEcsWUFpRnBDLFlBL0UwQixJQUFsQk8sSUFDUkEsR0FBZ0IsR0FHcEJSLEdBQVUsa0JBQW9CUSxFQUU5QmpILGVBQWVNLEtBQUsyQyxTQUFVLGNBQzlCL0IsYUFBYWdDLFFBRVJsRCxlQUFlSSxLQUNoQkosZUFBZUksSUFBSThHLFFBR3ZCbEgsZUFBZUksSUFBTU4sRUFBRTZHLEtBQU0sQ0FDekJDLEtBQU0sT0FDTnRDLElBQUt6QixpQ0FBaUNnRSxTQUN0Q2xGLEtBQU0sQ0FDRm1GLE9BQVEsNEJBQ1JDLE1BQU9sRSxpQ0FBaUNrRSxNQUN4Q3BGLEtBQU04RSxHQUVWTyxTQUFVLFNBRVQ1RCxPQUFRLFNBQVdDLEdBQ2hCckQsZUFBZUksS0FBTSxFQUNyQkosZUFBZU0sS0FBS2dELFlBQWEsY0FDakNwQyxhQUFha0IsWUFFaEJtQixLQUFNLFNBQVVDLEVBQU9DLEdBQ3BCcEMsUUFBUUMsSUFBSyxxQkFBdUJtQyxLQUd2Q0UsS0FBTSxTQUFXTixHQUdkLEdBRkFoQyxRQUFRQyxJQUFLK0IsR0FFUkEsRUFBU1EsZUFBZSxXQUFpQyxZQUFwQlIsRUFBU08sT0FLL0MsT0FIQTVELGVBQWVDLE9BQVNvRCxFQUFpQixZQUN6Q3JELGVBQWV1RyxxQkFLbkIsR0FBS2xELEVBQVNRLGVBQWUsV0FBaUMsWUFBcEJSLEVBQVNPLE9BQXVCLENBQ3RFLEdBQTBCLEtBQXRCUCxFQUFTYSxTQUVULFlBREE3QyxRQUFRbUYsS0FBTSwyQkFLbEIsR0FBS25ELEVBQVNhLFNBQVNpRCxRQUFTLG1DQUFzQyxJQUFPRixFQVN6RSxPQVBBNUYsUUFBUW1GLEtBQU0sOERBQ2R4RyxlQUFldUMsYUFBYSxHQUFPb0IsS0FBTSxTQUFXTixHQUMzQ0EsRUFBU1EsZUFBZSxXQUN6QjdELGVBQWVxRSxjQUFlaEIsRUFBU3BELFVBU2xEb0QsRUFBU1EsZUFBZSxZQUFhLElBQVNSLEVBQVNTLE9BQ3hEL0QsT0FBT2dFLFNBQVNELFdBTWYsSUFBU1QsRUFBU08sT0FBT0ksU0FDMUJsRSxFQUFHYyxTQUFTQyxNQUFPb0QsUUFBUyxtQkFHaEMvQyxhQUFha0YsU0FBVSxrQkFBbUIvQyxNQUl0Q3JELGVBQWVJLEtBUS9CeUYsZ0NBQWlDLFNBQVdDLEVBQU1DLEdBQzlDMUUsUUFBUUMsSUFBSyxrQ0FBbUN3RSxFQUFNQyxHQUN0RGpHLEVBQUdjLFNBQVNDLE1BQU9vRCxRQUFTLHNDQUF1QyxDQUFDNkIsRUFBTUMsS0FFOUVyQyxRQUFTLFNBQVcvQixHQUNoQk4sUUFBUUMsSUFBSyxVQUFXSyxHQUN4QjNCLGVBQWU0QyxhQUFjLGtDQUFvQ2pCLEVBQU8sV0FFNUVpQixhQUFjLFNBQVV3RSxHQUNwQnRILEVBQUcsK0VBQWdGaUMsU0FDbkYvQixlQUFlTSxLQUFLK0csUUFBUyx5RUFBMkVELEVBQWdCLFVBQ3hIcEgsZUFBZU0sS0FBS2dELFlBQWEsY0FBZWxCLFVBQ2hEcEMsZUFBZU0sS0FBS3dCLEtBQU0sdUNBQXdDbUMsUUFBUyxZQUFhcUQsT0FDeEZ0SCxlQUFldUgsb0JBQ2Z6SCxFQUFHYyxTQUFTQyxNQUFPb0QsUUFBUyxtQkFFaENzRCxrQkFBbUIsV0FDZixJQUFJQyxFQUFnQjFILEVBQUcsaUZBQ2hCMEgsRUFBYy9GLFNBQ2pCK0YsRUFBZ0IxSCxFQUFHLG1CQUd2QkEsRUFBRXlILGtCQUFtQkMsS0FJN0IxSCxFQUFFYyxVQUFVNkcsTUFBTyxXQUNmekgsZUFBZUssS0FBTVAsRUFBRyIsImZpbGUiOiJpbnN0YW50LWNoZWNrb3V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCB3Y19jaGVja291dF9wYXJhbXMgKi9cbmpRdWVyeSggZnVuY3Rpb24oICQgKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLyoqXG4gICAgICogT2JqZWN0IHRvIGhhbmRsZSBTd2VkYmFuayBQYXkgY2hlY2tvdXQgcGF5bWVudCBmb3Jtcy5cbiAgICAgKi9cbiAgICB3aW5kb3cud2Nfc2JfY2hlY2tvdXQgPSB7XG4gICAgICAgIGpzX3VybDogbnVsbCxcbiAgICAgICAgcGF5bWVudE1lbnU6IG51bGwsXG4gICAgICAgIGlzUGF5bWVudE1lbnVMb2FkZWQ6IGZhbHNlLFxuICAgICAgICB4aHI6IGZhbHNlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIGUgaGFuZGxlcnMgYW5kIFVJIHN0YXRlLlxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oIGZvcm0gKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm0gICAgICAgICA9IGZvcm07XG4gICAgICAgICAgICB0aGlzLmZvcm1fc3VibWl0ICA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkKCB0aGlzLmZvcm0gKVxuICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBiaW5kIGRpcmVjdGx5IHRvIHRoZSBjbGljayAoYW5kIG5vdCBjaGVja291dF9wbGFjZV9vcmRlcl9wYXlleF9jaGVja291dCkgdG8gYXZvaWQgcG9wdXAgYmxvY2tlcnNcbiAgICAgICAgICAgIC8vIGVzcGVjaWFsbHkgb24gbW9iaWxlIGRldmljZXMgKGxpa2Ugb24gQ2hyb21lIGZvciBpT1MpIGZyb20gYmxvY2tpbmcgcGF5ZXhfY2hlY2tvdXQocGF5bWVudF9pZCwge30sICdvcGVuJyk7IGZyb20gb3BlbmluZyBhIHRhYlxuICAgICAgICAgICAgICAgIC5vbiggJ2NsaWNrJywgJyNwbGFjZV9vcmRlcicsIHsnb2JqJzogd2luZG93LndjX3NiX2NoZWNrb3V0fSwgdGhpcy5vblN1Ym1pdCApXG5cbiAgICAgICAgICAgICAgICAvLyBXb29Db21tZXJjZSBsZXRzIHVzIHJldHVybiBhIGZhbHNlIG9uIGNoZWNrb3V0X3BsYWNlX29yZGVyX3tnYXRld2F5fSB0byBrZWVwIHRoZSBmb3JtIGZyb20gc3VibWl0dGluZ1xuICAgICAgICAgICAgICAgIC5vbiggJ3N1Ym1pdCBjaGVja291dF9wbGFjZV9vcmRlcl9wYXlleF9jaGVja291dCcgKTtcblxuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLmJpbmQoICd1cGRhdGVfY2hlY2tvdXQnLCB0aGlzLm9uVXBkYXRlQ2hlY2tvdXQgKTtcbiAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS5vbiggJ2NoZWNrb3V0X2Vycm9yJywgdGhpcy5yZXNldENoZWNrb3V0ICk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkub24oICd1cGRhdGVkX2NoZWNrb3V0JywgdGhpcy5vblVwZGF0ZWRDaGVja291dCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLm9uKCAnYmx1cicsIHRoaXMub25VcGRhdGVkQ2hlY2tvdXQgKTtcblxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXRJbnN0YW50Q2hlY2tvdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6ZSBJbnN0YW50IENoZWNrb3V0XG4gICAgICAgICAqL1xuICAgICAgICBpbml0SW5zdGFudENoZWNrb3V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ0luaXRpYWxpemF0aW9uIG9mIEluc3RhbnQgQ2hlY2tvdXQuLi4nICk7XG5cbiAgICAgICAgICAgIGlmICggd2Nfc2JfY29tbW9uLmlzQ2hlY2tpbkVuYWJsZWQoKSApIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVja291dCB3aWxsIGJlIGxvYWRlZCBhZnRlciBjaGVja2luXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQuaW5pdENoZWNrb3V0KCBkYXRhLmNvbnN1bWVyUHJvZmlsZVJlZiApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHdjX3NiX2NvbW1vbi5pc0NoZWNraW5FbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgLy8vL3djX3NiX2NvbW1vbi5oaWRlQWRkcmVzc0ZpZWxkcygpO1xuXG4gICAgICAgICAgICAgICAgLy8gVXNlIHNhdmVkIGNvbnN1bWVyUHJvZmlsZVJlZlxuICAgICAgICAgICAgICAgIGxldCBjb25zdW1lclByb2ZpbGVFbG0gPSAkKCAnI3N3ZWRiYW5rLXBheS1jb25zdW1lci1wcm9maWxlJyApO1xuICAgICAgICAgICAgICAgIGlmICggY29uc3VtZXJQcm9maWxlRWxtLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZWZlcmVuY2UgPSBjb25zdW1lclByb2ZpbGVFbG0uZGF0YSggJ3JlZmVyZW5jZScgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdJbml0aWF0ZSBjb25zdW1lclByb2ZpbGVSZWYnLCByZWZlcmVuY2UgKTtcbiAgICAgICAgICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5pbml0Q2hlY2tvdXQoIHJlZmVyZW5jZSApO1xuICAgICAgICAgICAgICAgICAgICAvLy8vd2Nfc2JfY2hlY2tpbi5pbml0Q2hlY2tJbigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYXRlIGNoZWNraW5cbiAgICAgICAgICAgICAgICAgICAgLy8vL3djX3NiX2NoZWNraW4uaW5pdENoZWNrSW4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdENoZWNrb3V0OiBmdW5jdGlvbiggcmVmZXJlbmNlICkge1xuICAgICAgICAgICAgLy8gU2hvdyBcIkNoYW5nZSBzaGlwcGluZyBpbmZvXCIgYnV0dG9uXG4gICAgICAgICAgICAkKCAnI2NoYW5nZS1zaGlwcGluZy1pbmZvJyApLnNob3coKTtcblxuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5maW5kKCAnLnN3ZWRiYW5rX3BheV9jdXN0b21lcl9yZWZlcmVuY2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLmFwcGVuZCggXCI8aW5wdXQgdHlwZT0naGlkZGVuJyBjbGFzcz0nc3dlZGJhbmtfcGF5X2N1c3RvbWVyX3JlZmVyZW5jZScgbmFtZT0nc3dlZGJhbmtfcGF5X2N1c3RvbWVyX3JlZmVyZW5jZScgdmFsdWU9J1wiICsgcmVmZXJlbmNlICsgXCInLz5cIiApO1xuXG4gICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0LmZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5vblN1Ym1pdCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzUGF5bWVudE1ldGhvZENob3NlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJCggJyNwYXltZW50X21ldGhvZF9wYXlleF9jaGVja291dCcgKS5pcyggJzpjaGVja2VkJyApO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2Nfc2JfY29tbW9uLnVuYmxvY2soKTtcbiAgICAgICAgfSxcblxuICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnUmVhZHknICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25VcGRhdGVDaGVja291dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uVXBkYXRlQ2hlY2tvdXQnICk7XG5cbiAgICAgICAgICAgIGlmICggISB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEB0b2RvXG4gICAgICAgIH0sXG5cbiAgICAgICAgb25VcGRhdGVkQ2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblVwZGF0ZWRDaGVja291dCcgKTtcblxuICAgICAgICAgICAgaWYgKCAhIHdjX3NiX2NvbW1vbi5pc0luc3RhbnRDaGVja291dCgpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC5mb3JtLmlzKCAnLnByb2Nlc3NpbmcnICkgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICEgd2Nfc2JfY29tbW9uLnZhbGlkYXRlRm9ybSgpICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25VcGRhdGVkQ2hlY2tvdXQ6IFZhbGlkYXRpb24gaXMgZmFpbGVkJyApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCggJy53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCwgLndvb2NvbW1lcmNlLWVycm9yLCAud29vY29tbWVyY2UtbWVzc2FnZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnVwZGF0ZU9yZGVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uKCBldmVudCApIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gZXZlbnQuZGF0YS5vYmo7XG4gICAgICAgICAgICBsZXQgdGVybXMgPSAkKCAnI3Rlcm1zJyApO1xuXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSBcInRlcm1zIGFuZCBjb25kaXRpb25zXCIgaWYgZXhpc3RzXG4gICAgICAgICAgICBpZiAoIHRlcm1zLmxlbmd0aCA+IDAgJiYgISB0ZXJtcy5wcm9wKCAnY2hlY2tlZCcgKSApIHtcbiAgICAgICAgICAgICAgICBzZWxmLnN1Ym1pdF9lcnJvciggJzxkaXYgY2xhc3M9XCJ3b29jb21tZXJjZS1lcnJvclwiPicgKyBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC50ZXJtc19lcnJvciArICc8L2Rpdj4nICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIHNlbGYuZm9ybV9zdWJtaXQgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggc2VsZi5pc1BheW1lbnRNZXRob2RDaG9zZW4oKSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBlICE9PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggISB3Y19zYl9jb21tb24udmFsaWRhdGVGb3JtKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uU3VibWl0JyApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBzZWxmLmZvcm0uaXMoICcucHJvY2Vzc2luZycgKSApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtY2hlY2tvdXQsIC53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UnICkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5mb3JtLmFkZENsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24uYmxvY2soKTtcbiAgICAgICAgICAgICAgICBzZWxmLnBsYWNlT3JkZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICAuZmFpbCggZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vbkVycm9yKCB0ZXh0U3RhdHVzICk7XG4gICAgICAgICAgICAgICAgICAgIH0gKVxuICAgICAgICAgICAgICAgICAgICAuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLnJlc3VsdCAhPT0gJ3N1Y2Nlc3MnICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVsb2FkJykgJiYgdHJ1ZSA9PT0gcmVzcG9uc2UucmVsb2FkICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmlnZ2VyIHVwZGF0ZSBpbiBjYXNlIHdlIG5lZWQgYSBmcmVzaCBub25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggdHJ1ZSA9PT0gcmVzcG9uc2UucmVzdWx0LnJlZnJlc2ggKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAndXBkYXRlX2NoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub25FcnJvciggcmVzcG9uc2UubWVzc2FnZXMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggd2Nfc2JfY29tbW9uLmlzUmVkaXJlY3RNZXRob2RFbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgdG8gdGhlIHBheW1lbnQgZ2F0ZXdheSBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdSZWRpcmVjdGluZyB0byAnICsgcmVzcG9uc2VbJ3JlZGlyZWN0X3VybCddICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXNwb25zZVsncmVkaXJlY3RfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgU3dlZEJhbmsgUGF5IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5qc191cmwgPSByZXNwb25zZVsnanNfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbml0UGF5bWVudEpTKCBzZWxmLmpzX3VybCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc2V0Q2hlY2tvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybV9zdWJtaXQgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlIFBheW1lbnQgSmF2YXNjcmlwdFxuICAgICAgICAgKiBAcGFyYW0gdXJsXG4gICAgICAgICAqIEBwYXJhbSBjYWxsYmFja1xuICAgICAgICAgKi9cbiAgICAgICAgaW5pdFBheW1lbnRKUzogZnVuY3Rpb24gKCB1cmwsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgaWYgKCB0eXBlb2YgY2FsbGJhY2sgPT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIERlc3Ryb3lcbiAgICAgICAgICAgIGlmICggd2luZG93Lmhhc093blByb3BlcnR5KCAncGF5ZXgnICkgJiYgd2luZG93LnBheWV4Lmhhc093blByb3BlcnR5KCAnaG9zdGVkVmlldycgKSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiB3aW5kb3cucGF5ZXguaG9zdGVkVmlldy5wYXltZW50TWVudSAhPT0gJ3VuZGVmaW5lZCcgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LnBheW1lbnRNZW51KCkuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKCAnI3BheW1lbnQtc3dlZGJhbmstcGF5LWNoZWNrb3V0IGlmcmFtZScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAvL2RlbGV0ZSB3aW5kb3cucGF5ZXguaG9zdGVkVmlldztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVzdHJveSBKU1xuICAgICAgICAgICAgJCggXCJzY3JpcHRbc3JjKj0ncHgucGF5bWVudG1lbnUuY2xpZW50J11cIiApLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAvLyBMb2FkIEpTXG4gICAgICAgICAgICB3Y19zYl9jb21tb24ubG9hZEpzKCB1cmwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKCAnI3BheW1lbnQtc3dlZGJhbmstcGF5LWNoZWNrb3V0IGlmcmFtZScgKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIC8vIExvYWQgU3dlZEJhbmsgUGF5IENoZWNrb3V0IGZyYW1lXG4gICAgICAgICAgICAgICAgaWYgKCB3Y19zYl9jb21tb24uaXNJbnN0YW50Q2hlY2tvdXQoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5pdGlhdGUgdGhlIHBheW1lbnQgbWVudSBpbiBcIkluc3RhbnQgQ2hlY2tvdXRcIlxuICAgICAgICAgICAgICAgICAgICAkKCAnI3BheW1lbnQnICkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0UGF5bWVudE1lbnUoICdwYXltZW50LXN3ZWRiYW5rLXBheS1jaGVja291dCcgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWF0ZSB0aGUgcGF5bWVudCBtZW51IGluIHRoZSBmcmFtZVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ25vbi1pbnN0YW50IGNoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICAkLmZlYXRoZXJsaWdodCggJzxkaXYgaWQ9XCJzd2VkYmFuay1wYXktcGF5bWVudG1lbnVcIj4mbmJzcDs8L2Rpdj4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYW50OiAnZmVhdGhlcmxpZ2h0LXN3ZWRiYW5rLXBheScsXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkNsaWNrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Fc2M6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXJPcGVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuaW5pdFBheW1lbnRNZW51KCAnc3dlZGJhbmstcGF5LXBheW1lbnRtZW51JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5mb3JtLnJlbW92ZUNsYXNzKCAncHJvY2Vzc2luZycgKS51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpXG4gICAgICAgICAgICB9ICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYXRlIFBheW1lbnQgTWVudS5cbiAgICAgICAgICogUGF5bWVudCBKYXZhc2NyaXB0IG11c3QgYmUgbG9hZGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gaWRcbiAgICAgICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICAgICAqL1xuICAgICAgICBpbml0UGF5bWVudE1lbnU6IGZ1bmN0aW9uICggaWQsIGNhbGxiYWNrICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdpbml0UGF5bWVudE1lbnUnICk7XG5cbiAgICAgICAgICAgIGlmICggdHlwZW9mIGNhbGxiYWNrID09PSAndW5kZWZpbmVkJyApIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIFN3ZWRCYW5rIFBheSBDaGVja291dCBmcmFtZVxuICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudSA9IHdpbmRvdy5wYXlleC5ob3N0ZWRWaWV3LnBheW1lbnRNZW51KCB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBpZCxcbiAgICAgICAgICAgICAgICBjdWx0dXJlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5jdWx0dXJlLFxuICAgICAgICAgICAgICAgIHN0eWxlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5wYXltZW50TWVudVN0eWxlID8gSlNPTi5wYXJzZSggV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQucGF5bWVudE1lbnVTdHlsZSApIDogbnVsbCxcbiAgICAgICAgICAgICAgICBvbkFwcGxpY2F0aW9uQ29uZmlndXJlZDogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25BcHBsaWNhdGlvbkNvbmZpZ3VyZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LmlzUGF5bWVudE1lbnVMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggbnVsbCApO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0Lm9uUGF5bWVudE1lbnVJbnN0cnVtZW50U2VsZWN0ZWQoIGRhdGEubmFtZSwgZGF0YS5pbnN0cnVtZW50ICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRDcmVhdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q3JlYXRlZCcgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENvbXBsZXRlZDogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uUGF5bWVudENvbXBsZXRlZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbi5ocmVmID0gZGF0YS5yZWRpcmVjdFVybDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uUGF5bWVudENhbmNlbGVkOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnb25QYXltZW50Q2FuY2VsZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3BheW1lbnQtbWVudS1jYW5jZWwnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblBheW1lbnRGYWlsZWQ6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRGYWlsZWQnICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi5sb2dFcnJvciggJ3BheW1lbnQtbWVudS1mYWlsZWQnLCBkYXRhICk7XG4gICAgICAgICAgICAgICAgICAgIC8vc2VsZi5sb2NhdGlvbi5ocmVmID0gZGF0YS5yZWRpcmVjdFVybDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uICggZGF0YSApIHtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAncGF5bWVudC1tZW51LWVycm9yJywgZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayggZGF0YSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudS5vcGVuKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZnJlc2hcbiAgICAgICAgICovXG4gICAgICAgIHJlZnJlc2hQYXltZW50TWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3JlZnJlc2hQYXltZW50TWVudScgKTtcbiAgICAgICAgICAgIGlmICggdHlwZW9mIHRoaXMucGF5bWVudE1lbnUgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudSAmJlxuICAgICAgICAgICAgICAgIHRoaXMucGF5bWVudE1lbnUuaGFzT3duUHJvcGVydHkoICdyZWZyZXNoJyApICYmXG4gICAgICAgICAgICAgICAgdHlwZW9mIHRoaXMucGF5bWVudE1lbnUucmVmcmVzaCA9PT0gJ2Z1bmN0aW9uJyApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXltZW50TWVudS5yZWZyZXNoKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggJ3JlZnJlc2hQYXltZW50TWVudTogcmVmcmVzaCB3b3JrYXJvdW5kJyApO1xuICAgICAgICAgICAgICAgIC8vd2Nfc2JfY2hlY2tvdXQuaW5pdFBheW1lbnRKUyggd2Nfc2JfY2hlY2tvdXQuanNfdXJsIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGxhY2UgT3JkZXJcbiAgICAgICAgICogQHJldHVybiB7SlF1ZXJ5UHJvbWlzZTxhbnk+fVxuICAgICAgICAgKi9cbiAgICAgICAgcGxhY2VPcmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdwbGFjZU9yZGVyJyApO1xuICAgICAgICAgICAgbGV0IGZpZWxkcyA9ICQoJy53b29jb21tZXJjZS1jaGVja291dCcpLnNlcmlhbGl6ZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQuYWpheF91cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdzd2VkYmFua19wYXlfcGxhY2Vfb3JkZXInLFxuICAgICAgICAgICAgICAgICAgICBub25jZTogV0NfR2F0ZXdheV9Td2VkYmFua19QYXlfQ2hlY2tvdXQubm9uY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGZpZWxkc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSApLmRvbmUoIGZ1bmN0aW9uICggcmVzcG9uc2UgKSB7XG4gICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhZ2VcbiAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZWxvYWQnKSAmJiB0cnVlID09PSByZXNwb25zZS5yZWxvYWQgKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgXHRcdH1cblxuICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3Jlc3VsdCcpICYmIHJlc3BvbnNlLnJlc3VsdCA9PT0gJ2ZhaWx1cmUnICkge1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jb21tb24ubG9nRXJyb3IoICdzYi1wbGFjZS1vcmRlcicsIHJlc3BvbnNlICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0Lm9uRXJyb3IoIHJlc3BvbnNlLm1lc3NhZ2VzICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGUgT3JkZXJcbiAgICAgICAgICogQHBhcmFtIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICogQHJldHVybiB7SlF1ZXJ5UHJvbWlzZTxhbnk+fVxuICAgICAgICAgKi9cbiAgICAgICAgdXBkYXRlT3JkZXI6IGZ1bmN0aW9uICggY29tcGF0aWJpbGl0eSApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAndXBkYXRlT3JkZXInICk7XG4gICAgICAgICAgICBsZXQgZmllbGRzID0gJCgnLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykuc2VyaWFsaXplKCk7XG5cbiAgICAgICAgICAgIGlmICggdHlwZW9mIGNvbXBhdGliaWxpdHkgPT09ICd1bmRlZmluZWQnICkge1xuICAgICAgICAgICAgICAgIGNvbXBhdGliaWxpdHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZmllbGRzICs9ICcmY29tcGF0aWJpbGl0eT0nICsgY29tcGF0aWJpbGl0eTtcblxuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5hZGRDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICB3Y19zYl9jb21tb24uYmxvY2soKTtcblxuICAgICAgICAgICAgaWYgKCB3Y19zYl9jaGVja291dC54aHIgKSB7XG4gICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQueGhyLmFib3J0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnhociA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICB1cmw6IFdDX0dhdGV3YXlfU3dlZGJhbmtfUGF5X0NoZWNrb3V0LmFqYXhfdXJsLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc3dlZGJhbmtfcGF5X3VwZGF0ZV9vcmRlcicsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBXQ19HYXRld2F5X1N3ZWRiYW5rX1BheV9DaGVja291dC5ub25jZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmllbGRzXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuYWx3YXlzKCBmdW5jdGlvbiAoIHJlc3BvbnNlICkge1xuICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC54aHIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICk7XG4gICAgICAgICAgICAgICAgICAgIHdjX3NiX2NvbW1vbi51bmJsb2NrKCk7XG4gICAgICAgICAgICAgICAgfSApXG4gICAgICAgICAgICAgICAgLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cyApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICd1cGRhdGVPcmRlciBlcnJvcjonICsgdGV4dFN0YXR1cyApO1xuICAgICAgICAgICAgICAgICAgICAvL3djX3NiX2NoZWNrb3V0Lm9uRXJyb3IoIHRleHRTdGF0dXMgKTtcbiAgICAgICAgICAgICAgICB9IClcbiAgICAgICAgICAgICAgICAuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggcmVzcG9uc2UgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZXN1bHQnKSAmJiByZXNwb25zZS5yZXN1bHQgPT09ICdzdWNjZXNzJyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZnJlc2ggUGF5bWVudCBNZW51XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5qc191cmwgPSByZXNwb25zZVsnanNfdXJsJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5yZWZyZXNoUGF5bWVudE1lbnUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVzdWx0JykgJiYgcmVzcG9uc2UucmVzdWx0ID09PSAnZmFpbHVyZScgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZXMgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAnRXJyb3IgbWVzc2FnZSBpcyBlbXB0eS4nICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTd2VkQmFuayBQYXltZW50IHJldHVybnMgZXJyb3IgdGhhdCBPcmRlciB1cGRhdGUgaXMgbm90IGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5tZXNzYWdlcy5pbmRleE9mKCAnT3JkZXIgdXBkYXRlIGlzIG5vdCBhdmFpbGFibGUuJyApID4gLTEgJiYgISBjb21wYXRpYmlsaXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIHJlbG9hZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybiggJ3JlZnJlc2hQYXltZW50TWVudTogcmVmcmVzaCB3b3JrYXJvdW5kLiBGb3JjZSByZWxvYWQuJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnVwZGF0ZU9yZGVyKCB0cnVlICkuZG9uZSggZnVuY3Rpb24gKCByZXNwb25zZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCByZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnanNfdXJsJykgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3Y19zYl9jaGVja291dC5pbml0UGF5bWVudEpTKCByZXNwb25zZS5qc191cmwgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbG9hZCBwYWdlXG4gICAgICAgICAgICAgICAgICAgIGlmICggcmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3JlbG9hZCcpICYmIHRydWUgPT09IHJlc3BvbnNlLnJlbG9hZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVHJpZ2dlciB1cGRhdGUgaW4gY2FzZSB3ZSBuZWVkIGEgZnJlc2ggbm9uY2VcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB0cnVlID09PSByZXNwb25zZS5yZXN1bHQucmVmcmVzaCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoIGRvY3VtZW50LmJvZHkgKS50cmlnZ2VyKCAndXBkYXRlX2NoZWNrb3V0JyApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgd2Nfc2JfY29tbW9uLmxvZ0Vycm9yKCAnc2ItdXBkYXRlLW9yZGVyJywgcmVzcG9uc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgLy93Y19zYl9jaGVja291dC5vbkVycm9yKCByZXNwb25zZS5tZXNzYWdlcyApO1xuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAgd2Nfc2JfY2hlY2tvdXQueGhyO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPbiBQYXltZW50IE1lbnUgSW5zdHJ1bWVudCBTZWxlY3RlZFxuICAgICAgICAgKiBAcGFyYW0gbmFtZVxuICAgICAgICAgKiBAcGFyYW0gaW5zdHJ1bWVudFxuICAgICAgICAgKi9cbiAgICAgICAgb25QYXltZW50TWVudUluc3RydW1lbnRTZWxlY3RlZDogZnVuY3Rpb24gKCBuYW1lLCBpbnN0cnVtZW50ICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdvblBheW1lbnRNZW51SW5zdHJ1bWVudFNlbGVjdGVkJywgbmFtZSwgaW5zdHJ1bWVudCApO1xuICAgICAgICAgICAgJCggZG9jdW1lbnQuYm9keSApLnRyaWdnZXIoICdzYl9wYXltZW50X21lbnVfaW5zdHJ1bWVudF9zZWxlY3RlZCcsIFtuYW1lLCBpbnN0cnVtZW50XSApO1xuICAgICAgICB9LFxuICAgICAgICBvbkVycm9yOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ29uRXJyb3InLCBkYXRhICk7XG4gICAgICAgICAgICB3Y19zYl9jaGVja291dC5zdWJtaXRfZXJyb3IoICc8ZGl2IGNsYXNzPVwid29vY29tbWVyY2UtZXJyb3JcIj4nICsgZGF0YSArICc8L2Rpdj4nICk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdF9lcnJvcjogZnVuY3Rpb24oIGVycm9yX21lc3NhZ2UgKSB7XG4gICAgICAgICAgICAkKCAnLndvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0LCAud29vY29tbWVyY2UtZXJyb3IsIC53b29jb21tZXJjZS1tZXNzYWdlJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5wcmVwZW5kKCAnPGRpdiBjbGFzcz1cIndvb2NvbW1lcmNlLU5vdGljZUdyb3VwIHdvb2NvbW1lcmNlLU5vdGljZUdyb3VwLWNoZWNrb3V0XCI+JyArIGVycm9yX21lc3NhZ2UgKyAnPC9kaXY+JyApO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5yZW1vdmVDbGFzcyggJ3Byb2Nlc3NpbmcnICkudW5ibG9jaygpO1xuICAgICAgICAgICAgd2Nfc2JfY2hlY2tvdXQuZm9ybS5maW5kKCAnLmlucHV0LXRleHQsIHNlbGVjdCwgaW5wdXQ6Y2hlY2tib3gnICkudHJpZ2dlciggJ3ZhbGlkYXRlJyApLmJsdXIoKTtcbiAgICAgICAgICAgIHdjX3NiX2NoZWNrb3V0LnNjcm9sbF90b19ub3RpY2VzKCk7XG4gICAgICAgICAgICAkKCBkb2N1bWVudC5ib2R5ICkudHJpZ2dlciggJ2NoZWNrb3V0X2Vycm9yJyApO1xuICAgICAgICB9LFxuICAgICAgICBzY3JvbGxfdG9fbm90aWNlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsRWxlbWVudCA9ICQoICcud29vY29tbWVyY2UtTm90aWNlR3JvdXAtdXBkYXRlT3JkZXJSZXZpZXcsIC53b29jb21tZXJjZS1Ob3RpY2VHcm91cC1jaGVja291dCcgKTtcbiAgICAgICAgICAgIGlmICggISBzY3JvbGxFbGVtZW50Lmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxFbGVtZW50ID0gJCggJy5mb3JtLmNoZWNrb3V0JyApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLnNjcm9sbF90b19ub3RpY2VzKCBzY3JvbGxFbGVtZW50ICk7XG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdjX3NiX2NoZWNrb3V0LmluaXQoICQoIFwiZm9ybS5jaGVja291dCwgZm9ybSNvcmRlcl9yZXZpZXcsIGZvcm0jYWRkX3BheW1lbnRfbWV0aG9kXCIgKSApO1xuICAgIH0gKTtcbn0pO1xuXG4iXX0=
