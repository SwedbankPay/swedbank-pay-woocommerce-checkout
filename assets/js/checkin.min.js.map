{"version":3,"sources":["checkin.js"],"names":["jQuery","$","window","wc_sb_checkin","init","wc_sb_common","isCheckinEnabled","document","body","on","loadCheckIn","this","val","hide","showAddressFields","hideAddressFields","initCheckIn","country","ajax","type","url","WC_Gateway_Swedbank_Pay_Checkout","ajax_url","data","action","nonce","dataType","done","success","logError","alert","details","hasOwnProperty","payex","hostedView","consumer","close","remove","loadJs","waitForLoading","err","console","warn","container","culture","style","checkInStyle","JSON","parse","onConsumerIdentified","log","onNewConsumer","onConsumerRemoved","onBillingDetailsAvailable","onAddressDetailsAvailable","onShippingDetailsAvailable","needs_shipping_address","ship_to_billing_address_only","onError","open","show","consumerProfileRef","always","response","isInstantCheckout","wc_sb_checkout","initCheckout","message","block","unblock","each","key","value","forEach","section","el","length","prop","closest","removeClass","change","el1","Select2","select2","fn","chosen","trigger","ready"],"mappings":"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","file":"checkin.min.js","sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    'use strict';\n\n    window.wc_sb_checkin = {\n        /**\n         * Initialize\n         */\n        init: function() {\n            if ( wc_sb_common.isCheckinEnabled() ) {\n                $( document.body ).on( 'change', '#checkin_country', function () {\n                    wc_sb_checkin.loadCheckIn( $(this).val() );\n                } );\n\n                $( document.body ).on( 'click', '#change-shipping-info', function () {\n                    // Hide \"Change shipping info\" button\n                    $( '#change-shipping-info' ).hide();\n\n                    // Show Address Fields\n                    wc_sb_checkin.showAddressFields();\n                } );\n\n                wc_sb_checkin.hideAddressFields();\n                wc_sb_checkin.initCheckIn();\n            }\n\n        },\n\n        /**\n         * Load CheckIn\n         * @param country\n         * @returns {*}\n         */\n        loadCheckIn: function( country ) {\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkin',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    country: country\n                },\n                dataType: 'json'\n            } ).done( function ( data ) {\n                if ( ! data.success ) {\n                    wc_sb_common.logError( 'sb-checkin-loader', data );\n                    alert( data.details );\n                    return;\n                }\n\n                // Destroy\n                if ( window.hasOwnProperty( 'payex' ) && window.payex.hasOwnProperty( 'hostedView' ) ) {\n                    if ( typeof window.payex.hostedView.consumer !== 'undefined' ) {\n                        window.payex.hostedView.consumer().close();\n                    }\n                }\n\n                // Destroy JS\n                $( \"script[src*='px.consumer.client']\" ).remove();\n                $( '#swedbank-pay-checkin iframe' ).remove();\n                wc_sb_common.loadJs( data.data, function () {\n                    wc_sb_checkin.initCheckIn();\n                } );\n            } );\n        },\n\n        /**\n         * Initialize CheckIn\n         */\n        initCheckIn: function() {\n            if ( typeof payex === 'undefined') {\n                return;\n            }\n\n            wc_sb_common.waitForLoading('payex.hostedView.consumer', function ( err ) {\n                if ( err ) {\n                    console.warn( err );\n                    return;\n                }\n\n                // Init PayEx hostedView\n                window.payex.hostedView.consumer( {\n                    container: 'swedbank-pay-checkin',\n                    culture: WC_Gateway_Swedbank_Pay_Checkout.culture,\n                    style: WC_Gateway_Swedbank_Pay_Checkout.checkInStyle ? JSON.parse( WC_Gateway_Swedbank_Pay_Checkout.checkInStyle ) : null,\n                    onConsumerIdentified: function( data ) {\n                        console.log( 'hostedView: onConsumerIdentified' );\n                        wc_sb_checkin.onConsumerIdentified( data );\n                    },\n                    onNewConsumer: function( data ) {\n                        console.log( 'hostedView: onNewConsumer' );\n                        wc_sb_checkin.onConsumerIdentified( data );\n                    },\n                    onConsumerRemoved: function( data ) {\n                        console.log( 'hostedView: onConsumerRemoved' );\n                    },\n                    onBillingDetailsAvailable: function( data ) {\n                        wc_sb_checkin.onAddressDetailsAvailable( 'billing', data );\n                    },\n                    onShippingDetailsAvailable: function( data ) {\n                        if ( WC_Gateway_Swedbank_Pay_Checkout.needs_shipping_address ||\n                            WC_Gateway_Swedbank_Pay_Checkout.ship_to_billing_address_only\n                        ) {\n                            wc_sb_checkin.onAddressDetailsAvailable( 'billing', data );\n                        }\n\n                        wc_sb_checkin.onAddressDetailsAvailable( 'shipping', data );\n                    },\n                    onError: function ( data ) {\n                        wc_sb_common.logError( 'sb-checkin', data );\n                        alert( data.details );\n                    }\n                } ).open();\n            });\n        },\n\n        /**\n         * On Consumer Identified\n         * @param data\n         * @returns {*}\n         */\n        onConsumerIdentified: function ( data ) {\n            console.log( 'onConsumerIdentified', data );\n            $( '#change-shipping-info' ).show();\n\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_customer_profile',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    consumerProfileRef: data.consumerProfileRef\n                },\n                dataType: 'json'\n            } ).always( function ( response ) {\n                //\n            } ).done( function ( response) {\n                console.log(response);\n                if (!response.success) {\n                    alert(response.data.message);\n                    return;\n                }\n\n                // Initiate Checkout if active\n                if ( wc_sb_common.isInstantCheckout ) {\n                    wc_sb_checkout.initCheckout( data.consumerProfileRef );\n                }\n            } );\n        },\n\n        /**\n         * On Address Details Available\n         * @param type\n         * @param data\n         * @returns {*}\n         */\n        onAddressDetailsAvailable: function( type, data ) {\n            console.log( 'onAddressDetailsAvailable', type, data );\n\n            $( '#change-shipping-info' ).show();\n\n            wc_sb_common.block();\n            return $.ajax( {\n                type: 'POST',\n                url: WC_Gateway_Swedbank_Pay_Checkout.ajax_url,\n                data: {\n                    action: 'swedbank_pay_checkout_get_address',\n                    nonce: WC_Gateway_Swedbank_Pay_Checkout.nonce,\n                    type: type,\n                    url: data.url\n                },\n                dataType: 'json'\n            } ).always( function ( response ) {\n                wc_sb_common.unblock();\n            } ).done( function ( response) {\n                console.log(response);\n                if (!response.success) {\n                    wc_sb_common.logError('sb-address-details', response);\n                    alert(response.data.message);\n                    return;\n                }\n\n                // Process address\n                let data = response.data;\n                $.each(data, function (key, value) {\n                    [type].forEach(function(section) {\n                        let el = $('input[name=\"' + section + '_' + key + '\"]');\n                        if (el.length === 0) {\n                            return;\n                        }\n\n                        el.prop('readonly', false);\n                        el.closest('.form-row').removeClass('swedbank-pay-locked');\n                        el.val(value).change();\n\n                        if (key === 'country' || key === 'state') {\n                            let el1 = $('#' + section + '_' + key);\n                            if (typeof window.Select2 !== 'undefined') {\n                                el1.select2('val', value);\n                            } else if (typeof $.fn.chosen !== 'undefined') {\n                                // Chosen\n                                el1.val(value).trigger('chosen:updated');\n                                //el1.chosen().change();\n                            } else {\n                                el1.change();\n                            }\n                        }\n                    });\n                });\n\n                $( document.body ).trigger( 'update_checkout' );\n            } );\n        },\n        /**\n         * Hide Address Fields on the checkout\n         */\n        hideAddressFields: function () {\n            $( '.woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields' ).hide();\n        },\n        /**\n         * Show Address Fields on the checkout\n         */\n        showAddressFields: function () {\n            $( '.woocommerce-billing-fields__field-wrapper, .woocommerce-shipping-fields' ).show();\n        }\n    }\n\n    $(document).ready( function () {\n        wc_sb_checkin.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n    } );\n} );"]}